var JBA=function(){this.cpu=new JBA.CPU;this.memory=new JBA.Memory;this.gpu=new JBA.GPU;this.cpu.memory=this.memory;this.gpu.mem=this.memory;this.memory.gpu=this.gpu};JBA.prototype={frame:function(){var a=70224;do{var b=this.cpu.exec();a-=b;this.gpu.step(b)}while(a>0)},run:function(){this.frame()}};JBA.RTC=function(){this.reset()};
JBA.RTC.prototype={s:0,m:0,h:0,d:0,t:0,carry:0,current:0,regs:[],stop:0,_readylatch:0,reset:function(){this.stop=this.current=0;this.regs=[];for(var a=0;a<8;a++)this.regs[a]=0;this.t=this.s=this.m=this.h=this.d=this.carry=this._readylatch=0},latch:function(a){if(this._readylatch){if(a==1){this.regs[0]=this.s;this.regs[1]=this.m;this.regs[2]=this.h;this.regs[3]=this.d&255;this.regs[4]=this.d>>8|this.stop<<6|this.carry<<7;this.regs[5]=this.regs[6]=this.regs[7]=255}this._readylatch=0}else this._readylatch=
a==0?1:0},wb:function(a){switch(this.current&7){case 0:this.s=this.regs[0]=a%60;break;case 1:this.m=this.regs[1]=a%60;break;case 2:this.h=this.regs[2]=a%24;break;case 3:this.regs[3]=a;this.d=this.d&256|a;break;case 4:this.regs[4]=a;this.d=this.d&255|(a&1)<<8;this.stop=a>>6&1;this.carry=a>>7&1}},step:function(){if(!this.stop)if(++this.t>=60){if(++this.s>=60){if(++this.m>=60){if(++this.h>=24){if(++this.d>=365){this.d=0;this.carry=1}this.h=0}this.m=0}this.s=0}this.t=0}}};JBA.GPU=function(){this.reset()};JBA.GPU.Mode={HBLANK:0,VBLANK:1,RDOAM:2,RDVRAM:3};
JBA.GPU.prototype={mem:null,vram:null,oam:null,canvas:null,image:null,clock:0,lcdon:0,winmap:0,winon:0,tiledata:0,bgmap:0,objsize:0,objon:0,bgon:0,lycly:0,mode2int:0,mode1int:0,mode0int:0,coinc:0,mode:JBA.GPU.HBLANK,scy:0,scx:0,ly:0,lyc:0,bgp:0,obp0:0,obp1:0,wy:0,wx:0,reset:function(){this.vram=[];this.oam=[];for(var a=0;a<8192;a++)this.vram[a]=0;for(a=0;a<160;a++)this.oam[a]=0;this.canvas=document.getElementById("gb").getContext("2d");this.image=this.canvas.createImageData(160,144)},white_canvas:function(){for(var a=
0;a<this.image.data.length;a++)this.image.data[a]=255;this.canvas.putImageData(this.image,0,0)},step:function(a){this.clock+=a;switch(this.mode){case JBA.GPU.Mode.HBLANK:if(this.clock>=51){if(this.ly==143){this.mode=JBA.GPU.Mode.VBLANK;this.canvas.putImageData(this.image,0,0)}else this.mode=JBA.GPU.Mode.RDOAM;this.ly++;this.clock=0}break;case JBA.GPU.Mode.VBLANK:if(this.clock>=114){this.ly++;this.clock=0;if(this.ly>153){this.mode=JBA.GPU.Mode.RDOAM;this.ly=0}}break;case JBA.GPU.Mode.RDOAM:if(this.clock>=
20){this.mode=JBA.GPU.Mode.RDVRAM;this.clock=0}break;case JBA.GPU.Mode.RDVRAM:if(this.clock>=43){this.mode=JBA.GPU.Mode.HBLANK;this.clock=0;this.render_line()}}},render_line:function(){},rb:function(a){switch(a&255){case 64:return this.lcdon<<7|this.winmap<<6|this.winon<<5|this.tiledata<<4|this.bgmap<<3|this.objsize<<2|this.objon<<1|this.bgon;case 65:return this.lycly<<6|this.mode2int<<5|this.mode1int<<4|this.mode0int<<3|this.coinc<<2|this.mode;case 66:return this.scy;case 67:return this.scx;case 68:return this.ly;
case 69:return this.lyc;case 71:return this.bgp;case 72:return this.obp0;case 73:return this.obp1;case 74:return this.wy;case 75:return this.wx}return 255},wb:function(a,b){switch(a&255){case 64:this.lcdon=b>>7&1;this.winmap=b>>6&1;this.winon=b>>5&1;this.tiledata=b>>4&1;this.bgmap=b>>3&1;this.objsize=b>>2&1;this.objon=b>>1&1;this.bgon=b&1;break;case 65:this.lycly=b>>6&1;this.mode2int=b>>5&1;this.mode1int=b>>4&1;this.mode0int=b>>3&1;this.coinc=b>>2&1;this.mode=b&3;break;case 66:this.scy=b;break;case 67:this.scx=
b;break;case 69:this.lyc=b;break;case 70:this.oam_dma_transfer(b);break;case 71:this.bgp=b;break;case 72:this.obp0=b;break;case 73:this.obp1=b;break;case 74:this.wy=b;break;case 75:this.wx=b}},oam_dma_transfer:function(a){a=(a&255)<<8;for(var b=0;b<160;b++)this.oam[b]=this.mem.rb(a|b)}};var Z80={};Z80.Registers=function(){this._saved={a:0,b:0,c:0,d:0,e:0,f:0,h:0,l:0,sp:0,pc:0,m:0,ime:0,halt:0,stop:0};this.reset()};
Z80.Registers.prototype={a:0,b:0,c:0,d:0,e:0,f:0,h:0,l:0,sp:0,pc:0,m:0,ime:0,halt:0,stop:0,save:function(){this._saved.a=this.a;this._saved.b=this.b;this._saved.c=this.c;this._saved.d=this.d;this._saved.e=this.e;this._saved.f=this.f;this._saved.h=this.h;this._saved.l=this.l;this._saved.sp=this.sp;this._saved.pc=this.pc;this._saved.m=this.m;this._saved.ime=this.ime;this._saved.halt=this.halt;this._saved.stop=this.stop},restore:function(){this.a=this._saved.a;this.b=this._saved.b;this.c=this._saved.c;
this.d=this._saved.d;this.e=this._saved.e;this.f=this._saved.f;this.h=this._saved.h;this.l=this._saved.l;this.sp=this._saved.sp;this.pc=this._saved.pc;this.m=this._saved.m;this.ime=this._saved.ime;this.halt=this._saved.halt;this.stop=this._saved.stop},reset:function(){this.a=1;this.f=176;this.b=0;this.c=19;this.d=0;this.e=216;this.h=1;this.l=77;this.sp=65534;this.pc=256}};Z80.ops={xx:function(){},map_cb:function(a,b){var c=Z80.cbmap[b.rb(a.pc++)];a.pc&=65535;c(a,b)},ld_bb:function(a){a.m=1},ld_bc:function(a){a.b=a.c;a.m=1},ld_bd:function(a){a.b=a.d;a.m=1},ld_be:function(a){a.b=a.e;a.m=1},ld_bh:function(a){a.b=a.h;a.m=1},ld_bl:function(a){a.b=a.l;a.m=1},ld_ba:function(a){a.b=a.a;a.m=1},ld_cb:function(a){a.c=a.b;a.m=1},ld_cc:function(a){a.m=1},ld_cd:function(a){a.c=a.d;a.m=1},ld_ce:function(a){a.c=a.e;a.m=1},ld_ch:function(a){a.c=a.h;a.m=1},ld_cl:function(a){a.c=a.l;
a.m=1},ld_ca:function(a){a.c=a.a;a.m=1},ld_db:function(a){a.d=a.b;a.m=1},ld_dc:function(a){a.d=a.c;a.m=1},ld_dd:function(a){a.m=1},ld_de:function(a){a.d=a.e;a.m=1},ld_dh:function(a){a.d=a.h;a.m=1},ld_dl:function(a){a.d=a.l;a.m=1},ld_da:function(a){a.d=a.a;a.m=1},ld_eb:function(a){a.e=a.b;a.m=1},ld_ec:function(a){a.e=a.c;a.m=1},ld_ed:function(a){a.e=a.d;a.m=1},ld_ee:function(a){a.m=1},ld_eh:function(a){a.e=a.h;a.m=1},ld_el:function(a){a.e=a.l;a.m=1},ld_ea:function(a){a.e=a.a;a.m=1},ld_hb:function(a){a.h=
a.b;a.m=1},ld_hc:function(a){a.h=a.c;a.m=1},ld_hd:function(a){a.h=a.d;a.m=1},ld_he:function(a){a.h=a.e;a.m=1},ld_hh:function(a){a.m=1},ld_hl:function(a){a.h=a.l;a.m=1},ld_ha:function(a){a.h=a.a;a.m=1},ld_lb:function(a){a.l=a.b;a.m=1},ld_lc:function(a){a.l=a.c;a.m=1},ld_ld:function(a){a.l=a.d;a.m=1},ld_le:function(a){a.l=a.e;a.m=1},ld_lh:function(a){a.l=a.h;a.m=1},ld_ll:function(a){a.m=1},ld_la:function(a){a.l=a.a;a.m=1},ld_ab:function(a){a.a=a.b;a.m=1},ld_ac:function(a){a.a=a.c;a.m=1},ld_ad:function(a){a.a=
a.d;a.m=1},ld_ae:function(a){a.a=a.e;a.m=1},ld_ah:function(a){a.a=a.h;a.m=1},ld_al:function(a){a.a=a.l;a.m=1},ld_aa:function(a){a.m=1},ld_bn:function(a,b){a.b=b.rb(a.pc++);a.m=2},ld_cn:function(a,b){a.c=b.rb(a.pc++);a.m=2},ld_dn:function(a,b){a.d=b.rb(a.pc++);a.m=2},ld_en:function(a,b){a.e=b.rb(a.pc++);a.m=2},ld_hn:function(a,b){a.h=b.rb(a.pc++);a.m=2},ld_ln:function(a,b){a.l=b.rb(a.pc++);a.m=2},ld_an:function(a,b){a.a=b.rb(b.rw(a.pc));a.pc+=2;a.m=4},ld_bhlm:function(a,b){a.b=b.rb(a.h<<8|a.l);a.m=
2},ld_chlm:function(a,b){a.c=b.rb(a.h<<8|a.l);a.m=2},ld_dhlm:function(a,b){a.d=b.rb(a.h<<8|a.l);a.m=2},ld_ehlm:function(a,b){a.e=b.rb(a.h<<8|a.l);a.m=2},ld_hhlm:function(a,b){a.h=b.rb(a.h<<8|a.l);a.m=2},ld_lhlm:function(a,b){a.l=b.rb(a.h<<8|a.l);a.m=2},ld_ahlm:function(a,b){a.a=b.rb(a.h<<8|a.l);a.m=2},ld_hlmb:function(a,b){b.wb(a.h<<8|a.l,a.b);a.m=2},ld_hlmc:function(a,b){b.wb(a.h<<8|a.l,a.c);a.m=2},ld_hlmd:function(a,b){b.wb(a.h<<8|a.l,a.d);a.m=2},ld_hlme:function(a,b){b.wb(a.h<<8|a.l,a.e);a.m=2},
ld_hlmh:function(a,b){b.wb(a.h<<8|a.l,a.h);a.m=2},ld_hlml:function(a,b){b.wb(a.h<<8|a.l,a.l);a.m=2},ld_hlma:function(a,b){b.wb(a.h<<8|a.l,a.a);a.m=2},ld_hlmn:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.pc++));a.m=3},ld_abc:function(a,b){a.a=b.rb(a.b<<8|a.c);a.m=2},ld_ade:function(a,b){a.a=b.rb(a.d<<8|a.e);a.m=2},ld_bca:function(a,b){b.wb(a.b<<8|a.c,a.a);a.m=2},ld_dea:function(a,b){b.wb(a.d<<8|a.e,a.a);a.m=2},ld_na:function(a,b){b.wb(b.rw(a.pc),a.a);a.pc+=2;a.m=4},ld_nsp:function(a,b){b.ww(b.rw(a.pc),a.sp);
a.pc+=2;a.m=4},ld_aIOn:function(a,b){a.a=b.rb(65280|b.rb(a.pc++));a.m=3},ld_IOna:function(a,b){b.wb(65280|b.rb(a.pc++),a.a);a.m=3},ld_aIOc:function(a,b){a.a=b.rb(65280|a.c);a.m=3},ld_IOca:function(a,b){b.wb(65280|a.c,a.a);a.m=3},ldi_hlma:function(a,b){b.wb(a.h<<8|a.l,a.a);a.l=a.l+1&255;if(!a.l)a.h=a.h+1&255;a.m=2},ldi_ahlm:function(a,b){a.a=b.rb(a.h<<8|a.l);a.l=a.l+1&255;if(!a.l)a.h=a.h+1&255;a.m=2},ldd_hlma:function(a,b){b.wb(a.h<<8|a.l,a.a);a.l=a.l-1&255;if(a.l==255)a.h=a.h-1&255;a.m=2},ldd_ahlm:function(a,
b){a.a=b.rb(a.h<<8|a.l);a.l=a.l-1&255;if(a.l==255)a.h=a.h-1&255;a.m=2},ld_bcn:function(a,b){a.c=b.rb(a.pc++);a.b=b.rb(a.pc++);a.m=3},ld_den:function(a,b){a.e=b.rb(a.pc++);a.d=b.rb(a.pc++);a.m=3},ld_hln:function(a,b){a.l=b.rb(a.pc++);a.h=b.rb(a.pc++);a.m=3},ld_spn:function(a,b){a.sp=b.rw(a.pc);a.pc+=2;a.m=3},ld_sphl:function(a){a.sp=a.h<<8|a.l;a.m=2},push_bc:function(a,b){b.wb(--a.sp,a.b);b.wb(--a.sp,a.c);a.m=4},pop_bc:function(a,b){a.c=b.rb(a.sp++);a.b=b.wb(a.sp++);a.m=3},push_de:function(a,b){b.wb(--a.sp,
a.d);b.wb(--a.sp,a.e);a.m=4},pop_de:function(a,b){a.e=b.rb(a.sp++);a.d=b.wb(a.sp++);a.m=3},push_hl:function(a,b){b.wb(--a.sp,a.h);b.wb(--a.sp,a.l);a.m=4},pop_hl:function(a,b){a.l=b.rb(a.sp++);a.h=b.wb(a.sp++);a.m=3},push_af:function(a,b){b.wb(--a.sp,a.a);b.wb(--a.sp,a.f);a.m=4},pop_af:function(a,b){a.f=b.rb(a.sp++);a.a=b.wb(a.sp++);a.m=3},add_ab:function(a){var b=a.a,c=a.b;a.a+=c;a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},add_ac:function(a){var b=a.a,c=a.c;a.a+=c;a.f=
a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},add_ad:function(a){var b=a.a,c=a.d;a.a+=c;a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},add_ae:function(a){var b=a.a,c=a.e;a.a+=c;a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},add_ah:function(a){var b=a.a,c=a.h;a.a+=c;a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},add_al:function(a){var b=a.a,c=a.l;a.a+=c;a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^
c^b)&16)a.f|=32;a.m=1},add_aa:function(a){var b=a.a,c=a.a;a.a+=c;a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},add_ahlm:function(a,b){var c=a.a,d=b.rb(a.h<<8|a.l);a.a+=d;a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^d^c)&16)a.f|=32;a.m=2},add_an:function(a,b){var c=a.a,d=b.rb(a.pc++);a.a+=d;a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^d^c)&16)a.f|=32;a.m=2},adc_ab:function(a){var b=a.a,c=a.b;a.a+=c+((a.f&16)>>4);a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^
c^b)&16)a.f|=32;a.m=1},adc_ac:function(a){var b=a.a,c=a.c;a.a+=c+((a.f&16)>>4);a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},adc_ad:function(a){var b=a.a,c=a.d;a.a+=c+((a.f&16)>>4);a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},adc_ae:function(a){var b=a.a,c=a.e;a.a+=c+((a.f&16)>>4);a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},adc_ah:function(a){var b=a.a,c=a.h;a.a+=c+((a.f&16)>>4);a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=
128);if((a.a^c^b)&16)a.f|=32;a.m=1},adc_al:function(a){var b=a.a,c=a.l;a.a+=c+((a.f&16)>>4);a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},adc_aa:function(a){var b=a.a,c=a.a;a.a+=c+((a.f&16)>>4);a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},adc_ahlm:function(a,b){var c=a.a,d=b.rb(a.h<<8|a.l);a.a+=d+((a.f&16)>>4);a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^d^c)&16)a.f|=32;a.m=2},adc_an:function(a,b){var c=a.a,d=b.rb(a.pc++);a.a+=d+((a.f&16)>>
4);a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^d^c)&16)a.f|=32;a.m=2},sub_ab:function(a){var b=a.a,c=a.b;a.a-=c;a.f=64|(a.a<0?16:0);a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},sub_ac:function(a){var b=a.a,c=a.c;a.a-=c;a.f=64|(a.a<0?16:0);a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},sub_ad:function(a){var b=a.a,c=a.d;a.a-=c;a.f=64|(a.a<0?16:0);a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},sub_ae:function(a){var b=a.a,c=a.e;a.a-=c;a.f=64|(a.a<0?16:0);a.a&=255;
a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},sub_ah:function(a){var b=a.a,c=a.h;a.a-=c;a.f=64|(a.a<0?16:0);a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},sub_al:function(a){var b=a.a,c=a.l;a.a-=c;a.f=64|(a.a<0?16:0);a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},sub_aa:function(a){var b=a.a,c=a.a;a.a-=c;a.f=64|(a.a<0?16:0);a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},sub_ahlm:function(a,b){var c=a.a,d=b.rb(a.h<<8|a.l);a.a-=d;a.f=64|(a.a<0?16:0);a.a&=255;a.a||(a.f|=128);
if((a.a^d^c)&16)a.f|=32;a.m=2},sub_an:function(a,b){var c=a.a,d=b.rb(a.pc++);a.a-=d;a.f=64|(a.a<0?16:0);a.a&=255;a.a||(a.f|=128);if((a.a^d^c)&16)a.f|=32;a.m=2},sbc_ab:function(a){var b=a.a,c=a.b;a.a-=c+((a.f&16)>>4);a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},sbc_ac:function(a){var b=a.a,c=a.c;a.a-=c+((a.f&16)>>4);a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},sbc_ad:function(a){var b=a.a,c=a.d;a.a-=c+((a.f&16)>>4);a.f=a.a>255?16:0;a.a&=255;a.a||
(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},sbc_ae:function(a){var b=a.a,c=a.e;a.a-=c+((a.f&16)>>4);a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},sbc_ah:function(a){var b=a.a,c=a.h;a.a-=c+((a.f&16)>>4);a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},sbc_al:function(a){var b=a.a,c=a.l;a.a-=c+((a.f&16)>>4);a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},sbc_aa:function(a){var b=a.a,c=a.a;a.a-=c+((a.f&16)>>4);a.f=a.a>255?16:0;
a.a&=255;a.a||(a.f|=128);if((a.a^c^b)&16)a.f|=32;a.m=1},sbc_ahlm:function(a,b){var c=a.a,d=b.rb(a.h<<8|a.l);a.a-=d+((a.f&16)>>4);a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^d^c)&16)a.f|=32;a.m=2},sbc_an:function(a,b){var c=a.a,d=b.rb(a.pc++);a.a-=d+((a.f&16)>>4);a.f=a.a>255?16:0;a.a&=255;a.a||(a.f|=128);if((a.a^d^c)&16)a.f|=32;a.m=2},and_ab:function(a){a.a&=a.b;a.f=(a.a?0:128)|32;a.m=1},and_ac:function(a){a.a&=a.c;a.f=(a.a?0:128)|32;a.m=1},and_ad:function(a){a.a&=a.d;a.f=(a.a?0:128)|32;a.m=
1},and_ae:function(a){a.a&=a.e;a.f=(a.a?0:128)|32;a.m=1},and_ah:function(a){a.a&=a.h;a.f=(a.a?0:128)|32;a.m=1},and_al:function(a){a.a&=a.l;a.f=(a.a?0:128)|32;a.m=1},and_aa:function(a){a.f=(a.a?0:128)|32;a.m=1},and_ahlm:function(a,b){a.a&=b.rb(a.h<<8|a.l);a.f=(a.a?0:128)|32;a.m=2},and_an:function(a,b){a.a&=b.rb(a.pc++);a.f=(a.a?0:128)|32;a.m=2},xor_ab:function(a){a.a^=a.b;a.f=a.a?0:128;a.m=1},xor_ac:function(a){a.a^=a.c;a.f=a.a?0:128;a.m=1},xor_ad:function(a){a.a^=a.d;a.f=a.a?0:128;a.m=1},xor_ae:function(a){a.a^=
a.e;a.f=a.a?0:128;a.m=1},xor_ah:function(a){a.a^=a.h;a.f=a.a?0:128;a.m=1},xor_al:function(a){a.a^=a.l;a.f=a.a?0:128;a.m=1},xor_aa:function(a){a.a=0;a.f=128;a.m=1},xor_ahlm:function(a,b){a.a^=b.rb(a.h<<8|a.l);a.f=a.a?0:128;a.m=2},xor_an:function(a,b){a.a^=b.rb(a.pc++);a.f=a.a?0:128;a.m=2},or_ab:function(a){a.a|=a.b;a.f=a.a?0:128;a.m=1},or_ac:function(a){a.a|=a.c;a.f=a.a?0:128;a.m=1},or_ad:function(a){a.a|=a.d;a.f=a.a?0:128;a.m=1},or_ae:function(a){a.a|=a.e;a.f=a.a?0:128;a.m=1},or_ah:function(a){a.a|=
a.h;a.f=a.a?0:128;a.m=1},or_al:function(a){a.a|=a.l;a.f=a.a?0:128;a.m=1},or_aa:function(a){a.f=a.a?0:128;a.m=1},or_ahlm:function(a,b){a.a|=b.rb(a.h<<8|a.l);a.f=a.a?0:128;a.m=2},or_an:function(a,b){a.a|=b.rb(a.pc++);a.f=a.a?0:128;a.m=2},cp_ab:function(a){var b=a.a,c=a.b,d=b-c;a.f=64|(a.a<0?16:0);d&=255;d||(a.f|=128);if((b^c^d)&16)a.f|=32;a.m=1},cp_ac:function(a){var b=a.a,c=a.c,d=b-c;a.f=64|(a.a<0?16:0);d&=255;d||(a.f|=128);if((b^c^d)&16)a.f|=32;a.m=1},cp_ad:function(a){var b=a.a,c=a.d,d=b-c;a.f=64|
(a.a<0?16:0);d&=255;d||(a.f|=128);if((b^c^d)&16)a.f|=32;a.m=1},cp_ae:function(a){var b=a.a,c=a.e,d=b-c;a.f=64|(a.a<0?16:0);d&=255;d||(a.f|=128);if((b^c^d)&16)a.f|=32;a.m=1},cp_ah:function(a){var b=a.a,c=a.h,d=b-c;a.f=64|(a.a<0?16:0);d&=255;d||(a.f|=128);if((b^c^d)&16)a.f|=32;a.m=1},cp_al:function(a){var b=a.a,c=a.l,d=b-c;a.f=64|(a.a<0?16:0);d&=255;d||(a.f|=128);if((b^c^d)&16)a.f|=32;a.m=1},cp_aa:function(a){var b=a.a,c=a.a,d=b-c;a.f=64|(a.a<0?16:0);d&=255;d||(a.f|=128);if((b^c^d)&16)a.f|=32;a.m=1},
cp_ahlm:function(a,b){var c=a.a,d=b.rb(a.h<<8|a.l),e=c-d;a.f=64|(a.a<0?16:0);e&=255;e||(a.f|=128);if((c^d^e)&16)a.f|=32;a.m=2},cp_an:function(a,b){var c=a.a,d=b.rb(a.pc++),e=c-d;a.f=64|(a.a<0?16:0);e&=255;e||(a.f|=128);if((c^d^e)&16)a.f|=32;a.m=2},inc_b:function(a){a.b=a.b+1&255;a.f=a.f&31|(a.b?0:128)|!(a.b&15)<<5;a.m=1},inc_c:function(a){a.c=a.c+1&255;a.f=a.f&31|(a.c?0:128)|!(a.c&15)<<5;a.m=1},inc_d:function(a){a.d=a.d+1&255;a.f=a.f&31|(a.d?0:128)|!(a.d&15)<<5;a.m=1},inc_e:function(a){a.e=a.e+1&
255;a.f=a.f&31|(a.e?0:128)|!(a.e&15)<<5;a.m=1},inc_h:function(a){a.h=a.h+1&255;a.f=a.f&31|(a.h?0:128)|!(a.h&15)<<5;a.m=1},inc_l:function(a){a.l=a.l+1&255;a.f=a.f&31|(a.l?0:128)|!(a.l&15)<<5;a.m=1},inc_a:function(a){a.a=a.a+1&255;a.f=a.f&31|(a.a?0:128)|!(a.a&15)<<5;a.m=1},inc_hlm:function(a,b){var c=a.h<<8|a.l,d=b.rb(c)+1&255;b.wb(c,d);a.f=d?0:128;a.m=3},dec_b:function(a){a.b=a.b-1&255;a.f=a.f&31|64|(a.b?0:128)|((a.b&15)==15)<<5;a.m=1},dec_c:function(a){a.c=a.c-1&255;a.f=a.f&31|64|(a.c?0:128)|((a.c&
15)==15)<<5;a.m=1},dec_d:function(a){a.d=a.d-1&255;a.f=a.f&31|64|(a.d?0:128)|((a.d&15)==15)<<5;a.m=1},dec_e:function(a){a.e=a.e-1&255;a.f=a.f&31|64|(a.e?0:128)|((a.e&15)==15)<<5;a.m=1},dec_h:function(a){a.h=a.h-1&255;a.f=a.f&31|64|(a.h?0:128)|((a.h&15)==15)<<5;a.m=1},dec_l:function(a){a.l=a.l-1&255;a.f=a.f&31|64|(a.l?0:128)|((a.l&15)==15)<<5;a.m=1},dec_a:function(a){a.a=a.a-1&255;a.f=a.f&31|64|(a.a?0:128)|((a.a&15)==15)<<5;a.m=1},dec_hlm:function(a,b){var c=a.h<<8|a.l,d=b.rb(c)-1&255;b.wb(c,d);a.f=
(d?0:128)|64;a.m=3},daa:function(a){var b=a.a;if(a.f&32||(a.a&15)>9)a.a+=6;a.f&=239;if(a.f&32||b>153){a.a+=96;a.f|=16}a.m=1},cpl:function(a){a.a^=255;a.f=80;a.m=1},add_hlhl:function(a){var b=a.h<<8|a.l,c=a.h<<8|a.l,d=b+c;if(d>4095)a.f|=16;else a.f&=239;if((b&15)+(c&15)>15)a.f|=32;a.l=d&255;a.h=d>>8&255;a.m=2},add_hlbc:function(a){var b=a.h<<8|a.l,c=a.b<<8|a.c,d=b+c;if(d>4095)a.f|=16;else a.f&=239;if((b&15)+(c&15)>15)a.f|=32;a.l=d&255;a.h=d>>8&255;a.m=2},add_hlde:function(a){var b=a.h<<8|a.l,c=a.d<<
8|a.e,d=b+c;if(d>4095)a.f|=16;else a.f&=239;if((b&15)+(c&15)>15)a.f|=32;a.l=d&255;a.h=d>>8&255;a.m=2},add_hlsp:function(a){var b=a.h<<8|a.l,c=a.sp,d=b+c;if(d>4095)a.f|=16;else a.f&=239;if((b&15)+(c&15)>15)a.f|=32;a.l=d&255;a.h=d>>8&255;a.m=2},inc_bc:function(a){a.c=a.c+1&255;if(!a.c)a.b=a.b+1&255;a.m=2},dec_bc:function(a){a.c=a.c-1&255;if(a.c==255)a.b=a.b-1&255;a.m=2},inc_de:function(a){a.e=a.e+1&255;if(!a.e)a.d=a.d+1&255;a.m=2},dec_de:function(a){a.e=a.e-1&255;if(a.e==255)a.d=a.d-1&255;a.m=2},inc_hl:function(a){a.l=
a.l+1&255;if(!a.l)a.h=a.h+1&255;a.m=2},dec_hl:function(a){a.l=a.l-1&255;if(a.l==255)a.h=a.h-1&255;a.m=2},inc_sp:function(a){a.sp=a.sp+1&65535;a.m=2},dec_sp:function(a){a.sp=a.sp-1&65535;a.m=2},add_spn:function(a,b){var c=b.rb(a.pc++);if(c>127)c=~c+1;a.sp+=c;a.m=4},ld_hlspn:function(a,b){var c=b.rb(a.pc++);if(c>127)c=~c+1;c+=a.sp;a.h=c>>8&255;a.l=c&255;a.m=3},rlca:function(a){var b=(a.a&128)>>7;a.a=(a.a<<1|b)&255;a.f=(a.a?0:128)|b<<4;a.m=1},rla:function(a){var b=(a.a&128)>>3;a.a=(a.a<<1|(a.f&16)>>
4)&255;a.f=(a.a?0:128)|b;a.m=1},rlc_b:function(a){var b=(a.b&128)>>7;a.b=(a.b<<1|b)&255;a.f=(a.b?0:128)|b<<4;a.m=2},rl_b:function(a){var b=(a.b&128)>>3;a.b=(a.b<<1|(a.f&16)>>4)&255;a.f=(a.b?0:128)|b;a.m=2},rlc_c:function(a){var b=(a.c&128)>>7;a.c=(a.c<<1|b)&255;a.f=(a.c?0:128)|b<<4;a.m=2},rl_c:function(a){var b=(a.c&128)>>3;a.c=(a.c<<1|(a.f&16)>>4)&255;a.f=(a.c?0:128)|b;a.m=2},rlc_d:function(a){var b=(a.d&128)>>7;a.d=(a.d<<1|b)&255;a.f=(a.d?0:128)|b<<4;a.m=2},rl_d:function(a){var b=(a.d&128)>>3;a.d=
(a.d<<1|(a.f&16)>>4)&255;a.f=(a.d?0:128)|b;a.m=2},rlc_e:function(a){var b=(a.e&128)>>7;a.e=(a.e<<1|b)&255;a.f=(a.e?0:128)|b<<4;a.m=2},rl_e:function(a){var b=(a.e&128)>>3;a.e=(a.e<<1|(a.f&16)>>4)&255;a.f=(a.e?0:128)|b;a.m=2},rlc_h:function(a){var b=(a.h&128)>>7;a.h=(a.h<<1|b)&255;a.f=(a.h?0:128)|b<<4;a.m=2},rl_h:function(a){var b=(a.h&128)>>3;a.h=(a.h<<1|(a.f&16)>>4)&255;a.f=(a.h?0:128)|b;a.m=2},rlc_l:function(a){var b=(a.l&128)>>7;a.l=(a.l<<1|b)&255;a.f=(a.l?0:128)|b<<4;a.m=2},rl_l:function(a){var b=
(a.l&128)>>3;a.l=(a.l<<1|(a.f&16)>>4)&255;a.f=(a.l?0:128)|b;a.m=2},rlc_a:function(a){var b=(a.a&128)>>7;a.a=(a.a<<1|b)&255;a.f=(a.a?0:128)|b<<4;a.m=2},rl_a:function(a){var b=(a.a&128)>>3;a.a=(a.a<<1|(a.f&16)>>4)&255;a.f=(a.a?0:128)|b;a.m=2},rlc_hlm:function(a,b){var c=b.rb(a.h<<8|a.l),d=(c&128)>>7;c=(c<<1|d)&255;b.wb(a.h<<8|a.l,c);a.f=(c?0:128)|d<<4;a.m=4},rl_hlm:function(a,b){var c=b.rb(a.h<<8|a.l),d=(c&128)>>3;c=(c<<1|(a.f&16)>>4)&255;b.wb(a.h<<8|a.l,c);a.f=(c?0:128)|d;a.m=4},rrca:function(a){var b=
(a.a&1)<<7;a.a=a.a>>1|b;a.f=(a.a?0:128)|b>>3;a.m=1},rra:function(a){var b=(a.a&1)<<4;a.a=a.a>>1|(a.f&16)<<3;a.f=(a.a?0:128)|b;a.m=1},rrc_b:function(a){var b=(a.b&1)<<7;a.b=a.b>>1|b;a.f=(a.b?0:128)|b>>3;a.m=2},rr_b:function(a){var b=(a.b&1)<<4;a.b=a.b>>1|(a.f&16)<<3;a.f=(a.b?0:128)|b;a.m=2},rrc_c:function(a){var b=(a.c&1)<<7;a.c=a.c>>1|b;a.f=(a.c?0:128)|b>>3;a.m=2},rr_c:function(a){var b=(a.c&1)<<4;a.c=a.c>>1|(a.f&16)<<3;a.f=(a.c?0:128)|b;a.m=2},rrc_d:function(a){var b=(a.d&1)<<7;a.d=a.d>>1|b;a.f=
(a.d?0:128)|b>>3;a.m=2},rr_d:function(a){var b=(a.d&1)<<4;a.d=a.d>>1|(a.f&16)<<3;a.f=(a.d?0:128)|b;a.m=2},rrc_e:function(a){var b=(a.e&1)<<7;a.e=a.e>>1|b;a.f=(a.e?0:128)|b>>3;a.m=2},rr_e:function(a){var b=(a.e&1)<<4;a.e=a.e>>1|(a.f&16)<<3;a.f=(a.e?0:128)|b;a.m=2},rrc_h:function(a){var b=(a.h&1)<<7;a.h=a.h>>1|b;a.f=(a.h?0:128)|b>>3;a.m=2},rr_h:function(a){var b=(a.h&1)<<4;a.h=a.h>>1|(a.f&16)<<3;a.f=(a.h?0:128)|b;a.m=2},rrc_l:function(a){var b=(a.l&1)<<7;a.l=a.l>>1|b;a.f=(a.l?0:128)|b>>3;a.m=2},rr_l:function(a){var b=
(a.l&1)<<4;a.l=a.l>>1|(a.f&16)<<3;a.f=(a.l?0:128)|b;a.m=2},rrc_a:function(a){var b=(a.a&1)<<7;a.a=a.a>>1|b;a.f=(a.a?0:128)|b>>3;a.m=2},rr_a:function(a){var b=(a.a&1)<<4;a.a=a.a>>1|(a.f&16)<<3;a.f=(a.a?0:128)|b;a.m=2},rrc_hlm:function(a,b){var c=b.rb(a.h<<8|a.l),d=(c&1)<<7;c=c>>1|d;b.wb(a.h<<8|a.l,c);a.f=(c?0:128)|d>>3;a.m=4},rr_hlm:function(a,b){var c=b.rb(a.h<<8|a.l),d=(c&128)<<4;c=c>>1|(a.f&16)<<3;b.wb(a.h<<8|a.l,c);a.f=(c?0:128)|d;a.m=4},sla_b:function(a){var b=(a.b&128)>>7;a.b=a.b<<1&255;a.f=
(a.b?0:128)|b;a.m=2},sla_c:function(a){var b=(a.c&128)>>7;a.c=a.c<<1&255;a.f=(a.c?0:128)|b;a.m=2},sla_d:function(a){var b=(a.d&128)>>7;a.d=a.d<<1&255;a.f=(a.d?0:128)|b;a.m=2},sla_e:function(a){var b=(a.e&128)>>7;a.e=a.e<<1&255;a.f=(a.e?0:128)|b;a.m=2},sla_h:function(a){var b=(a.h&128)>>7;a.h=a.h<<1&255;a.f=(a.h?0:128)|b;a.m=2},sla_l:function(a){var b=(a.l&128)>>7;a.l=a.l<<1&255;a.f=(a.l?0:128)|b;a.m=2},sla_a:function(a){var b=(a.a&128)>>7;a.a=a.a<<1&255;a.f=(a.a?0:128)|b;a.m=2},sla_hlm:function(a,
b){var c=b.rb(a.h<<8|a.l),d=(c&128)>>7;c=c<<1&255;b.wb(a.h<<8|a.l,c);a.f=(c?0:128)|d;a.m=4},swap_b:function(a){var b=a.b;a.b=(b&15)<<4|(b&240)>>4;a.f=b?0:128;a.m=2},swap_c:function(a){var b=a.c;a.c=(b&15)<<4|(b&240)>>4;a.f=b?0:128;a.m=2},swap_d:function(a){var b=a.d;a.d=(b&15)<<4|(b&240)>>4;a.f=b?0:128;a.m=2},swap_e:function(a){var b=a.e;a.e=(b&15)<<4|(b&240)>>4;a.f=b?0:128;a.m=2},swap_h:function(a){var b=a.h;a.h=(b&15)<<4|(b&240)>>4;a.f=b?0:128;a.m=2},swap_l:function(a){var b=a.l;a.l=(b&15)<<4|(b&
240)>>4;a.f=b?0:128;a.m=2},swap_a:function(a){var b=a.a;a.a=(b&15)<<4|(b&240)>>4;a.f=b?0:128;a.m=2},swap_hlm:function(a,b){var c=b.rb(a.h<<8|a.l);b.wb(a.h<<8|a.l,(c&15)<<4|(c&240)>>4);a.f=c?0:128;a.m=4},sra_b:function(a){var b=(a.b&1)<<3;a.b=a.b>>1|a.b&128;a.f=(a.b?0:128)|b;a.m=2},sra_c:function(a){var b=(a.c&1)<<3;a.c=a.c>>1|a.c&128;a.f=(a.c?0:128)|b;a.m=2},sra_d:function(a){var b=(a.d&1)<<3;a.d=a.d>>1|a.d&128;a.f=(a.d?0:128)|b;a.m=2},sra_e:function(a){var b=(a.e&1)<<3;a.e=a.e>>1|a.e&128;a.f=(a.e?
0:128)|b;a.m=2},sra_h:function(a){var b=(a.h&1)<<3;a.h=a.h>>1|a.h&128;a.f=(a.h?0:128)|b;a.m=2},sra_l:function(a){var b=(a.l&1)<<3;a.l=a.l>>1|a.l&128;a.f=(a.l?0:128)|b;a.m=2},sra_a:function(a){var b=(a.a&1)<<3;a.a=a.a>>1|a.a&128;a.f=(a.a?0:128)|b;a.m=2},sra_hlm:function(a,b){var c=b.rb(a.h<<8|a.l),d=(c&1)<<3;c=c>>1|c&128;b.wb(a.h<<8|a.l,c);a.f=(c?0:128)|d;a.m=4},srl_b:function(a){var b=(a.b&1)<<3;a.b>>=1;a.f=(a.b?0:128)|b;a.m=2},srl_c:function(a){var b=(a.c&1)<<3;a.c>>=1;a.f=(a.c?0:128)|b;a.m=2},srl_d:function(a){var b=
(a.d&1)<<3;a.d>>=1;a.f=(a.d?0:128)|b;a.m=2},srl_e:function(a){var b=(a.e&1)<<3;a.e>>=1;a.f=(a.e?0:128)|b;a.m=2},srl_h:function(a){var b=(a.h&1)<<3;a.h>>=1;a.f=(a.h?0:128)|b;a.m=2},srl_l:function(a){var b=(a.l&1)<<3;a.l>>=1;a.f=(a.l?0:128)|b;a.m=2},srl_a:function(a){var b=(a.a&1)<<3;a.a>>=1;a.f=(a.a?0:128)|b;a.m=2},srl_hlm:function(a,b){var c=b.rb(a.h<<8|a.l),d=(c&1)<<3;c>>=1;b.wb(a.h<<8|a.l,c);a.f=(c?0:128)|d;a.m=2},bit_0b:function(a){a.f=a.f&31|32|(a.b&1)<<7;a.m=2},bit_0c:function(a){a.f=a.f&31|
32|(a.c&1)<<7;a.m=2},bit_0d:function(a){a.f=a.f&31|32|(a.d&1)<<7;a.m=2},bit_0e:function(a){a.f=a.f&31|32|(a.e&1)<<7;a.m=2},bit_0h:function(a){a.f=a.f&31|32|(a.h&1)<<7;a.m=2},bit_0l:function(a){a.f=a.f&31|32|(a.l&1)<<7;a.m=2},bit_0a:function(a){a.f=a.f&31|32|(a.a&1)<<7;a.m=2},bit_0hlm:function(a,b){a.f=a.f&31|32|(b.rb(a.h<<8|a.l)&1)<<7;a.m=3},bit_1b:function(a){a.f=a.f&31|32|(a.b&2)<<6;a.m=2},bit_1c:function(a){a.f=a.f&31|32|(a.c&2)<<6;a.m=2},bit_1d:function(a){a.f=a.f&31|32|(a.d&2)<<6;a.m=2},bit_1e:function(a){a.f=
a.f&31|32|(a.e&2)<<6;a.m=2},bit_1h:function(a){a.f=a.f&31|32|(a.h&2)<<6;a.m=2},bit_1l:function(a){a.f=a.f&31|32|(a.l&2)<<6;a.m=2},bit_1a:function(a){a.f=a.f&31|32|(a.a&2)<<6;a.m=2},bit_1hlm:function(a,b){a.f=a.f&31|32|(b.rb(a.h<<8|a.l)&2)<<6;a.m=3},bit_2b:function(a){a.f=a.f&31|32|(a.b&4)<<5;a.m=2},bit_2c:function(a){a.f=a.f&31|32|(a.c&4)<<5;a.m=2},bit_2d:function(a){a.f=a.f&31|32|(a.d&4)<<5;a.m=2},bit_2e:function(a){a.f=a.f&31|32|(a.e&4)<<5;a.m=2},bit_2h:function(a){a.f=a.f&31|32|(a.h&4)<<5;a.m=
2},bit_2l:function(a){a.f=a.f&31|32|(a.l&4)<<5;a.m=2},bit_2a:function(a){a.f=a.f&31|32|(a.a&4)<<5;a.m=2},bit_2hlm:function(a,b){a.f=a.f&31|32|(b.rb(a.h<<8|a.l)&4)<<5;a.m=3},bit_3b:function(a){a.f=a.f&31|32|(a.b&8)<<4;a.m=2},bit_3c:function(a){a.f=a.f&31|32|(a.c&8)<<4;a.m=2},bit_3d:function(a){a.f=a.f&31|32|(a.d&8)<<4;a.m=2},bit_3e:function(a){a.f=a.f&31|32|(a.e&8)<<4;a.m=2},bit_3h:function(a){a.f=a.f&31|32|(a.h&8)<<4;a.m=2},bit_3l:function(a){a.f=a.f&31|32|(a.l&8)<<4;a.m=2},bit_3a:function(a){a.f=
a.f&31|32|(a.a&8)<<4;a.m=2},bit_3hlm:function(a,b){a.f=a.f&31|32|(b.rb(a.h<<8|a.l)&8)<<4;a.m=3},bit_4b:function(a){a.f=a.f&31|32|(a.b&16)<<3;a.m=2},bit_4c:function(a){a.f=a.f&31|32|(a.c&16)<<3;a.m=2},bit_4d:function(a){a.f=a.f&31|32|(a.d&16)<<3;a.m=2},bit_4e:function(a){a.f=a.f&31|32|(a.e&16)<<3;a.m=2},bit_4h:function(a){a.f=a.f&31|32|(a.h&16)<<3;a.m=2},bit_4l:function(a){a.f=a.f&31|32|(a.l&16)<<3;a.m=2},bit_4a:function(a){a.f=a.f&31|32|(a.a&16)<<3;a.m=2},bit_4hlm:function(a,b){a.f=a.f&31|32|(b.rb(a.h<<
8|a.l)&16)<<3;a.m=3},bit_5b:function(a){a.f=a.f&31|32|(a.b&32)<<2;a.m=2},bit_5c:function(a){a.f=a.f&31|32|(a.c&32)<<2;a.m=2},bit_5d:function(a){a.f=a.f&31|32|(a.d&32)<<2;a.m=2},bit_5e:function(a){a.f=a.f&31|32|(a.e&32)<<2;a.m=2},bit_5h:function(a){a.f=a.f&31|32|(a.h&32)<<2;a.m=2},bit_5l:function(a){a.f=a.f&31|32|(a.l&32)<<2;a.m=2},bit_5a:function(a){a.f=a.f&31|32|(a.a&32)<<2;a.m=2},bit_5hlm:function(a,b){a.f=a.f&31|32|(b.rb(a.h<<8|a.l)&32)<<2;a.m=3},bit_6b:function(a){a.f=a.f&31|32|(a.b&64)<<1;a.m=
2},bit_6c:function(a){a.f=a.f&31|32|(a.c&64)<<1;a.m=2},bit_6d:function(a){a.f=a.f&31|32|(a.d&64)<<1;a.m=2},bit_6e:function(a){a.f=a.f&31|32|(a.e&64)<<1;a.m=2},bit_6h:function(a){a.f=a.f&31|32|(a.h&64)<<1;a.m=2},bit_6l:function(a){a.f=a.f&31|32|(a.l&64)<<1;a.m=2},bit_6a:function(a){a.f=a.f&31|32|(a.a&64)<<1;a.m=2},bit_6hlm:function(a,b){a.f=a.f&31|32|(b.rb(a.h<<8|a.l)&64)<<1;a.m=3},bit_7b:function(a){a.f=a.f&31|32|a.b&128;a.m=2},bit_7c:function(a){a.f=a.f&31|32|a.c&128;a.m=2},bit_7d:function(a){a.f=
a.f&31|32|a.d&128;a.m=2},bit_7e:function(a){a.f=a.f&31|32|a.e&128;a.m=2},bit_7h:function(a){a.f=a.f&31|32|a.h&128;a.m=2},bit_7l:function(a){a.f=a.f&31|32|a.l&128;a.m=2},bit_7a:function(a){a.f=a.f&31|32|a.a&128;a.m=2},bit_7hlm:function(a,b){a.f=a.f&31|32|b.rb(a.h<<8|a.l)&128;a.m=3},set_0b:function(a){a.b|=1;a.m=2},set_0c:function(a){a.c|=1;a.m=2},set_0d:function(a){a.d|=1;a.m=2},set_0e:function(a){a.e|=1;a.m=2},set_0h:function(a){a.h|=1;a.m=2},set_0l:function(a){a.l|=1;a.m=2},set_0a:function(a){a.a|=
1;a.m=2},set_0hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)|1);a.m=4},set_1b:function(a){a.b|=2;a.m=2},set_1c:function(a){a.c|=2;a.m=2},set_1d:function(a){a.d|=2;a.m=2},set_1e:function(a){a.e|=2;a.m=2},set_1h:function(a){a.h|=2;a.m=2},set_1l:function(a){a.l|=2;a.m=2},set_1a:function(a){a.a|=2;a.m=2},set_1hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)|2);a.m=4},set_2b:function(a){a.b|=4;a.m=2},set_2c:function(a){a.c|=4;a.m=2},set_2d:function(a){a.d|=4;a.m=2},set_2e:function(a){a.e|=4;a.m=
2},set_2h:function(a){a.h|=4;a.m=2},set_2l:function(a){a.l|=4;a.m=2},set_2a:function(a){a.a|=4;a.m=2},set_2hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)|4);a.m=4},set_3b:function(a){a.b|=8;a.m=2},set_3c:function(a){a.c|=8;a.m=2},set_3d:function(a){a.d|=8;a.m=2},set_3e:function(a){a.e|=8;a.m=2},set_3h:function(a){a.h|=8;a.m=2},set_3l:function(a){a.l|=8;a.m=2},set_3a:function(a){a.a|=8;a.m=2},set_3hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)|8);a.m=4},set_4b:function(a){a.b|=16;a.m=2},set_4c:function(a){a.c|=
16;a.m=2},set_4d:function(a){a.d|=16;a.m=2},set_4e:function(a){a.e|=16;a.m=2},set_4h:function(a){a.h|=16;a.m=2},set_4l:function(a){a.l|=16;a.m=2},set_4a:function(a){a.a|=16;a.m=2},set_4hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)|16);a.m=4},set_5b:function(a){a.b|=32;a.m=2},set_5c:function(a){a.c|=32;a.m=2},set_5d:function(a){a.d|=32;a.m=2},set_5e:function(a){a.e|=32;a.m=2},set_5h:function(a){a.h|=32;a.m=2},set_5l:function(a){a.l|=32;a.m=2},set_5a:function(a){a.a|=32;a.m=2},set_5hlm:function(a,
b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)|32);a.m=4},set_6b:function(a){a.b|=64;a.m=2},set_6c:function(a){a.c|=64;a.m=2},set_6d:function(a){a.d|=64;a.m=2},set_6e:function(a){a.e|=64;a.m=2},set_6h:function(a){a.h|=64;a.m=2},set_6l:function(a){a.l|=64;a.m=2},set_6a:function(a){a.a|=64;a.m=2},set_6hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)|64);a.m=4},set_7b:function(a){a.b|=128;a.m=2},set_7c:function(a){a.c|=128;a.m=2},set_7d:function(a){a.d|=128;a.m=2},set_7e:function(a){a.e|=128;a.m=2},set_7h:function(a){a.h|=
128;a.m=2},set_7l:function(a){a.l|=128;a.m=2},set_7a:function(a){a.a|=128;a.m=2},set_7hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)|128);a.m=4},res_0b:function(a){a.b&=254;a.m=2},res_0c:function(a){a.c&=254;a.m=2},res_0d:function(a){a.d&=254;a.m=2},res_0e:function(a){a.e&=254;a.m=2},res_0h:function(a){a.h&=254;a.m=2},res_0l:function(a){a.l&=254;a.m=2},res_0a:function(a){a.a&=254;a.m=2},res_0hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)&254);a.m=4},res_1b:function(a){a.b&=253;a.m=2},res_1c:function(a){a.c&=
253;a.m=2},res_1d:function(a){a.d&=253;a.m=2},res_1e:function(a){a.e&=253;a.m=2},res_1h:function(a){a.h&=253;a.m=2},res_1l:function(a){a.l&=253;a.m=2},res_1a:function(a){a.a&=253;a.m=2},res_1hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)&253);a.m=4},res_2b:function(a){a.b&=251;a.m=2},res_2c:function(a){a.c&=251;a.m=2},res_2d:function(a){a.d&=251;a.m=2},res_2e:function(a){a.e&=251;a.m=2},res_2h:function(a){a.h&=251;a.m=2},res_2l:function(a){a.l&=251;a.m=2},res_2a:function(a){a.a&=251;a.m=2},res_2hlm:function(a,
b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)&251);a.m=4},res_3b:function(a){a.b&=247;a.m=2},res_3c:function(a){a.c&=247;a.m=2},res_3d:function(a){a.d&=247;a.m=2},res_3e:function(a){a.e&=247;a.m=2},res_3h:function(a){a.h&=247;a.m=2},res_3l:function(a){a.l&=247;a.m=2},res_3a:function(a){a.a&=247;a.m=2},res_3hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)&247);a.m=4},res_4b:function(a){a.b&=239;a.m=2},res_4c:function(a){a.c&=239;a.m=2},res_4d:function(a){a.d&=239;a.m=2},res_4e:function(a){a.e&=239;a.m=2},
res_4h:function(a){a.h&=239;a.m=2},res_4l:function(a){a.l&=239;a.m=2},res_4a:function(a){a.a&=239;a.m=2},res_4hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)&239);a.m=4},res_5b:function(a){a.b&=223;a.m=2},res_5c:function(a){a.c&=223;a.m=2},res_5d:function(a){a.d&=223;a.m=2},res_5e:function(a){a.e&=223;a.m=2},res_5h:function(a){a.h&=223;a.m=2},res_5l:function(a){a.l&=223;a.m=2},res_5a:function(a){a.a&=223;a.m=2},res_5hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)&223);a.m=4},res_6b:function(a){a.b&=
191;a.m=2},res_6c:function(a){a.c&=191;a.m=2},res_6d:function(a){a.d&=191;a.m=2},res_6e:function(a){a.e&=191;a.m=2},res_6h:function(a){a.h&=191;a.m=2},res_6l:function(a){a.l&=191;a.m=2},res_6a:function(a){a.a&=191;a.m=2},res_6hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)&191);a.m=4},res_7b:function(a){a.b&=127;a.m=2},res_7c:function(a){a.c&=127;a.m=2},res_7d:function(a){a.d&=127;a.m=2},res_7e:function(a){a.e&=127;a.m=2},res_7h:function(a){a.h&=127;a.m=2},res_7l:function(a){a.l&=127;a.m=2},res_7a:function(a){a.a&=
127;a.m=2},res_7hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)&127);a.m=4},ccf:function(a){a.f=a.f&143&(a.f&16^16);a.m=1},scf:function(a){a.f=a.f&143|16;a.m=1},nop:function(a){a.m=1},halt:function(a){a.halt=1;a.m=1},stop:function(a){a.stop=1;a.m=1},di:function(a){a.ime=0;a.m=1},ei:function(a){a.ime=1;a.m=1},jp_n:function(a,b){a.pc=b.rw(a.pc);a.m=4},jp_hl:function(a){a.pc=a.h<<8|a.l;a.m=1},jp_nz_n:function(a,b){if(a.f&128){a.pc+=2;a.m=3}else{a.pc=b.rw(a.pc);a.m=4}},jp_z_n:function(a,b){if(a.f&
128){a.pc=b.rw(a.pc);a.m=4}else{a.pc+=2;a.m=3}},jp_nc_n:function(a,b){if(a.f&16){a.pc+=2;a.m=3}else{a.pc=b.rw(a.pc);a.m=4}},jp_c_n:function(a,b){if(a.f&16){a.pc=b.rw(a.pc);a.m=4}else{a.pc+=2;a.m=3}},jr_n:function(a,b){var c=b.rb(a.pc++);if(c>127)c=~c+1;a.pc+=c;a.m=3},jr_nz_n:function(a,b){if(a.f&128){a.pc++;a.m=2}else{var c=b.rb(a.pc++);if(c>127)c=~c+1;a.pc+=c;a.m=3}},jr_z_n:function(a,b){if(a.f&128){var c=b.rb(a.pc++);if(c>127)c=~c+1;a.pc+=c;a.m=3}else{a.pc++;a.m=2}},jr_nc_n:function(a,b){if(a.f&
16){a.pc++;a.m=2}else{var c=b.rb(a.pc++);if(c>127)c=~c+1;a.pc+=c;a.m=3}},jr_c_n:function(a,b){if(a.f&16){var c=b.rb(a.pc++);if(c>127)c=~c+1;a.pc+=c;a.m=3}else{a.pc++;a.m=2}},call_n:function(a,b){a.sp-=2;b.ww(a.sp,a.pc+2);a.pc=b.rw(a.pc);a.m=6},call_nz_n:function(a,b){if(a.f&128){a.m=3;a.pc+=2}else{a.sp-=2;b.ww(a.sp,a.pc+2);a.pc=b.rw(a.pc);a.m=6}},call_z_n:function(a,b){if(a.f&128){a.sp-=2;b.ww(a.sp,a.pc+2);a.pc=b.rw(a.pc);a.m=6}else{a.m=3;a.pc+=2}},call_nc_n:function(a,b){if(a.f&16){a.m=3;a.pc+=2}else{a.sp-=
2;b.ww(a.sp,a.pc+2);a.pc=b.rw(a.pc);a.m=6}},call_c_n:function(a,b){if(a.f&16){a.sp-=2;b.ww(a.sp,a.pc+2);a.pc=b.rw(a.pc);a.m=6}else{a.m=3;a.pc+=2}},ret:function(a,b){a.pc=b.rw(a.sp);a.sp+=2;a.m=4},ret_nz:function(a,b){if(a.f&128)a.m=2;else{a.pc=b.rw(a.sp);a.sp+=2;a.m=5}},ret_z:function(a,b){if(a.f&128){a.pc=b.rw(a.sp);a.sp+=2;a.m=5}else a.m=2},ret_nc:function(a,b){if(a.f&16)a.m=2;else{a.pc=b.rw(a.sp);a.sp+=2;a.m=5}},ret_c:function(a,b){if(a.f&16){a.pc=b.rw(a.sp);a.sp+=2;a.m=5}else a.m=2},reti:function(a,
b){a.ime=1;a.restore();a.pc=b.rw(a.sp);a.sp+=2;a.m=4},rst_00:function(a,b){a.save();a.sp-=2;b.ww(a.sp,a.pc);a.pc=0;a.m=4},rst_08:function(a,b){a.save();a.sp-=2;b.ww(a.sp,a.pc);a.pc=8;a.m=4},rst_10:function(a,b){a.save();a.sp-=2;b.ww(a.sp,a.pc);a.pc=16;a.m=4},rst_18:function(a,b){a.save();a.sp-=2;b.ww(a.sp,a.pc);a.pc=24;a.m=4},rst_20:function(a,b){a.save();a.sp-=2;b.ww(a.sp,a.pc);a.pc=32;a.m=4},rst_28:function(a,b){a.save();a.sp-=2;b.ww(a.sp,a.pc);a.pc=40;a.m=4},rst_30:function(a,b){a.save();a.sp-=
2;b.ww(a.sp,a.pc);a.pc=48;a.m=4},rst_38:function(a,b){a.save();a.sp-=2;b.ww(a.sp,a.pc);a.pc=56;a.m=4},rst_40:function(a,b){a.save();a.sp-=2;b.ww(a.sp,a.pc);a.pc=64;a.m=4},rst_48:function(a,b){a.save();a.sp-=2;b.ww(a.sp,a.pc);a.pc=72;a.m=4},rst_50:function(a,b){a.save();a.sp-=2;b.ww(a.sp,a.pc);a.pc=80;a.m=4},rst_58:function(a,b){a.save();a.sp-=2;b.ww(a.sp,a.pc);a.pc=88;a.m=4},rst_60:function(a,b){a.save();a.sp-=2;b.ww(a.sp,a.pc);a.pc=96;a.m=4}};
Z80.map=[Z80.ops.nop,Z80.ops.ld_bcn,Z80.ops.ld_bca,Z80.ops.inc_bc,Z80.ops.inc_b,Z80.ops.dec_b,Z80.ops.ld_bn,Z80.ops.rlca,Z80.ops.ld_nsp,Z80.ops.add_hlbc,Z80.ops.ld_abc,Z80.ops.dec_bc,Z80.ops.inc_c,Z80.ops.dec_c,Z80.ops.ld_cn,Z80.ops.rrca,Z80.ops.stop,Z80.ops.ld_den,Z80.ops.ld_dea,Z80.ops.inc_de,Z80.ops.inc_d,Z80.ops.dec_d,Z80.ops.ld_dn,Z80.ops.rla,Z80.ops.jr_n,Z80.ops.add_hlde,Z80.ops.ld_ade,Z80.ops.dec_de,Z80.ops.inc_e,Z80.ops.dec_e,Z80.ops.ld_en,Z80.ops.rr_a,Z80.ops.jr_nz_n,Z80.ops.ld_hln,Z80.ops.ld_hlma,
Z80.ops.inc_hl,Z80.ops.inc_h,Z80.ops.dec_h,Z80.ops.ld_hn,Z80.ops.daa,Z80.ops.jr_z_n,Z80.ops.add_hlhl,Z80.ops.ldi_ahlm,Z80.ops.dec_hl,Z80.ops.inc_l,Z80.ops.dec_l,Z80.ops.ld_ln,Z80.ops.cpl,Z80.ops.jr_nc_n,Z80.ops.ld_spn,Z80.ops.ldd_hlma,Z80.ops.inc_sp,Z80.ops.inc_hlm,Z80.ops.dec_hlm,Z80.ops.ld_hlmn,Z80.ops.scf,Z80.ops.jr_c_n,Z80.ops.add_hlsp,Z80.ops.ldd_ahlm,Z80.ops.dec_sp,Z80.ops.inc_a,Z80.ops.dec_a,Z80.ops.ld_an,Z80.ops.ccf,Z80.ops.ld_bb,Z80.ops.ld_bc,Z80.ops.ld_bd,Z80.ops.ld_be,Z80.ops.ld_bh,Z80.ops.ld_bl,
Z80.ops.ld_bhlm,Z80.ops.ld_ba,Z80.ops.ld_cb,Z80.ops.ld_cc,Z80.ops.ld_cd,Z80.ops.ld_ce,Z80.ops.ld_ch,Z80.ops.ld_cl,Z80.ops.ld_chlm,Z80.ops.ld_ca,Z80.ops.ld_db,Z80.ops.ld_dc,Z80.ops.ld_dd,Z80.ops.ld_de,Z80.ops.ld_dh,Z80.ops.ld_dl,Z80.ops.ld_dhlm,Z80.ops.ld_da,Z80.ops.ld_eb,Z80.ops.ld_ec,Z80.ops.ld_ed,Z80.ops.ld_ee,Z80.ops.ld_eh,Z80.ops.ld_el,Z80.ops.ld_ehlm,Z80.ops.ld_ea,Z80.ops.ld_hb,Z80.ops.ld_hc,Z80.ops.ld_hd,Z80.ops.ld_he,Z80.ops.ld_hh,Z80.ops.ld_hl,Z80.ops.ld_hhlm,Z80.ops.ld_ha,Z80.ops.ld_lb,Z80.ops.ld_lc,
Z80.ops.ld_ld,Z80.ops.ld_le,Z80.ops.ld_lh,Z80.ops.ld_ll,Z80.ops.ld_lhlm,Z80.ops.ld_la,Z80.ops.ld_hlmb,Z80.ops.ld_hlmc,Z80.ops.ld_hlmd,Z80.ops.ld_hlme,Z80.ops.ld_hlmh,Z80.ops.ld_hlml,Z80.ops.halt,Z80.ops.ld_hlma,Z80.ops.ld_ab,Z80.ops.ld_ac,Z80.ops.ld_ad,Z80.ops.ld_ae,Z80.ops.ld_ah,Z80.ops.ld_al,Z80.ops.ld_ahlm,Z80.ops.ld_aa,Z80.ops.add_ab,Z80.ops.add_ac,Z80.ops.add_ad,Z80.ops.add_ae,Z80.ops.add_ah,Z80.ops.add_al,Z80.ops.add_ahlm,Z80.ops.add_aa,Z80.ops.adc_ab,Z80.ops.adc_ac,Z80.ops.adc_ad,Z80.ops.adc_ae,
Z80.ops.adc_ah,Z80.ops.adc_al,Z80.ops.adc_ahlm,Z80.ops.adc_aa,Z80.ops.sub_ab,Z80.ops.sub_ac,Z80.ops.sub_ad,Z80.ops.sub_ae,Z80.ops.sub_ah,Z80.ops.sub_al,Z80.ops.sub_ahlm,Z80.ops.sub_aa,Z80.ops.sbc_ab,Z80.ops.sbc_ac,Z80.ops.sbc_ad,Z80.ops.sbc_ae,Z80.ops.sbc_ah,Z80.ops.sbc_al,Z80.ops.sbc_ahlm,Z80.ops.sbc_aa,Z80.ops.and_ab,Z80.ops.and_ac,Z80.ops.and_ad,Z80.ops.and_ae,Z80.ops.and_ah,Z80.ops.and_al,Z80.ops.and_ahlm,Z80.ops.and_aa,Z80.ops.xor_ab,Z80.ops.xor_ac,Z80.ops.xor_ad,Z80.ops.xor_ae,Z80.ops.xor_ah,
Z80.ops.xor_al,Z80.ops.xor_ahlm,Z80.ops.xor_aa,Z80.ops.or_ab,Z80.ops.or_ac,Z80.ops.or_ad,Z80.ops.or_ae,Z80.ops.or_ah,Z80.ops.or_al,Z80.ops.or_ahlm,Z80.ops.or_aa,Z80.ops.cp_ab,Z80.ops.cp_ac,Z80.ops.cp_ad,Z80.ops.cp_ae,Z80.ops.cp_ah,Z80.ops.cp_al,Z80.ops.cp_ahlm,Z80.ops.cp_aa,Z80.ops.ret_nz,Z80.ops.pop_bc,Z80.ops.jp_nz_n,Z80.ops.jp_n,Z80.ops.call_nz_n,Z80.ops.push_bc,Z80.ops.add_an,Z80.ops.rst_00,Z80.ops.ret_z,Z80.ops.ret,Z80.ops.jp_z_n,Z80.ops.map_cb,Z80.ops.call_z_n,Z80.ops.call_n,Z80.ops.adc_an,
Z80.ops.rst_08,Z80.ops.ret_nc,Z80.ops.pop_de,Z80.ops.jp_nc_n,Z80.ops.xx,Z80.ops.call_nc_n,Z80.ops.push_de,Z80.ops.sub_an,Z80.ops.rst_10,Z80.ops.ret_c,Z80.ops.reti,Z80.ops.jp_c_n,Z80.ops.xx,Z80.ops.call_c_n,Z80.ops.xx,Z80.ops.sbc_an,Z80.ops.rst_18,Z80.ops.ld_IOna,Z80.ops.pop_hl,Z80.ops.ld_IOca,Z80.ops.xx,Z80.ops.xx,Z80.ops.push_hl,Z80.ops.and_an,Z80.ops.rst_20,Z80.ops.add_spn,Z80.ops.jp_hl,Z80.ops.ld_na,Z80.ops.xx,Z80.ops.xx,Z80.ops.xx,Z80.ops.xor_an,Z80.ops.rst_28,Z80.ops.ld_aIOn,Z80.ops.pop_af,Z80.ops.ld_aIOc,
Z80.ops.di,Z80.ops.xx,Z80.ops.push_af,Z80.ops.or_an,Z80.ops.rst_30,Z80.ops.ld_hlspn,Z80.ops.ld_sphl,Z80.ops.ld_an,Z80.ops.ei,Z80.ops.xx,Z80.ops.xx,Z80.ops.cp_an,Z80.ops.rst_38];
Z80.cbmap=[Z80.ops.rlc_b,Z80.ops.rlc_c,Z80.ops.rlc_d,Z80.ops.rlc_e,Z80.ops.rlc_h,Z80.ops.rlc_l,Z80.ops.rlc_hlm,Z80.ops.rlc_a,Z80.ops.rrc_b,Z80.ops.rrc_c,Z80.ops.rrc_d,Z80.ops.rrc_e,Z80.ops.rrc_h,Z80.ops.rrc_l,Z80.ops.rrc_hlm,Z80.ops.rrc_a,Z80.ops.rl_b,Z80.ops.rl_c,Z80.ops.rl_d,Z80.ops.rl_e,Z80.ops.rl_h,Z80.ops.rl_l,Z80.ops.rl_hlm,Z80.ops.rl_a,Z80.ops.rr_b,Z80.ops.rr_c,Z80.ops.rr_d,Z80.ops.rr_e,Z80.ops.rr_h,Z80.ops.rr_l,Z80.ops.rr_hlm,Z80.ops.rr_a,Z80.ops.sla_b,Z80.ops.sla_c,Z80.ops.sla_d,Z80.ops.sla_e,
Z80.ops.sla_h,Z80.ops.sla_l,Z80.ops.sla_hlm,Z80.ops.sla_a,Z80.ops.sra_b,Z80.ops.sra_c,Z80.ops.sra_d,Z80.ops.sra_e,Z80.ops.sra_h,Z80.ops.sra_l,Z80.ops.sra_hlm,Z80.ops.sra_a,Z80.ops.swap_b,Z80.ops.swap_c,Z80.ops.swap_d,Z80.ops.swap_e,Z80.ops.swap_h,Z80.ops.swap_l,Z80.ops.swap_hlm,Z80.ops.swap_a,Z80.ops.srl_b,Z80.ops.srl_c,Z80.ops.srl_d,Z80.ops.srl_e,Z80.ops.srl_h,Z80.ops.srl_l,Z80.ops.srl_hlm,Z80.ops.srl_a,Z80.ops.bit_0b,Z80.ops.bit_0c,Z80.ops.bit_0d,Z80.ops.bit_0e,Z80.ops.bit_0h,Z80.ops.bit_0l,Z80.ops.bit_0hlm,
Z80.ops.bit_0a,Z80.ops.bit_1b,Z80.ops.bit_1c,Z80.ops.bit_1d,Z80.ops.bit_1e,Z80.ops.bit_1h,Z80.ops.bit_1l,Z80.ops.bit_1hlm,Z80.ops.bit_1a,Z80.ops.bit_2b,Z80.ops.bit_2c,Z80.ops.bit_2d,Z80.ops.bit_2e,Z80.ops.bit_2h,Z80.ops.bit_2l,Z80.ops.bit_2hlm,Z80.ops.bit_2a,Z80.ops.bit_3b,Z80.ops.bit_3c,Z80.ops.bit_3d,Z80.ops.bit_3e,Z80.ops.bit_3h,Z80.ops.bit_3l,Z80.ops.bit_3hlm,Z80.ops.bit_3a,Z80.ops.bit_4b,Z80.ops.bit_4c,Z80.ops.bit_4d,Z80.ops.bit_4e,Z80.ops.bit_4h,Z80.ops.bit_4l,Z80.ops.bit_4hlm,Z80.ops.bit_4a,
Z80.ops.bit_5b,Z80.ops.bit_5c,Z80.ops.bit_5d,Z80.ops.bit_5e,Z80.ops.bit_5h,Z80.ops.bit_5l,Z80.ops.bit_5hlm,Z80.ops.bit_5a,Z80.ops.bit_6b,Z80.ops.bit_6c,Z80.ops.bit_6d,Z80.ops.bit_6e,Z80.ops.bit_6h,Z80.ops.bit_6l,Z80.ops.bit_6hlm,Z80.ops.bit_6a,Z80.ops.bit_7b,Z80.ops.bit_7c,Z80.ops.bit_7d,Z80.ops.bit_7e,Z80.ops.bit_7h,Z80.ops.bit_7l,Z80.ops.bit_7hlm,Z80.ops.bit_7a,Z80.ops.res_0b,Z80.ops.res_0c,Z80.ops.res_0d,Z80.ops.res_0e,Z80.ops.res_0h,Z80.ops.res_0l,Z80.ops.res_0hlm,Z80.ops.res_0a,Z80.ops.res_1b,
Z80.ops.res_1c,Z80.ops.res_1d,Z80.ops.res_1e,Z80.ops.res_1h,Z80.ops.res_1l,Z80.ops.res_1hlm,Z80.ops.res_1a,Z80.ops.res_2b,Z80.ops.res_2c,Z80.ops.res_2d,Z80.ops.res_2e,Z80.ops.res_2h,Z80.ops.res_2l,Z80.ops.res_2hlm,Z80.ops.res_2a,Z80.ops.res_3b,Z80.ops.res_3c,Z80.ops.res_3d,Z80.ops.res_3e,Z80.ops.res_3h,Z80.ops.res_3l,Z80.ops.res_3hlm,Z80.ops.res_3a,Z80.ops.res_4b,Z80.ops.res_4c,Z80.ops.res_4d,Z80.ops.res_4e,Z80.ops.res_4h,Z80.ops.res_4l,Z80.ops.res_4hlm,Z80.ops.res_4a,Z80.ops.res_5b,Z80.ops.res_5c,
Z80.ops.res_5d,Z80.ops.res_5e,Z80.ops.res_5h,Z80.ops.res_5l,Z80.ops.res_5hlm,Z80.ops.res_5a,Z80.ops.res_6b,Z80.ops.res_6c,Z80.ops.res_6d,Z80.ops.res_6e,Z80.ops.res_6h,Z80.ops.res_6l,Z80.ops.res_6hlm,Z80.ops.res_6a,Z80.ops.res_7b,Z80.ops.res_7c,Z80.ops.res_7d,Z80.ops.res_7e,Z80.ops.res_7h,Z80.ops.res_7l,Z80.ops.res_7hlm,Z80.ops.res_7a,Z80.ops.set_0b,Z80.ops.set_0c,Z80.ops.set_0d,Z80.ops.set_0e,Z80.ops.set_0h,Z80.ops.set_0l,Z80.ops.set_0hlm,Z80.ops.set_0a,Z80.ops.set_1b,Z80.ops.set_1c,Z80.ops.set_1d,
Z80.ops.set_1e,Z80.ops.set_1h,Z80.ops.set_1l,Z80.ops.set_1hlm,Z80.ops.set_1a,Z80.ops.set_2b,Z80.ops.set_2c,Z80.ops.set_2d,Z80.ops.set_2e,Z80.ops.set_2h,Z80.ops.set_2l,Z80.ops.set_2hlm,Z80.ops.set_2a,Z80.ops.set_3b,Z80.ops.set_3c,Z80.ops.set_3d,Z80.ops.set_3e,Z80.ops.set_3h,Z80.ops.set_3l,Z80.ops.set_3hlm,Z80.ops.set_3a,Z80.ops.set_4b,Z80.ops.set_4c,Z80.ops.set_4d,Z80.ops.set_4e,Z80.ops.set_4h,Z80.ops.set_4l,Z80.ops.set_4hlm,Z80.ops.set_4a,Z80.ops.set_5b,Z80.ops.set_5c,Z80.ops.set_5d,Z80.ops.set_5e,
Z80.ops.set_5h,Z80.ops.set_5l,Z80.ops.set_5hlm,Z80.ops.set_5a,Z80.ops.set_6b,Z80.ops.set_6c,Z80.ops.set_6d,Z80.ops.set_6e,Z80.ops.set_6h,Z80.ops.set_6l,Z80.ops.set_6hlm,Z80.ops.set_6a,Z80.ops.set_7b,Z80.ops.set_7c,Z80.ops.set_7d,Z80.ops.set_7e,Z80.ops.set_7h,Z80.ops.set_7l,Z80.ops.set_7hlm,Z80.ops.set_7a];JBA.Memory=function(){this.reset()};JBA.Memory.MBC={UNKNOWN:-1,NONE:0,MBC1:1,MBC2:2,MBC3:3};
JBA.Memory.prototype={gpu:null,reset:function(){this.rtc=new JBA.RTC;this.mbc=JBA.Memory.MBC.UNKNOWN;this.rom="";this.ram=[];this.wram=[];this.hiram=[];this.rombank=1;this.rambank=0;this.wrambank=1;for(var a=this.mode=this.ramon=0;a<65535;a++){this.ram[a]=0;this.wram[a]=0}for(a=0;a<255;a++)this.hiram[a]=0},load_cartridge:function(a){switch(a.charCodeAt(327)){case 0:case 8:case 9:this.mbc=JBA.Memory.MBC.NONE;break;case 1:case 2:case 3:this.mbc=JBA.Memory.MBC.MBC1;break;case 5:case 6:this.mbc=JBA.Memory.MBC.MBC2;
break;case 15:case 16:case 17:case 18:case 19:this.mbc=JBA.Memory.MBC.MBC3;break;default:throw"Unknown/unimplemented MBC type!";}this.rom=a},rw:function(a){return this.rb(a)|this.rb(a+1)<<8},ww:function(a,b){this.wb(a,b&255);this.wb(a+1,b>>8)},rb:function(a){switch(a>>12){case 0:case 1:case 2:case 3:return this.rom.charCodeAt(a)&255;case 4:case 5:case 6:case 7:return this.rom.charCodeAt(this.rombank<<14|a&16383)&255;case 8:case 9:return this.gpu.vram[a&8191];case 10:case 11:if(this.ramon)return this.rtc.current&
8?this.rtc.regs[this.rtc.current&7]:this.ram[this.rambank<<13|a&8191];else break;case 12:case 14:return this.wram[a&4095];case 13:return this.wram[this.wrambank<<12|a&4095];case 15:if(a<65024)return this.rb(a&57343);else if(a<65184)return this.gpu.oam[a&255];else if(!(a<65280))if(a<65408)return this.ioreg_rb(a);else if(a<65535)return this.hiram[a&255]}return 255},ioreg_rb:function(a){switch(a>>4&15){case 4:case 5:case 6:case 7:return this.gpu.rb(a);default:throw"Not implemented reading that address!";
}},wb:function(a,b){switch(a>>12){case 0:case 1:switch(this.mbc){case JBA.Memory.MBC.MBC1:case JBA.Memory.MBC.MBC3:this.ramon=(b&15)==10?1:0;break;case JBA.Memory.MBC.MBC2:if(!(a&256))this.ramon=1^this.ramon}break;case 2:case 3:switch(this.mbc){case JBA.Memory.MBC.MBC1:this.rombank=this.rombank&96|b&31;if(this.rombank==0)this.rombank=1;break;case JBA.Memory.MBC.MBC2:if(a&256)this.rombank=b&15;break;case JBA.Memory.MBC.MBC3:b&=127;this.rombank=b+!b}break;case 4:case 5:switch(this.mbc){case JBA.Memory.MBC.MBC1:if(this.mode==
0)this.rombank=this.rombank&31|(b&3)<<5;else this.rambank=b&3;break;case JBA.Memory.MBC.MBC3:this.rtc.current=b&15;this.rambank=b&3}break;case 6:case 7:switch(this.mbc){case JBA.Memory.MBC.MBC1:this.mode=b&1;break;case JBA.Memory.MBC.MBC3:this.rtc.latch(b)}break;case 8:case 9:this.gpu.vram[a&8191]=b;break;case 10:case 11:if(this.ramon)if(this.rtc.current&8)this.rtc.wb(b);else{if(this.mbc==JBA.Memory.MBC.MBC2)b&=15;this.ram[this.rambank<<13|a&8191]=b}break;case 12:case 14:this.wram[a&4095]=b;break;
case 13:this.wram[this.wrambank<<12|a&4095]=b;break;case 15:if(a<65024)this.wb(a&57343,b);else if(a<65184)this.gpu.oam[a&255]=b;else if(!(a<65280))if(a<65408)this.ioreg_wb(a,b);else if(a<65535)this.hiram[a&255]=b}},ioreg_wb:function(a,b){switch(a>>4&15){case 4:case 5:case 6:case 7:this.gpu.wb(a,b);default:throw"Not implemented reading that address!";}}};JBA.CPU=function(){this.registers=new Z80.Registers;this.reset()};JBA.CPU.prototype={memory:null,reset:function(){},exec:function(){var a=Z80.map[this.memory.rb(this.registers.pc++)];this.registers.pc&=65535;a(this.registers,this.memory);return this.registers.m}};
