var JBA=function(){this.cpu=new JBA.CPU;this.memory=new JBA.Memory;this.gpu=new JBA.GPU;this.timer=new JBA.Timer;this.cpu.memory=this.memory;this.gpu.mem=this.memory;this.memory.gpu=this.gpu;this.memory.timer=this.timer;this.timer.memory=this.memory;this.memory.powerOn()};
JBA.prototype={cpu:null,memory:null,gpu:null,timer:null,fps:0,reset:function(){this.cpu.reset();this.memory.reset();this.gpu.reset();this.timer.reset();this.gpu.white_canvas();this.memory.powerOn()},exec:function(){var a=this.cpu.exec();this.gpu.step(a);return a},frame:function(){var a=70224,b;do{b=this.cpu.exec();a-=b;this.gpu.step(b)}while(a>0);this.fps++},run:function(a){if(typeof a=="undefined")a=16;var b=this;this._interval=setInterval(function(){b.frame()},a)},stop:function(){clearInterval(this._interval)},
load_rom:function(a,b){var c={url:a,beforeSend:function(d){d.overrideMimeType("text/plain; charset=x-user-defined")},context:this,success:function(d){this.memory.load_cartridge(d);b&&b()}};c.beforeSend=c.beforeSend;c.success=c.success;$.ajax(c)},bind_keys:function(a){var b=this.memory.input;$(a).keydown(function(c){return b.keydown(c.keyCode)});$(a).keyup(function(c){return b.keyup(c.keyCode)})},set_canvas:function(a){this.gpu.set_canvas(a)},frames_count:function(){var a=this.fps;this.fps=0;return a}};
window.JBA=JBA;JBA.prototype.load_rom=JBA.prototype.load_rom;JBA.prototype.set_canvas=JBA.prototype.set_canvas;JBA.prototype.bind_keys=JBA.prototype.bind_keys;JBA.prototype.run=JBA.prototype.run;JBA.prototype.stop=JBA.prototype.stop;JBA.prototype.frames_count=JBA.prototype.frames_count;JBA.RTC=function(){this.reset()};
JBA.RTC.prototype={s:0,m:0,h:0,d:0,t:0,carry:0,current:0,regs:[],stop:0,_readylatch:0,reset:function(){this.stop=this.current=0;this.regs=[];for(var a=0;a<8;a++)this.regs[a]=0;this.t=this.s=this.m=this.h=this.d=this.carry=this._readylatch=0},latch:function(a){if(this._readylatch){if(a==1){this.regs[0]=this.s;this.regs[1]=this.m;this.regs[2]=this.h;this.regs[3]=this.d&255;this.regs[4]=this.d>>8|this.stop<<6|this.carry<<7;this.regs[5]=this.regs[6]=this.regs[7]=255}this._readylatch=0}else this._readylatch=
a==0?1:0},wb:function(a){switch(this.current&7){case 0:this.s=this.regs[0]=a%60;break;case 1:this.m=this.regs[1]=a%60;break;case 2:this.h=this.regs[2]=a%24;break;case 3:this.regs[3]=a;this.d=this.d&256|a;break;case 4:this.regs[4]=a;this.d=this.d&255|(a&1)<<8;this.stop=a>>6&1;this.carry=a>>7&1}},step:function(){if(!this.stop)if(++this.t>=60){if(++this.s>=60){if(++this.m>=60){if(++this.h>=24){if(++this.d>=365){this.d=0;this.carry=1}this.h=0}this.m=0}this.s=0}this.t=0}}};JBA.GPU=function(){this.reset()};JBA.GPU.Mode={HBLANK:0,VBLANK:1,RDOAM:2,RDVRAM:3};JBA.GPU.Palette=[[255,255,255,255],[192,192,192,255],[96,96,96,255],[0,0,0,255]];
JBA.GPU.prototype={mem:null,vram:null,oam:null,canvas:null,image:null,clock:0,lcdon:0,winmap:0,winon:0,tiledata:0,bgmap:0,objsize:0,objon:0,bgon:0,lycly:0,mode2int:0,mode1int:0,mode0int:0,mode:JBA.GPU.Mode.RDOAM,scy:0,scx:0,ly:0,lyc:0,bgp:0,obp0:0,obp1:0,wy:0,wx:0,_pal:{bg:[],obp0:[],obp1:[]},reset:function(){var a;this.vram=[];this.oam=[];for(a=0;a<8192;a++)this.vram[a]=0;for(a=0;a<160;a++)this.oam[a]=0;this.mode=JBA.GPU.Mode.RDOAM;this.clock=this.winon=this.winmap=this.lcdon=this.bgon=this.objon=
this.objsize=this.bgmap=this.tiledata=this.mode0int=this.mode1int=this.mode2int=this.lycly=this.lyc=this.ly=this.scx=this.scy=this.wx=this.wy=this.obp1=this.obp0=this.bgp=0;this.canvas&&this.white_canvas()},set_canvas:function(a){this.canvas=a.getContext("2d");this.image=this.canvas.createImageData(160,144);this.white_canvas()},white_canvas:function(){for(var a=0;a<this.image.data.length;a++)this.image.data[a]=255;this.canvas.putImageData(this.image,0,0)},switch_mode0:function(){this.mode=JBA.GPU.Mode.HBLANK;
this.render_line();if(this.mode0int)this.mem._if|=2},switch_mode1:function(){this.mode=JBA.GPU.Mode.VBLANK;this.canvas!=null&&this.canvas.putImageData(this.image,0,0);this.mem._if|=1;if(this.mode1int)this.mem._if|=2},switch_mode2:function(){this.mode=JBA.GPU.Mode.RDOAM;if(this.mode2int)this.mem._if|=2},switch_mode3:function(){this.mode=JBA.GPU.Mode.RDVRAM},step:function(a){this.clock+=a;if(this.clock>=456){this.clock-=456;this.ly=(this.ly+1)%154;this.ly>=144&&this.mode!=JBA.GPU.Mode.VBLANK&&this.switch_mode1();
if(this.ly==this.lyc&&this.lycly)this.mem._if|=2}if(this.ly<144)if(this.clock<=80)this.mode!=JBA.GPU.Mode.RDOAM&&this.switch_mode2();else if(this.clock<=252)this.mode!=JBA.GPU.Mode.RDVRAM&&this.switch_mode3();else this.mode!=JBA.GPU.Mode.HBLANK&&this.switch_mode0()},render_line:function(){if(this.lcdon){this.bgon&&this.render_background();this.objon&&this.render_sprites()}},render_background:function(){var a=this.image.data,b=this.vram,c=this._pal.bg,d=this.bgmap?7168:6144;d+=((this.ly+this.scy&255)>>
3)*32;var f=(this.ly+this.scy)%8,g=this.scx%8,e=this.ly*640,h=0,n=this.tiledata?0:2048;do{var j=b[d+((h+this.scx&255)>>3)];if(this.tiledata==0)j=j+128&255;var l=n+j*16+2*f;j=b[l];for(l=b[l+1];g<8&&h<160;g++,h++,e+=4){var i=c[(l>>7-g&1)<<1|(j>>7-g&1)<<0];a[e]=i[0];a[e+1]=i[1];a[e+2]=i[2];a[e+3]=i[3]}g=0}while(h<160)},render_sprites:function(){for(var a=this.image.data,b=this.vram,c=this.oam,d=this.ly,f=this._pal.bg[0][0],g=0;g<40;g++){var e=g*4,h=c[e]-16,n=c[e+1]-8,j=c[e+3];if(!(h>d||h+8<=d)){var l=
j&16?this._pal.obp1:this._pal.obp0,i=(160*d+n)*4;e=c[e+2]*16;e+=j&64?2*(7-(d-h)):2*(d-h);h=b[e];e=b[e+1];for(var m=0;m<8;m++,i+=4)if(!(n+m<0||n+m>=160)){var k=j&32?m:7-m;k=(e>>k&1)<<1|(h>>k&1)<<0;if(k!=0)if(!(j&128&&a[i]!=f)){k=l[k];a[i]=k[0];a[i+1]=k[1];a[i+2]=k[2];a[i+3]=k[3]}}}}},rb:function(a){switch(a&255){case 64:return this.lcdon<<7|this.winmap<<6|this.winon<<5|this.tiledata<<4|this.bgmap<<3|this.objsize<<2|this.objon<<1|this.bgon;case 65:return this.lycly<<6|this.mode2int<<5|this.mode1int<<
4|this.mode0int<<3|(this.lycly==this.ly?4:0)|this.mode;case 66:return this.scy;case 67:return this.scx;case 68:return this.ly;case 69:return this.lyc;case 71:return this.bgp;case 72:return this.obp0;case 73:return this.obp1;case 74:return this.wy;case 75:return this.wx}return 255},wb:function(a,b){switch(a&255){case 64:this.lcdon=b>>7&1;this.winmap=b>>6&1;this.winon=b>>5&1;this.tiledata=b>>4&1;this.bgmap=b>>3&1;this.objsize=b>>2&1;this.objon=b>>1&1;this.bgon=b&1;break;case 65:this.lycly=b>>6&1;this.mode2int=
b>>5&1;this.mode1int=b>>4&1;this.mode0int=b>>3&1;break;case 66:this.scy=b;break;case 67:this.scx=b;break;case 69:this.lyc=b;break;case 70:this.oam_dma_transfer(b);break;case 71:this.bgp=b;this.update_palette(this._pal.bg,b);break;case 72:this.obp0=b;this.update_palette(this._pal.obp0,b);break;case 73:this.obp1=b;this.update_palette(this._pal.obp1,b);break;case 74:this.wy=b;break;case 75:this.wx=b}},update_palette:function(a,b){a[0]=JBA.GPU.Palette[b>>0&3];a[1]=JBA.GPU.Palette[b>>2&3];a[2]=JBA.GPU.Palette[b>>
4&3];a[3]=JBA.GPU.Palette[b>>6&3]},oam_dma_transfer:function(a){a=(a&255)<<8;if(!(a>61696))for(var b=0;b<160;b++)this.oam[b]=this.mem.rb(a|b)}};var Z80={};Z80.Registers=function(){this.reset()};Z80.Registers.prototype={a:0,b:0,c:0,d:0,e:0,f:0,h:0,l:0,sp:0,pc:0,m:0,ime:0,halt:0,stop:0,af:function(){return this.a<<8|this.f},bc:function(){return this.b<<8|this.c},de:function(){return this.d<<8|this.e},hl:function(){return this.h<<8|this.l},reset:function(){this.m=this.stop=this.halt=this.ime=0;this.a=1;this.f=176;this.b=0;this.c=19;this.d=0;this.e=216;this.h=1;this.l=77;this.sp=65534;this.pc=256}};Z80.ops={xx:function(){throw"garbage instruction!";},map_cb:function(a,b){var c=Z80.cbmap[b.rb(a.pc++)];a.pc&=65535;c(a,b)},ld_bb:function(a){a.m=1},ld_bc:function(a){a.b=a.c;a.m=1},ld_bd:function(a){a.b=a.d;a.m=1},ld_be:function(a){a.b=a.e;a.m=1},ld_bh:function(a){a.b=a.h;a.m=1},ld_bl:function(a){a.b=a.l;a.m=1},ld_ba:function(a){a.b=a.a;a.m=1},ld_cb:function(a){a.c=a.b;a.m=1},ld_cc:function(a){a.m=1},ld_cd:function(a){a.c=a.d;a.m=1},ld_ce:function(a){a.c=a.e;a.m=1},ld_ch:function(a){a.c=a.h;a.m=
1},ld_cl:function(a){a.c=a.l;a.m=1},ld_ca:function(a){a.c=a.a;a.m=1},ld_db:function(a){a.d=a.b;a.m=1},ld_dc:function(a){a.d=a.c;a.m=1},ld_dd:function(a){a.m=1},ld_de:function(a){a.d=a.e;a.m=1},ld_dh:function(a){a.d=a.h;a.m=1},ld_dl:function(a){a.d=a.l;a.m=1},ld_da:function(a){a.d=a.a;a.m=1},ld_eb:function(a){a.e=a.b;a.m=1},ld_ec:function(a){a.e=a.c;a.m=1},ld_ed:function(a){a.e=a.d;a.m=1},ld_ee:function(a){a.m=1},ld_eh:function(a){a.e=a.h;a.m=1},ld_el:function(a){a.e=a.l;a.m=1},ld_ea:function(a){a.e=
a.a;a.m=1},ld_hb:function(a){a.h=a.b;a.m=1},ld_hc:function(a){a.h=a.c;a.m=1},ld_hd:function(a){a.h=a.d;a.m=1},ld_he:function(a){a.h=a.e;a.m=1},ld_hh:function(a){a.m=1},ld_hl:function(a){a.h=a.l;a.m=1},ld_ha:function(a){a.h=a.a;a.m=1},ld_lb:function(a){a.l=a.b;a.m=1},ld_lc:function(a){a.l=a.c;a.m=1},ld_ld:function(a){a.l=a.d;a.m=1},ld_le:function(a){a.l=a.e;a.m=1},ld_lh:function(a){a.l=a.h;a.m=1},ld_ll:function(a){a.m=1},ld_la:function(a){a.l=a.a;a.m=1},ld_ab:function(a){a.a=a.b;a.m=1},ld_ac:function(a){a.a=
a.c;a.m=1},ld_ad:function(a){a.a=a.d;a.m=1},ld_ae:function(a){a.a=a.e;a.m=1},ld_ah:function(a){a.a=a.h;a.m=1},ld_al:function(a){a.a=a.l;a.m=1},ld_aa:function(a){a.m=1},ld_bn:function(a,b){a.b=b.rb(a.pc++);a.m=2},ld_cn:function(a,b){a.c=b.rb(a.pc++);a.m=2},ld_dn:function(a,b){a.d=b.rb(a.pc++);a.m=2},ld_en:function(a,b){a.e=b.rb(a.pc++);a.m=2},ld_hn:function(a,b){a.h=b.rb(a.pc++);a.m=2},ld_ln:function(a,b){a.l=b.rb(a.pc++);a.m=2},ld_an:function(a,b){a.a=b.rb(a.pc++);a.m=2},ld_bhlm:function(a,b){a.b=
b.rb(a.h<<8|a.l);a.m=2},ld_chlm:function(a,b){a.c=b.rb(a.h<<8|a.l);a.m=2},ld_dhlm:function(a,b){a.d=b.rb(a.h<<8|a.l);a.m=2},ld_ehlm:function(a,b){a.e=b.rb(a.h<<8|a.l);a.m=2},ld_hhlm:function(a,b){a.h=b.rb(a.h<<8|a.l);a.m=2},ld_lhlm:function(a,b){a.l=b.rb(a.h<<8|a.l);a.m=2},ld_ahlm:function(a,b){a.a=b.rb(a.h<<8|a.l);a.m=2},ld_hlmb:function(a,b){b.wb(a.h<<8|a.l,a.b);a.m=2},ld_hlmc:function(a,b){b.wb(a.h<<8|a.l,a.c);a.m=2},ld_hlmd:function(a,b){b.wb(a.h<<8|a.l,a.d);a.m=2},ld_hlme:function(a,b){b.wb(a.h<<
8|a.l,a.e);a.m=2},ld_hlmh:function(a,b){b.wb(a.h<<8|a.l,a.h);a.m=2},ld_hlml:function(a,b){b.wb(a.h<<8|a.l,a.l);a.m=2},ld_hlma:function(a,b){b.wb(a.h<<8|a.l,a.a);a.m=2},ld_hlmn:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.pc++));a.m=3},ld_abc:function(a,b){a.a=b.rb(a.b<<8|a.c);a.m=2},ld_ade:function(a,b){a.a=b.rb(a.d<<8|a.e);a.m=2},ld_ann:function(a,b){a.a=b.rb(b.rw(a.pc));a.pc+=2;a.m=4},ld_bca:function(a,b){b.wb(a.b<<8|a.c,a.a);a.m=2},ld_dea:function(a,b){b.wb(a.d<<8|a.e,a.a);a.m=2},ld_nna:function(a,b){b.wb(b.rw(a.pc),
a.a);a.pc+=2;a.m=4},ld_nnsp:function(a,b){b.ww(b.rw(a.pc),a.sp);a.pc+=2;a.m=4},ld_aIOn:function(a,b){a.a=b.rb(65280|b.rb(a.pc++));a.m=3},ld_IOan:function(a,b){b.wb(65280|b.rb(a.pc++),a.a);a.m=3},ld_aIOc:function(a,b){a.a=b.rb(65280|a.c);a.m=2},ld_IOca:function(a,b){b.wb(65280|a.c,a.a);a.m=2},ldi_hlma:function(a,b){b.wb(a.h<<8|a.l,a.a);a.l=a.l+1&255;if(!a.l)a.h=a.h+1&255;a.m=2},ldi_ahlm:function(a,b){a.a=b.rb(a.h<<8|a.l);a.l=a.l+1&255;if(!a.l)a.h=a.h+1&255;a.m=2},ldd_hlma:function(a,b){b.wb(a.h<<8|
a.l,a.a);a.l=a.l-1&255;if(a.l==255)a.h=a.h-1&255;a.m=2},ldd_ahlm:function(a,b){a.a=b.rb(a.h<<8|a.l);a.l=a.l-1&255;if(a.l==255)a.h=a.h-1&255;a.m=2},ld_bcnn:function(a,b){a.c=b.rb(a.pc++);a.b=b.rb(a.pc++);a.m=3},ld_denn:function(a,b){a.e=b.rb(a.pc++);a.d=b.rb(a.pc++);a.m=3},ld_hlnn:function(a,b){a.l=b.rb(a.pc++);a.h=b.rb(a.pc++);a.m=3},ld_spnn:function(a,b){a.sp=b.rw(a.pc);a.pc+=2;a.m=3},ld_sphl:function(a){a.sp=a.h<<8|a.l;a.m=2},push_bc:function(a,b){b.wb(--a.sp,a.b);b.wb(--a.sp,a.c);a.m=4},pop_bc:function(a,
b){a.c=b.rb(a.sp++);a.b=b.rb(a.sp++);a.m=3},push_de:function(a,b){b.wb(--a.sp,a.d);b.wb(--a.sp,a.e);a.m=4},pop_de:function(a,b){a.e=b.rb(a.sp++);a.d=b.rb(a.sp++);a.m=3},push_hl:function(a,b){b.wb(--a.sp,a.h);b.wb(--a.sp,a.l);a.m=4},pop_hl:function(a,b){a.l=b.rb(a.sp++);a.h=b.rb(a.sp++);a.m=3},push_af:function(a,b){b.wb(--a.sp,a.a);b.wb(--a.sp,a.f);a.m=4},pop_af:function(a,b){a.f=b.rb(a.sp++);a.a=b.rb(a.sp++);a.m=3},add_ab:function(a){var b=a.a,c=a.b;a.f=(b&15)+(c&15)>15?32:0;a.f|=b+c>255?16:0;a.a=
b+c&255;a.f|=a.a?0:128;a.m=1},add_ac:function(a){var b=a.a,c=a.c;a.f=(b&15)+(c&15)>15?32:0;a.f|=b+c>255?16:0;a.a=b+c&255;a.f|=a.a?0:128;a.m=1},add_ad:function(a){var b=a.a,c=a.d;a.f=(b&15)+(c&15)>15?32:0;a.f|=b+c>255?16:0;a.a=b+c&255;a.f|=a.a?0:128;a.m=1},add_ae:function(a){var b=a.a,c=a.e;a.f=(b&15)+(c&15)>15?32:0;a.f|=b+c>255?16:0;a.a=b+c&255;a.f|=a.a?0:128;a.m=1},add_ah:function(a){var b=a.a,c=a.h;a.f=(b&15)+(c&15)>15?32:0;a.f|=b+c>255?16:0;a.a=b+c&255;a.f|=a.a?0:128;a.m=1},add_al:function(a){var b=
a.a,c=a.l;a.f=(b&15)+(c&15)>15?32:0;a.f|=b+c>255?16:0;a.a=b+c&255;a.f|=a.a?0:128;a.m=1},add_aa:function(a){var b=a.a,c=a.a;a.f=(b&15)+(c&15)>15?32:0;a.f|=b+c>255?16:0;a.a=b+c&255;a.f|=a.a?0:128;a.m=1},add_ahlm:function(a,b){var c=a.a,d=b.rb(a.h<<8|a.l);a.f=(c&15)+(d&15)>15?32:0;a.f|=c+d>255?16:0;a.a=c+d&255;a.f|=a.a?0:128;a.m=2},add_an:function(a,b){var c=a.a,d=b.rb(a.pc++);a.f=(c&15)+(d&15)>15?32:0;a.f|=c+d>255?16:0;a.a=c+d&255;a.f|=a.a?0:128;a.m=2},adc_ab:function(a){var b=a.a,c=a.b,d=!!(a.f&16);
a.f=(b&15)+(c&15)+d>15?32:0;a.f|=b+c+d>255?16:0;a.a=b+c+d&255;a.f|=a.a?0:128;a.m=1},adc_ac:function(a){var b=a.a,c=a.c,d=!!(a.f&16);a.f=(b&15)+(c&15)+d>15?32:0;a.f|=b+c+d>255?16:0;a.a=b+c+d&255;a.f|=a.a?0:128;a.m=1},adc_ad:function(a){var b=a.a,c=a.d,d=!!(a.f&16);a.f=(b&15)+(c&15)+d>15?32:0;a.f|=b+c+d>255?16:0;a.a=b+c+d&255;a.f|=a.a?0:128;a.m=1},adc_ae:function(a){var b=a.a,c=a.e,d=!!(a.f&16);a.f=(b&15)+(c&15)+d>15?32:0;a.f|=b+c+d>255?16:0;a.a=b+c+d&255;a.f|=a.a?0:128;a.m=1},adc_ah:function(a){var b=
a.a,c=a.h,d=!!(a.f&16);a.f=(b&15)+(c&15)+d>15?32:0;a.f|=b+c+d>255?16:0;a.a=b+c+d&255;a.f|=a.a?0:128;a.m=1},adc_al:function(a){var b=a.a,c=a.l,d=!!(a.f&16);a.f=(b&15)+(c&15)+d>15?32:0;a.f|=b+c+d>255?16:0;a.a=b+c+d&255;a.f|=a.a?0:128;a.m=1},adc_aa:function(a){var b=a.a,c=a.a,d=!!(a.f&16);a.f=(b&15)+(c&15)+d>15?32:0;a.f|=b+c+d>255?16:0;a.a=b+c+d&255;a.f|=a.a?0:128;a.m=1},adc_ahlm:function(a,b){var c=a.a,d=b.rb(a.h<<8|a.l),f=!!(a.f&16);a.f=(c&15)+(d&15)+f>15?32:0;a.f|=c+d+f>255?16:0;a.a=c+d+f&255;a.f|=
a.a?0:128;a.m=2},adc_an:function(a,b){var c=a.a,d=b.rb(a.pc++),f=!!(a.f&16);a.f=(c&15)+(d&15)+f>15?32:0;a.f|=c+d+f>255?16:0;a.a=c+d+f&255;a.f|=a.a?0:128;a.m=2},sub_ab:function(a){var b=a.a,c=a.b;a.f=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a.a=b-c&255;a.f|=a.a?0:128;a.m=1},sub_ac:function(a){var b=a.a,c=a.c;a.f=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a.a=b-c&255;a.f|=a.a?0:128;a.m=1},sub_ad:function(a){var b=a.a,c=a.d;a.f=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a.a=b-c&255;a.f|=a.a?0:128;a.m=1},sub_ae:function(a){var b=
a.a,c=a.e;a.f=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a.a=b-c&255;a.f|=a.a?0:128;a.m=1},sub_ah:function(a){var b=a.a,c=a.h;a.f=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a.a=b-c&255;a.f|=a.a?0:128;a.m=1},sub_al:function(a){var b=a.a,c=a.l;a.f=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a.a=b-c&255;a.f|=a.a?0:128;a.m=1},sub_aa:function(a){var b=a.a,c=a.a;a.f=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a.a=b-c&255;a.f|=a.a?0:128;a.m=1},sub_ahlm:function(a,b){var c=a.a,d=b.rb(a.h<<8|a.l);a.f=64|(c<d?16:0)|((c&15)<(d&15)?32:0);a.a=
c-d&255;a.f|=a.a?0:128;a.m=2},sub_an:function(a,b){var c=a.a,d=b.rb(a.pc++);a.f=64|(c<d?16:0)|((c&15)<(d&15)?32:0);a.a=c-d&255;a.f|=a.a?0:128;a.m=2},sbc_ab:function(a){var b=a.a,c=a.b+!!(a.f&16);a.f=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a.a=b-c&255;a.f|=a.a?0:128;a.m=1},sbc_ac:function(a){var b=a.a,c=a.c+!!(a.f&16);a.f=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a.a=b-c&255;a.f|=a.a?0:128;a.m=1},sbc_ad:function(a){var b=a.a,c=a.d+!!(a.f&16);a.f=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a.a=b-c&255;a.f|=a.a?0:128;a.m=
1},sbc_ae:function(a){var b=a.a,c=a.e+!!(a.f&16);a.f=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a.a=b-c&255;a.f|=a.a?0:128;a.m=1},sbc_ah:function(a){var b=a.a,c=a.h+!!(a.f&16);a.f=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a.a=b-c&255;a.f|=a.a?0:128;a.m=1},sbc_al:function(a){var b=a.a,c=a.l+!!(a.f&16);a.f=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a.a=b-c&255;a.f|=a.a?0:128;a.m=1},sbc_aa:function(a){var b=a.a,c=a.a+!!(a.f&16);a.f=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a.a=b-c&255;a.f|=a.a?0:128;a.m=1},sbc_ahlm:function(a,b){var c=
a.a,d=b.rb(a.h<<8|a.l)+!!(a.f&16);a.f=64|(c<d?16:0)|((c&15)<(d&15)?32:0);a.a=c-d&255;a.f|=a.a?0:128;a.m=2},sbc_an:function(a,b){var c=a.a,d=b.rb(a.pc++)+!!(a.f&16);a.f=64|(c<d?16:0)|((c&15)<(d&15)?32:0);a.a=c-d&255;a.f|=a.a?0:128;a.m=2},and_ab:function(a){a.a&=a.b;a.f=(a.a?0:128)|32;a.m=1},and_ac:function(a){a.a&=a.c;a.f=(a.a?0:128)|32;a.m=1},and_ad:function(a){a.a&=a.d;a.f=(a.a?0:128)|32;a.m=1},and_ae:function(a){a.a&=a.e;a.f=(a.a?0:128)|32;a.m=1},and_ah:function(a){a.a&=a.h;a.f=(a.a?0:128)|32;a.m=
1},and_al:function(a){a.a&=a.l;a.f=(a.a?0:128)|32;a.m=1},and_aa:function(a){a.a&=a.a;a.f=(a.a?0:128)|32;a.m=1},and_ahlm:function(a,b){a.a&=b.rb(a.h<<8|a.l);a.f=(a.a?0:128)|32;a.m=2},and_an:function(a,b){a.a&=b.rb(a.pc++);a.f=(a.a?0:128)|32;a.m=2},xor_ab:function(a){a.a^=a.b;a.f=a.a?0:128;a.m=1},xor_ac:function(a){a.a^=a.c;a.f=a.a?0:128;a.m=1},xor_ad:function(a){a.a^=a.d;a.f=a.a?0:128;a.m=1},xor_ae:function(a){a.a^=a.e;a.f=a.a?0:128;a.m=1},xor_ah:function(a){a.a^=a.h;a.f=a.a?0:128;a.m=1},xor_al:function(a){a.a^=
a.l;a.f=a.a?0:128;a.m=1},xor_aa:function(a){a.a^=a.a;a.f=a.a?0:128;a.m=1},xor_ahlm:function(a,b){a.a^=b.rb(a.h<<8|a.l);a.f=a.a?0:128;a.m=2},xor_an:function(a,b){a.a^=b.rb(a.pc++);a.f=a.a?0:128;a.m=2},or_ab:function(a){a.a|=a.b;a.f=a.a?0:128;a.m=1},or_ac:function(a){a.a|=a.c;a.f=a.a?0:128;a.m=1},or_ad:function(a){a.a|=a.d;a.f=a.a?0:128;a.m=1},or_ae:function(a){a.a|=a.e;a.f=a.a?0:128;a.m=1},or_ah:function(a){a.a|=a.h;a.f=a.a?0:128;a.m=1},or_al:function(a){a.a|=a.l;a.f=a.a?0:128;a.m=1},or_aa:function(a){a.a|=
a.a;a.f=a.a?0:128;a.m=1},or_ahlm:function(a,b){a.a|=b.rb(a.h<<8|a.l);a.f=a.a?0:128;a.m=2},or_an:function(a,b){a.a|=b.rb(a.pc++);a.f=a.a?0:128;a.m=2},cp_ab:function(a){var b=a.a,c=a.b;a.f=64|(b==c?128:0)|(b<c?16:0)|((b&15)<(c&15)?32:0);a.m=1},cp_ac:function(a){var b=a.a,c=a.c;a.f=64|(b==c?128:0)|(b<c?16:0)|((b&15)<(c&15)?32:0);a.m=1},cp_ad:function(a){var b=a.a,c=a.d;a.f=64|(b==c?128:0)|(b<c?16:0)|((b&15)<(c&15)?32:0);a.m=1},cp_ae:function(a){var b=a.a,c=a.e;a.f=64|(b==c?128:0)|(b<c?16:0)|((b&15)<
(c&15)?32:0);a.m=1},cp_ah:function(a){var b=a.a,c=a.h;a.f=64|(b==c?128:0)|(b<c?16:0)|((b&15)<(c&15)?32:0);a.m=1},cp_al:function(a){var b=a.a,c=a.l;a.f=64|(b==c?128:0)|(b<c?16:0)|((b&15)<(c&15)?32:0);a.m=1},cp_aa:function(a){var b=a.a,c=a.a;a.f=64|(b==c?128:0)|(b<c?16:0)|((b&15)<(c&15)?32:0);a.m=1},cp_ahlm:function(a,b){var c=a.a,d=b.rb(a.h<<8|a.l);a.f=64|(c==d?128:0)|(c<d?16:0)|((c&15)<(d&15)?32:0);a.m=2},cp_an:function(a,b){var c=a.a,d=b.rb(a.pc++);a.f=64|(c==d?128:0)|(c<d?16:0)|((c&15)<(d&15)?32:
0);a.m=2},inc_b:function(a){a.b=a.b+1&255;a.f=a.b?0:128;a.m=1},inc_c:function(a){a.c=a.c+1&255;a.f=a.c?0:128;a.m=1},inc_d:function(a){a.d=a.d+1&255;a.f=a.d?0:128;a.m=1},inc_e:function(a){a.e=a.e+1&255;a.f=a.e?0:128;a.m=1},inc_h:function(a){a.h=a.h+1&255;a.f=a.h?0:128;a.m=1},inc_l:function(a){a.l=a.l+1&255;a.f=a.l?0:128;a.m=1},inc_a:function(a){a.a=a.a+1&255;a.f=a.a?0:128;a.m=1},inc_hlm:function(a,b){var c=a.h<<8|a.l,d=b.rb(c)+1&255;b.wb(c,d);a.f=d?0:128;a.m=3},dec_b:function(a){a.b=a.b-1&255;a.f=
a.f&31|64|(a.b?0:128)|((a.b&15)==15)<<5;a.m=1},dec_c:function(a){a.c=a.c-1&255;a.f=a.f&31|64|(a.c?0:128)|((a.c&15)==15)<<5;a.m=1},dec_d:function(a){a.d=a.d-1&255;a.f=a.f&31|64|(a.d?0:128)|((a.d&15)==15)<<5;a.m=1},dec_e:function(a){a.e=a.e-1&255;a.f=a.f&31|64|(a.e?0:128)|((a.e&15)==15)<<5;a.m=1},dec_h:function(a){a.h=a.h-1&255;a.f=a.f&31|64|(a.h?0:128)|((a.h&15)==15)<<5;a.m=1},dec_l:function(a){a.l=a.l-1&255;a.f=a.f&31|64|(a.l?0:128)|((a.l&15)==15)<<5;a.m=1},dec_a:function(a){a.a=a.a-1&255;a.f=a.f&
31|64|(a.a?0:128)|((a.a&15)==15)<<5;a.m=1},dec_hlm:function(a,b){var c=a.h<<8|a.l,d=b.rb(c)-1&255;b.wb(c,d);a.f=(d?0:128)|64;a.m=3},daa:function(a){var b=Z80.daa_table[a.a|a.f<<4];a.a=b>>8;a.f=b&255;a.m=1},cpl:function(a){a.a^=255;a.f|=96;a.m=1},add_hlhl:function(a){var b=a.h<<8|a.l,c=a.h<<8|a.l,d=b+c;a.f&=191;if(d>65535)a.f|=16;else a.f&=239;if((b&4095)+(c&4095)>4095)a.f|=32;a.l=d&255;a.h=d>>8&255;a.m=2},add_hlbc:function(a){var b=a.h<<8|a.l,c=a.b<<8|a.c,d=b+c;a.f&=191;if(d>65535)a.f|=16;else a.f&=
239;if((b&4095)+(c&4095)>4095)a.f|=32;a.l=d&255;a.h=d>>8&255;a.m=2},add_hlde:function(a){var b=a.h<<8|a.l,c=a.d<<8|a.e,d=b+c;a.f&=191;if(d>65535)a.f|=16;else a.f&=239;if((b&4095)+(c&4095)>4095)a.f|=32;a.l=d&255;a.h=d>>8&255;a.m=2},add_hlsp:function(a){var b=a.h<<8|a.l,c=a.sp,d=b+c;a.f&=191;if(d>65535)a.f|=16;else a.f&=239;if((b&4095)+(c&4095)>4095)a.f|=32;a.l=d&255;a.h=d>>8&255;a.m=2},inc_bc:function(a){a.c=a.c+1&255;if(!a.c)a.b=a.b+1&255;a.m=2},dec_bc:function(a){a.c=a.c-1&255;if(a.c==255)a.b=a.b-
1&255;a.m=2},inc_de:function(a){a.e=a.e+1&255;if(!a.e)a.d=a.d+1&255;a.m=2},dec_de:function(a){a.e=a.e-1&255;if(a.e==255)a.d=a.d-1&255;a.m=2},inc_hl:function(a){a.l=a.l+1&255;if(!a.l)a.h=a.h+1&255;a.m=2},dec_hl:function(a){a.l=a.l-1&255;if(a.l==255)a.h=a.h-1&255;a.m=2},inc_sp:function(a){a.sp=a.sp+1&65535;a.m=2},dec_sp:function(a){a.sp=a.sp-1&65535;a.m=2},add_spn:function(a,b){var c=b.rb(a.pc++);a.sp=a.sp+(c>127?(c&127)-128:c)&65535;a.m=4},ld_hlspn:function(a,b){var c=b.rb(a.pc++);c=c>127?(c&127)-
128:c;c+=a.sp;a.h=c>>8&255;a.l=c&255;a.m=3},rlca:function(a){var b=a.a&128?1:0;a.a=a.a<<1&255|b;a.f=(a.a?0:128)|(b?16:0);a.m=1},rla:function(a){var b=a.a&128;a.a=a.a<<1&255|(a.f&16?1:0);a.f=(a.a?0:128)|(b?16:0);a.m=1},rlc_b:function(a){var b=a.b&128?1:0;a.b=a.b<<1&255|b;a.f=(a.b?0:128)|(b?16:0);a.m=2},rl_b:function(a){var b=a.b&128;a.b=a.b<<1&255|(a.f&16?1:0);a.f=(a.b?0:128)|(b?16:0);a.m=2},rlc_c:function(a){var b=a.c&128?1:0;a.c=a.c<<1&255|b;a.f=(a.c?0:128)|(b?16:0);a.m=2},rl_c:function(a){var b=
a.c&128;a.c=a.c<<1&255|(a.f&16?1:0);a.f=(a.c?0:128)|(b?16:0);a.m=2},rlc_d:function(a){var b=a.d&128?1:0;a.d=a.d<<1&255|b;a.f=(a.d?0:128)|(b?16:0);a.m=2},rl_d:function(a){var b=a.d&128;a.d=a.d<<1&255|(a.f&16?1:0);a.f=(a.d?0:128)|(b?16:0);a.m=2},rlc_e:function(a){var b=a.e&128?1:0;a.e=a.e<<1&255|b;a.f=(a.e?0:128)|(b?16:0);a.m=2},rl_e:function(a){var b=a.e&128;a.e=a.e<<1&255|(a.f&16?1:0);a.f=(a.e?0:128)|(b?16:0);a.m=2},rlc_h:function(a){var b=a.h&128?1:0;a.h=a.h<<1&255|b;a.f=(a.h?0:128)|(b?16:0);a.m=
2},rl_h:function(a){var b=a.h&128;a.h=a.h<<1&255|(a.f&16?1:0);a.f=(a.h?0:128)|(b?16:0);a.m=2},rlc_l:function(a){var b=a.l&128?1:0;a.l=a.l<<1&255|b;a.f=(a.l?0:128)|(b?16:0);a.m=2},rl_l:function(a){var b=a.l&128;a.l=a.l<<1&255|(a.f&16?1:0);a.f=(a.l?0:128)|(b?16:0);a.m=2},rlc_a:function(a){var b=a.a&128?1:0;a.a=a.a<<1&255|b;a.f=(a.a?0:128)|(b?16:0);a.m=2},rl_a:function(a){var b=a.a&128;a.a=a.a<<1&255|(a.f&16?1:0);a.f=(a.a?0:128)|(b?16:0);a.m=2},rlc_hlm:function(a,b){var c=b.rb(a.h<<8|a.l),d=c&128?1:
0;c=c<<1&255|d;a.f=(c?0:128)|(d?16:0);b.wb(a.h<<8|a.l,c);a.m=4},rl_hlm:function(a,b){var c=b.rb(a.h<<8|a.l),d=c&128;c=c<<1&255|(a.f&16?1:0);a.f=(c?0:128)|(d?16:0);b.wb(a.h<<8|a.l,c);a.m=4},rrca:function(a){var b=a.a&1;a.a=a.a>>1|b<<7;a.f=(a.a?0:128)|(b?16:0);a.m=1},rra:function(a){var b=a.a&1?16:0;a.a=a.a>>1|(a.f&16?128:0);a.f=(a.a?0:128)|b;a.m=1},rrc_b:function(a){var b=a.b&1;a.b=a.b>>1|b<<7;a.f=(a.b?0:128)|(b?16:0);a.m=2},rr_b:function(a){var b=a.b&1?16:0;a.b=a.b>>1|(a.f&16?128:0);a.f=(a.b?0:128)|
b;a.m=2},rrc_c:function(a){var b=a.c&1;a.c=a.c>>1|b<<7;a.f=(a.c?0:128)|(b?16:0);a.m=2},rr_c:function(a){var b=a.c&1?16:0;a.c=a.c>>1|(a.f&16?128:0);a.f=(a.c?0:128)|b;a.m=2},rrc_d:function(a){var b=a.d&1;a.d=a.d>>1|b<<7;a.f=(a.d?0:128)|(b?16:0);a.m=2},rr_d:function(a){var b=a.d&1?16:0;a.d=a.d>>1|(a.f&16?128:0);a.f=(a.d?0:128)|b;a.m=2},rrc_e:function(a){var b=a.e&1;a.e=a.e>>1|b<<7;a.f=(a.e?0:128)|(b?16:0);a.m=2},rr_e:function(a){var b=a.e&1?16:0;a.e=a.e>>1|(a.f&16?128:0);a.f=(a.e?0:128)|b;a.m=2},rrc_h:function(a){var b=
a.h&1;a.h=a.h>>1|b<<7;a.f=(a.h?0:128)|(b?16:0);a.m=2},rr_h:function(a){var b=a.h&1?16:0;a.h=a.h>>1|(a.f&16?128:0);a.f=(a.h?0:128)|b;a.m=2},rrc_l:function(a){var b=a.l&1;a.l=a.l>>1|b<<7;a.f=(a.l?0:128)|(b?16:0);a.m=2},rr_l:function(a){var b=a.l&1?16:0;a.l=a.l>>1|(a.f&16?128:0);a.f=(a.l?0:128)|b;a.m=2},rrc_a:function(a){var b=a.a&1;a.a=a.a>>1|b<<7;a.f=(a.a?0:128)|(b?16:0);a.m=2},rr_a:function(a){var b=a.a&1?16:0;a.a=a.a>>1|(a.f&16?128:0);a.f=(a.a?0:128)|b;a.m=2},rrc_hlm:function(a,b){var c=b.rb(a.h<<
8|a.l),d=c&1;c=c>>1|d<<7;a.f=(c?0:128)|(d?16:0);b.wb(a.h<<8|a.l,c);a.m=4},rr_hlm:function(a,b){var c=b.rb(a.h<<8|a.l),d=c&1?16:0;c=c>>1|(a.f&16?128:0);a.f=(c?0:128)|d;b.wb(a.h<<8|a.l,c);a.m=4},sla_b:function(a){var b=a.b>>7&1;a.b=a.b<<1&255;a.f=(a.b?0:128)|(b?16:0);a.m=2},sla_c:function(a){var b=a.c>>7&1;a.c=a.c<<1&255;a.f=(a.c?0:128)|(b?16:0);a.m=2},sla_d:function(a){var b=a.d>>7&1;a.d=a.d<<1&255;a.f=(a.d?0:128)|(b?16:0);a.m=2},sla_e:function(a){var b=a.e>>7&1;a.e=a.e<<1&255;a.f=(a.e?0:128)|(b?16:
0);a.m=2},sla_h:function(a){var b=a.h>>7&1;a.h=a.h<<1&255;a.f=(a.h?0:128)|(b?16:0);a.m=2},sla_l:function(a){var b=a.l>>7&1;a.l=a.l<<1&255;a.f=(a.l?0:128)|(b?16:0);a.m=2},sla_a:function(a){var b=a.a>>7&1;a.a=a.a<<1&255;a.f=(a.a?0:128)|(b?16:0);a.m=2},sla_hlm:function(a,b){var c=b.rb(a.h<<8|a.l),d=c>>7&1;c=c<<1&255;a.f=(c?0:128)|(d?16:0);b.wb(a.h<<8|a.l,c);a.m=4},swap_b:function(a){var b=a.b;a.b=(b&15)<<4|(b&240)>>4;a.f=b?0:128;a.m=2},swap_c:function(a){var b=a.c;a.c=(b&15)<<4|(b&240)>>4;a.f=b?0:128;
a.m=2},swap_d:function(a){var b=a.d;a.d=(b&15)<<4|(b&240)>>4;a.f=b?0:128;a.m=2},swap_e:function(a){var b=a.e;a.e=(b&15)<<4|(b&240)>>4;a.f=b?0:128;a.m=2},swap_h:function(a){var b=a.h;a.h=(b&15)<<4|(b&240)>>4;a.f=b?0:128;a.m=2},swap_l:function(a){var b=a.l;a.l=(b&15)<<4|(b&240)>>4;a.f=b?0:128;a.m=2},swap_a:function(a){var b=a.a;a.a=(b&15)<<4|(b&240)>>4;a.f=b?0:128;a.m=2},swap_hlm:function(a,b){var c=b.rb(a.h<<8|a.l);b.wb(a.h<<8|a.l,(c&15)<<4|(c&240)>>4);a.f=c?0:128;a.m=4},sra_b:function(a){var b=a.b,
c=b&1;b=b>>1|b&128;a.f=(b?0:128)|(c?16:0);a.b=b;a.m=2},sra_c:function(a){var b=a.c,c=b&1;b=b>>1|b&128;a.f=(b?0:128)|(c?16:0);a.c=b;a.m=2},sra_d:function(a){var b=a.d,c=b&1;b=b>>1|b&128;a.f=(b?0:128)|(c?16:0);a.d=b;a.m=2},sra_e:function(a){var b=a.e,c=b&1;b=b>>1|b&128;a.f=(b?0:128)|(c?16:0);a.e=b;a.m=2},sra_h:function(a){var b=a.h,c=b&1;b=b>>1|b&128;a.f=(b?0:128)|(c?16:0);a.h=b;a.m=2},sra_l:function(a){var b=a.l,c=b&1;b=b>>1|b&128;a.f=(b?0:128)|(c?16:0);a.l=b;a.m=2},sra_a:function(a){var b=a.a,c=b&
1;b=b>>1|b&128;a.f=(b?0:128)|(c?16:0);a.a=b;a.m=2},sra_hlm:function(a,b){var c=b.rb(a.h<<8|a.l),d=c&1;c=c>>1|c&128;a.f=(c?0:128)|(d?16:0);b.wb(a.h<<8|a.l,c);a.m=4},srl_b:function(a){var b=a.b,c=b&1?16:0;b=b>>1&127;a.f=(b?0:128)|c;a.b=b;a.m=2},srl_c:function(a){var b=a.c,c=b&1?16:0;b=b>>1&127;a.f=(b?0:128)|c;a.c=b;a.m=2},srl_d:function(a){var b=a.d,c=b&1?16:0;b=b>>1&127;a.f=(b?0:128)|c;a.d=b;a.m=2},srl_e:function(a){var b=a.e,c=b&1?16:0;b=b>>1&127;a.f=(b?0:128)|c;a.e=b;a.m=2},srl_h:function(a){var b=
a.h,c=b&1?16:0;b=b>>1&127;a.f=(b?0:128)|c;a.h=b;a.m=2},srl_l:function(a){var b=a.l,c=b&1?16:0;b=b>>1&127;a.f=(b?0:128)|c;a.l=b;a.m=2},srl_a:function(a){var b=a.a,c=b&1?16:0;b=b>>1&127;a.f=(b?0:128)|c;a.a=b;a.m=2},srl_hlm:function(a,b){var c=b.rb(a.h<<8|a.l),d=c&1?16:0;c=c>>1&127;a.f=(c?0:128)|d;b.wb(a.h<<8|a.l,c);a.m=4},bit_0b:function(a){a.f=a.f&16|32|(a.b&1?0:128);a.m=2},bit_0c:function(a){a.f=a.f&16|32|(a.c&1?0:128);a.m=2},bit_0d:function(a){a.f=a.f&16|32|(a.d&1?0:128);a.m=2},bit_0e:function(a){a.f=
a.f&16|32|(a.e&1?0:128);a.m=2},bit_0h:function(a){a.f=a.f&16|32|(a.h&1?0:128);a.m=2},bit_0l:function(a){a.f=a.f&16|32|(a.l&1?0:128);a.m=2},bit_0a:function(a){a.f=a.f&16|32|(a.a&1?0:128);a.m=2},bit_0hlm:function(a,b){var c=b.rb(a.h<<8|a.l)&1;a.f=a.f&16|32|(c?0:128);a.m=3},bit_1b:function(a){a.f=a.f&16|32|(a.b&2?0:128);a.m=2},bit_1c:function(a){a.f=a.f&16|32|(a.c&2?0:128);a.m=2},bit_1d:function(a){a.f=a.f&16|32|(a.d&2?0:128);a.m=2},bit_1e:function(a){a.f=a.f&16|32|(a.e&2?0:128);a.m=2},bit_1h:function(a){a.f=
a.f&16|32|(a.h&2?0:128);a.m=2},bit_1l:function(a){a.f=a.f&16|32|(a.l&2?0:128);a.m=2},bit_1a:function(a){a.f=a.f&16|32|(a.a&2?0:128);a.m=2},bit_1hlm:function(a,b){var c=b.rb(a.h<<8|a.l)&2;a.f=a.f&16|32|(c?0:128);a.m=3},bit_2b:function(a){a.f=a.f&16|32|(a.b&4?0:128);a.m=2},bit_2c:function(a){a.f=a.f&16|32|(a.c&4?0:128);a.m=2},bit_2d:function(a){a.f=a.f&16|32|(a.d&4?0:128);a.m=2},bit_2e:function(a){a.f=a.f&16|32|(a.e&4?0:128);a.m=2},bit_2h:function(a){a.f=a.f&16|32|(a.h&4?0:128);a.m=2},bit_2l:function(a){a.f=
a.f&16|32|(a.l&4?0:128);a.m=2},bit_2a:function(a){a.f=a.f&16|32|(a.a&4?0:128);a.m=2},bit_2hlm:function(a,b){var c=b.rb(a.h<<8|a.l)&4;a.f=a.f&16|32|(c?0:128);a.m=3},bit_3b:function(a){a.f=a.f&16|32|(a.b&8?0:128);a.m=2},bit_3c:function(a){a.f=a.f&16|32|(a.c&8?0:128);a.m=2},bit_3d:function(a){a.f=a.f&16|32|(a.d&8?0:128);a.m=2},bit_3e:function(a){a.f=a.f&16|32|(a.e&8?0:128);a.m=2},bit_3h:function(a){a.f=a.f&16|32|(a.h&8?0:128);a.m=2},bit_3l:function(a){a.f=a.f&16|32|(a.l&8?0:128);a.m=2},bit_3a:function(a){a.f=
a.f&16|32|(a.a&8?0:128);a.m=2},bit_3hlm:function(a,b){var c=b.rb(a.h<<8|a.l)&8;a.f=a.f&16|32|(c?0:128);a.m=3},bit_4b:function(a){a.f=a.f&16|32|(a.b&16?0:128);a.m=2},bit_4c:function(a){a.f=a.f&16|32|(a.c&16?0:128);a.m=2},bit_4d:function(a){a.f=a.f&16|32|(a.d&16?0:128);a.m=2},bit_4e:function(a){a.f=a.f&16|32|(a.e&16?0:128);a.m=2},bit_4h:function(a){a.f=a.f&16|32|(a.h&16?0:128);a.m=2},bit_4l:function(a){a.f=a.f&16|32|(a.l&16?0:128);a.m=2},bit_4a:function(a){a.f=a.f&16|32|(a.a&16?0:128);a.m=2},bit_4hlm:function(a,
b){var c=b.rb(a.h<<8|a.l)&16;a.f=a.f&16|32|(c?0:128);a.m=3},bit_5b:function(a){a.f=a.f&16|32|(a.b&32?0:128);a.m=2},bit_5c:function(a){a.f=a.f&16|32|(a.c&32?0:128);a.m=2},bit_5d:function(a){a.f=a.f&16|32|(a.d&32?0:128);a.m=2},bit_5e:function(a){a.f=a.f&16|32|(a.e&32?0:128);a.m=2},bit_5h:function(a){a.f=a.f&16|32|(a.h&32?0:128);a.m=2},bit_5l:function(a){a.f=a.f&16|32|(a.l&32?0:128);a.m=2},bit_5a:function(a){a.f=a.f&16|32|(a.a&32?0:128);a.m=2},bit_5hlm:function(a,b){var c=b.rb(a.h<<8|a.l)&32;a.f=a.f&
16|32|(c?0:128);a.m=3},bit_6b:function(a){a.f=a.f&16|32|(a.b&64?0:128);a.m=2},bit_6c:function(a){a.f=a.f&16|32|(a.c&64?0:128);a.m=2},bit_6d:function(a){a.f=a.f&16|32|(a.d&64?0:128);a.m=2},bit_6e:function(a){a.f=a.f&16|32|(a.e&64?0:128);a.m=2},bit_6h:function(a){a.f=a.f&16|32|(a.h&64?0:128);a.m=2},bit_6l:function(a){a.f=a.f&16|32|(a.l&64?0:128);a.m=2},bit_6a:function(a){a.f=a.f&16|32|(a.a&64?0:128);a.m=2},bit_6hlm:function(a,b){var c=b.rb(a.h<<8|a.l)&64;a.f=a.f&16|32|(c?0:128);a.m=3},bit_7b:function(a){a.f=
a.f&16|32|(a.b&128?0:128);a.m=2},bit_7c:function(a){a.f=a.f&16|32|(a.c&128?0:128);a.m=2},bit_7d:function(a){a.f=a.f&16|32|(a.d&128?0:128);a.m=2},bit_7e:function(a){a.f=a.f&16|32|(a.e&128?0:128);a.m=2},bit_7h:function(a){a.f=a.f&16|32|(a.h&128?0:128);a.m=2},bit_7l:function(a){a.f=a.f&16|32|(a.l&128?0:128);a.m=2},bit_7a:function(a){a.f=a.f&16|32|(a.a&128?0:128);a.m=2},bit_7hlm:function(a,b){var c=b.rb(a.h<<8|a.l)&128;a.f=a.f&16|32|(c?0:128);a.m=3},set_0b:function(a){a.b|=1;a.m=2},set_0c:function(a){a.c|=
1;a.m=2},set_0d:function(a){a.d|=1;a.m=2},set_0e:function(a){a.e|=1;a.m=2},set_0h:function(a){a.h|=1;a.m=2},set_0l:function(a){a.l|=1;a.m=2},set_0a:function(a){a.a|=1;a.m=2},set_0hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)|1);a.m=4},set_1b:function(a){a.b|=2;a.m=2},set_1c:function(a){a.c|=2;a.m=2},set_1d:function(a){a.d|=2;a.m=2},set_1e:function(a){a.e|=2;a.m=2},set_1h:function(a){a.h|=2;a.m=2},set_1l:function(a){a.l|=2;a.m=2},set_1a:function(a){a.a|=2;a.m=2},set_1hlm:function(a,b){b.wb(a.h<<
8|a.l,b.rb(a.h<<8|a.l)|2);a.m=4},set_2b:function(a){a.b|=4;a.m=2},set_2c:function(a){a.c|=4;a.m=2},set_2d:function(a){a.d|=4;a.m=2},set_2e:function(a){a.e|=4;a.m=2},set_2h:function(a){a.h|=4;a.m=2},set_2l:function(a){a.l|=4;a.m=2},set_2a:function(a){a.a|=4;a.m=2},set_2hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)|4);a.m=4},set_3b:function(a){a.b|=8;a.m=2},set_3c:function(a){a.c|=8;a.m=2},set_3d:function(a){a.d|=8;a.m=2},set_3e:function(a){a.e|=8;a.m=2},set_3h:function(a){a.h|=8;a.m=2},set_3l:function(a){a.l|=
8;a.m=2},set_3a:function(a){a.a|=8;a.m=2},set_3hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)|8);a.m=4},set_4b:function(a){a.b|=16;a.m=2},set_4c:function(a){a.c|=16;a.m=2},set_4d:function(a){a.d|=16;a.m=2},set_4e:function(a){a.e|=16;a.m=2},set_4h:function(a){a.h|=16;a.m=2},set_4l:function(a){a.l|=16;a.m=2},set_4a:function(a){a.a|=16;a.m=2},set_4hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)|16);a.m=4},set_5b:function(a){a.b|=32;a.m=2},set_5c:function(a){a.c|=32;a.m=2},set_5d:function(a){a.d|=
32;a.m=2},set_5e:function(a){a.e|=32;a.m=2},set_5h:function(a){a.h|=32;a.m=2},set_5l:function(a){a.l|=32;a.m=2},set_5a:function(a){a.a|=32;a.m=2},set_5hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)|32);a.m=4},set_6b:function(a){a.b|=64;a.m=2},set_6c:function(a){a.c|=64;a.m=2},set_6d:function(a){a.d|=64;a.m=2},set_6e:function(a){a.e|=64;a.m=2},set_6h:function(a){a.h|=64;a.m=2},set_6l:function(a){a.l|=64;a.m=2},set_6a:function(a){a.a|=64;a.m=2},set_6hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|
a.l)|64);a.m=4},set_7b:function(a){a.b|=128;a.m=2},set_7c:function(a){a.c|=128;a.m=2},set_7d:function(a){a.d|=128;a.m=2},set_7e:function(a){a.e|=128;a.m=2},set_7h:function(a){a.h|=128;a.m=2},set_7l:function(a){a.l|=128;a.m=2},set_7a:function(a){a.a|=128;a.m=2},set_7hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)|128);a.m=4},res_0b:function(a){a.b&=254;a.m=2},res_0c:function(a){a.c&=254;a.m=2},res_0d:function(a){a.d&=254;a.m=2},res_0e:function(a){a.e&=254;a.m=2},res_0h:function(a){a.h&=254;a.m=
2},res_0l:function(a){a.l&=254;a.m=2},res_0a:function(a){a.a&=254;a.m=2},res_0hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)&254);a.m=4},res_1b:function(a){a.b&=253;a.m=2},res_1c:function(a){a.c&=253;a.m=2},res_1d:function(a){a.d&=253;a.m=2},res_1e:function(a){a.e&=253;a.m=2},res_1h:function(a){a.h&=253;a.m=2},res_1l:function(a){a.l&=253;a.m=2},res_1a:function(a){a.a&=253;a.m=2},res_1hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)&253);a.m=4},res_2b:function(a){a.b&=251;a.m=2},res_2c:function(a){a.c&=
251;a.m=2},res_2d:function(a){a.d&=251;a.m=2},res_2e:function(a){a.e&=251;a.m=2},res_2h:function(a){a.h&=251;a.m=2},res_2l:function(a){a.l&=251;a.m=2},res_2a:function(a){a.a&=251;a.m=2},res_2hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)&251);a.m=4},res_3b:function(a){a.b&=247;a.m=2},res_3c:function(a){a.c&=247;a.m=2},res_3d:function(a){a.d&=247;a.m=2},res_3e:function(a){a.e&=247;a.m=2},res_3h:function(a){a.h&=247;a.m=2},res_3l:function(a){a.l&=247;a.m=2},res_3a:function(a){a.a&=247;a.m=2},res_3hlm:function(a,
b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)&247);a.m=4},res_4b:function(a){a.b&=239;a.m=2},res_4c:function(a){a.c&=239;a.m=2},res_4d:function(a){a.d&=239;a.m=2},res_4e:function(a){a.e&=239;a.m=2},res_4h:function(a){a.h&=239;a.m=2},res_4l:function(a){a.l&=239;a.m=2},res_4a:function(a){a.a&=239;a.m=2},res_4hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)&239);a.m=4},res_5b:function(a){a.b&=223;a.m=2},res_5c:function(a){a.c&=223;a.m=2},res_5d:function(a){a.d&=223;a.m=2},res_5e:function(a){a.e&=223;a.m=2},
res_5h:function(a){a.h&=223;a.m=2},res_5l:function(a){a.l&=223;a.m=2},res_5a:function(a){a.a&=223;a.m=2},res_5hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)&223);a.m=4},res_6b:function(a){a.b&=191;a.m=2},res_6c:function(a){a.c&=191;a.m=2},res_6d:function(a){a.d&=191;a.m=2},res_6e:function(a){a.e&=191;a.m=2},res_6h:function(a){a.h&=191;a.m=2},res_6l:function(a){a.l&=191;a.m=2},res_6a:function(a){a.a&=191;a.m=2},res_6hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)&191);a.m=4},res_7b:function(a){a.b&=
127;a.m=2},res_7c:function(a){a.c&=127;a.m=2},res_7d:function(a){a.d&=127;a.m=2},res_7e:function(a){a.e&=127;a.m=2},res_7h:function(a){a.h&=127;a.m=2},res_7l:function(a){a.l&=127;a.m=2},res_7a:function(a){a.a&=127;a.m=2},res_7hlm:function(a,b){b.wb(a.h<<8|a.l,b.rb(a.h<<8|a.l)&127);a.m=4},ccf:function(a){a.f=a.f&128|a.f&16^16;a.m=1},scf:function(a){a.f=a.f&128|16;a.m=1},nop:function(a){a.m=1},halt:function(a){a.halt=1;a.m=1},stop:function(a){a.stop=1;a.m=1;throw"stop";},di:function(a){a.ime=0;a.m=
1},ei:function(a){a.ime=1;a.m=1},jp_nn:function(a,b){a.pc=b.rw(a.pc);a.m=4},jp_hl:function(a){a.pc=a.h<<8|a.l;a.m=1},jp_nz_nn:function(a,b){if(a.f&128){a.pc+=2;a.m=3}else{a.pc=b.rw(a.pc);a.m=4}},jp_z_nn:function(a,b){if(a.f&128){a.pc=b.rw(a.pc);a.m=4}else{a.pc+=2;a.m=3}},jp_nc_nn:function(a,b){if(a.f&16){a.pc+=2;a.m=3}else{a.pc=b.rw(a.pc);a.m=4}},jp_c_nn:function(a,b){if(a.f&16){a.pc=b.rw(a.pc);a.m=4}else{a.pc+=2;a.m=3}},jr_n:function(a,b){var c=b.rb(a.pc++);a.pc+=c>127?(c&127)-128:c;a.m=3},jr_nz_n:function(a,
b){if(a.f&128){a.pc++;a.m=2}else{var c=b.rb(a.pc++);a.pc+=c>127?(c&127)-128:c;a.m=3}},jr_z_n:function(a,b){if(a.f&128){var c=b.rb(a.pc++);a.pc+=c>127?(c&127)-128:c;a.m=3}else{a.pc++;a.m=2}},jr_nc_n:function(a,b){if(a.f&16){a.pc++;a.m=2}else{var c=b.rb(a.pc++);a.pc+=c>127?(c&127)-128:c;a.m=3}},jr_c_n:function(a,b){if(a.f&16){var c=b.rb(a.pc++);a.pc+=c>127?(c&127)-128:c;a.m=3}else{a.pc++;a.m=2}},call_nn:function(a,b){a.sp-=2;b.ww(a.sp,a.pc+2);a.pc=b.rw(a.pc);a.m=6},call_nz_nn:function(a,b){if(a.f&128){a.m=
3;a.pc+=2}else{a.sp-=2;b.ww(a.sp,a.pc+2);a.pc=b.rw(a.pc);a.m=6}},call_z_nn:function(a,b){if(a.f&128){a.sp-=2;b.ww(a.sp,a.pc+2);a.pc=b.rw(a.pc);a.m=6}else{a.m=3;a.pc+=2}},call_nc_nn:function(a,b){if(a.f&16){a.m=3;a.pc+=2}else{a.sp-=2;b.ww(a.sp,a.pc+2);a.pc=b.rw(a.pc);a.m=6}},call_c_nn:function(a,b){if(a.f&16){a.sp-=2;b.ww(a.sp,a.pc+2);a.pc=b.rw(a.pc);a.m=6}else{a.m=3;a.pc+=2}},ret:function(a,b){a.pc=b.rw(a.sp);a.sp+=2;a.m=4},ret_nz:function(a,b){if(a.f&128)a.m=2;else{a.pc=b.rw(a.sp);a.sp+=2;a.m=5}},
ret_z:function(a,b){if(a.f&128){a.pc=b.rw(a.sp);a.sp+=2;a.m=5}else a.m=2},ret_nc:function(a,b){if(a.f&16)a.m=2;else{a.pc=b.rw(a.sp);a.sp+=2;a.m=5}},ret_c:function(a,b){if(a.f&16){a.pc=b.rw(a.sp);a.sp+=2;a.m=5}else a.m=2},reti:function(a,b){a.ime=1;a.pc=b.rw(a.sp);a.sp+=2;a.m=4},rst_00:function(a,b){a.sp-=2;b.ww(a.sp,a.pc);a.pc=0;a.m=4},rst_08:function(a,b){a.sp-=2;b.ww(a.sp,a.pc);a.pc=8;a.m=4},rst_10:function(a,b){a.sp-=2;b.ww(a.sp,a.pc);a.pc=16;a.m=4},rst_18:function(a,b){a.sp-=2;b.ww(a.sp,a.pc);
a.pc=24;a.m=4},rst_20:function(a,b){a.sp-=2;b.ww(a.sp,a.pc);a.pc=32;a.m=4},rst_28:function(a,b){a.sp-=2;b.ww(a.sp,a.pc);a.pc=40;a.m=4},rst_30:function(a,b){a.sp-=2;b.ww(a.sp,a.pc);a.pc=48;a.m=4},rst_38:function(a,b){a.sp-=2;b.ww(a.sp,a.pc);a.pc=56;a.m=4},rst_40:function(a,b){a.sp-=2;b.ww(a.sp,a.pc);a.pc=64;a.m=4},rst_48:function(a,b){a.sp-=2;b.ww(a.sp,a.pc);a.pc=72;a.m=4},rst_50:function(a,b){a.sp-=2;b.ww(a.sp,a.pc);a.pc=80;a.m=4},rst_58:function(a,b){a.sp-=2;b.ww(a.sp,a.pc);a.pc=88;a.m=4},rst_60:function(a,
b){a.sp-=2;b.ww(a.sp,a.pc);a.pc=96;a.m=4}};
Z80.daa_table=[128,256,512,768,1024,1280,1536,1792,2048,2304,4128,4384,4640,4896,5152,5408,4096,4352,4608,4864,5120,5376,5632,5888,6144,6400,8224,8480,8736,8992,9248,9504,8192,8448,8704,8960,9216,9472,9728,9984,10240,10496,12320,12576,12832,13088,13344,13600,12288,12544,12800,13056,13312,13568,13824,14080,14336,14592,16416,16672,16928,17184,17440,17696,16384,16640,16896,17152,17408,17664,17920,18176,18432,18688,20512,20768,21024,21280,21536,21792,20480,20736,20992,21248,21504,21760,22016,22272,22528,
22784,24608,24864,25120,25376,25632,25888,24576,24832,25088,25344,25600,25856,26112,26368,26624,26880,28704,28960,29216,29472,29728,29984,28672,28928,29184,29440,29696,29952,30208,30464,30720,30976,32800,33056,33312,33568,33824,34080,32768,33024,33280,33536,33792,34048,34304,34560,34816,35072,36896,37152,37408,37664,37920,38176,36864,37120,37376,37632,37888,38144,38400,38656,38912,39168,176,304,560,816,1072,1328,144,272,528,784,1040,1296,1552,1808,2064,2320,4144,4400,4656,4912,5168,5424,4112,4368,
4624,4880,5136,5392,5648,5904,6160,6416,8240,8496,8752,9008,9264,9520,8208,8464,8720,8976,9232,9488,9744,1E4,10256,10512,12336,12592,12848,13104,13360,13616,12304,12560,12816,13072,13328,13584,13840,14096,14352,14608,16432,16688,16944,17200,17456,17712,16400,16656,16912,17168,17424,17680,17936,18192,18448,18704,20528,20784,21040,21296,21552,21808,20496,20752,21008,21264,21520,21776,22032,22288,22544,22800,24624,24880,25136,25392,25648,25904,24592,24848,25104,25360,25616,25872,26128,26384,26640,26896,
28720,28976,29232,29488,29744,3E4,28688,28944,29200,29456,29712,29968,30224,30480,30736,30992,32816,33072,33328,33584,33840,34096,32784,33040,33296,33552,33808,34064,34320,34576,34832,35088,36912,37168,37424,37680,37936,38192,36880,37136,37392,37648,37904,38160,38416,38672,38928,39184,41008,41264,41520,41776,42032,42288,40976,41232,41488,41744,42E3,42256,42512,42768,43024,43280,45104,45360,45616,45872,46128,46384,45072,45328,45584,45840,46096,46352,46608,46864,47120,47376,49200,49456,49712,49968,
50224,50480,49168,49424,49680,49936,50192,50448,50704,50960,51216,51472,53296,53552,53808,54064,54320,54576,53264,53520,53776,54032,54288,54544,54800,55056,55312,55568,57392,57648,57904,58160,58416,58672,57360,57616,57872,58128,58384,58640,58896,59152,59408,59664,61488,61744,62E3,62256,62512,62768,61456,61712,61968,62224,62480,62736,62992,63248,63504,63760,176,304,560,816,1072,1328,144,272,528,784,1040,1296,1552,1808,2064,2320,4144,4400,4656,4912,5168,5424,4112,4368,4624,4880,5136,5392,5648,5904,
6160,6416,8240,8496,8752,9008,9264,9520,8208,8464,8720,8976,9232,9488,9744,1E4,10256,10512,12336,12592,12848,13104,13360,13616,12304,12560,12816,13072,13328,13584,13840,14096,14352,14608,16432,16688,16944,17200,17456,17712,16400,16656,16912,17168,17424,17680,17936,18192,18448,18704,20528,20784,21040,21296,21552,21808,20496,20752,21008,21264,21520,21776,22032,22288,22544,22800,24624,24880,25136,25392,25648,25904,1536,1792,2048,2304,2560,2816,3072,3328,3584,3840,4128,4384,4640,4896,5152,5408,5632,5888,
6144,6400,6656,6912,7168,7424,7680,7936,8224,8480,8736,8992,9248,9504,9728,9984,10240,10496,10752,11008,11264,11520,11776,12032,12320,12576,12832,13088,13344,13600,13824,14080,14336,14592,14848,15104,15360,15616,15872,16128,16416,16672,16928,17184,17440,17696,17920,18176,18432,18688,18944,19200,19456,19712,19968,20224,20512,20768,21024,21280,21536,21792,22016,22272,22528,22784,23040,23296,23552,23808,24064,24320,24608,24864,25120,25376,25632,25888,26112,26368,26624,26880,27136,27392,27648,27904,28160,
28416,28704,28960,29216,29472,29728,29984,30208,30464,30720,30976,31232,31488,31744,32E3,32256,32512,32800,33056,33312,33568,33824,34080,34304,34560,34816,35072,35328,35584,35840,36096,36352,36608,36896,37152,37408,37664,37920,38176,38400,38656,38912,39168,39424,39680,39936,40192,40448,40704,176,304,560,816,1072,1328,1552,1808,2064,2320,2576,2832,3088,3344,3600,3856,4144,4400,4656,4912,5168,5424,5648,5904,6160,6416,6672,6928,7184,7440,7696,7952,8240,8496,8752,9008,9264,9520,9744,1E4,10256,10512,10768,
11024,11280,11536,11792,12048,12336,12592,12848,13104,13360,13616,13840,14096,14352,14608,14864,15120,15376,15632,15888,16144,16432,16688,16944,17200,17456,17712,17936,18192,18448,18704,18960,19216,19472,19728,19984,20240,20528,20784,21040,21296,21552,21808,22032,22288,22544,22800,23056,23312,23568,23824,24080,24336,24624,24880,25136,25392,25648,25904,26128,26384,26640,26896,27152,27408,27664,27920,28176,28432,28720,28976,29232,29488,29744,3E4,30224,30480,30736,30992,31248,31504,31760,32016,32272,
32528,32816,33072,33328,33584,33840,34096,34320,34576,34832,35088,35344,35600,35856,36112,36368,36624,36912,37168,37424,37680,37936,38192,38416,38672,38928,39184,39440,39696,39952,40208,40464,40720,41008,41264,41520,41776,42032,42288,42512,42768,43024,43280,43536,43792,44048,44304,44560,44816,45104,45360,45616,45872,46128,46384,46608,46864,47120,47376,47632,47888,48144,48400,48656,48912,49200,49456,49712,49968,50224,50480,50704,50960,51216,51472,51728,51984,52240,52496,52752,53008,53296,53552,53808,
54064,54320,54576,54800,55056,55312,55568,55824,56080,56336,56592,56848,57104,57392,57648,57904,58160,58416,58672,58896,59152,59408,59664,59920,60176,60432,60688,60944,61200,61488,61744,62E3,62256,62512,62768,62992,63248,63504,63760,64016,64272,64528,64784,65040,65296,176,304,560,816,1072,1328,1552,1808,2064,2320,2576,2832,3088,3344,3600,3856,4144,4400,4656,4912,5168,5424,5648,5904,6160,6416,6672,6928,7184,7440,7696,7952,8240,8496,8752,9008,9264,9520,9744,1E4,10256,10512,10768,11024,11280,11536,11792,
12048,12336,12592,12848,13104,13360,13616,13840,14096,14352,14608,14864,15120,15376,15632,15888,16144,16432,16688,16944,17200,17456,17712,17936,18192,18448,18704,18960,19216,19472,19728,19984,20240,20528,20784,21040,21296,21552,21808,22032,22288,22544,22800,23056,23312,23568,23824,24080,24336,24624,24880,25136,25392,25648,25904,192,320,576,832,1088,1344,1600,1856,2112,2368,1088,1344,1600,1856,2112,2368,4160,4416,4672,4928,5184,5440,5696,5952,6208,6464,5184,5440,5696,5952,6208,6464,8256,8512,8768,
9024,9280,9536,9792,10048,10304,10560,9280,9536,9792,10048,10304,10560,12352,12608,12864,13120,13376,13632,13888,14144,14400,14656,13376,13632,13888,14144,14400,14656,16448,16704,16960,17216,17472,17728,17984,18240,18496,18752,17472,17728,17984,18240,18496,18752,20544,20800,21056,21312,21568,21824,22080,22336,22592,22848,21568,21824,22080,22336,22592,22848,24640,24896,25152,25408,25664,25920,26176,26432,26688,26944,25664,25920,26176,26432,26688,26944,28736,28992,29248,29504,29760,30016,30272,30528,
30784,31040,29760,30016,30272,30528,30784,31040,32832,33088,33344,33600,33856,34112,34368,34624,34880,35136,33856,34112,34368,34624,34880,35136,36928,37184,37440,37696,37952,38208,38464,38720,38976,39232,13392,13648,13904,14160,14416,14672,16464,16720,16976,17232,17488,17744,18E3,18256,18512,18768,17488,17744,18E3,18256,18512,18768,20560,20816,21072,21328,21584,21840,22096,22352,22608,22864,21584,21840,22096,22352,22608,22864,24656,24912,25168,25424,25680,25936,26192,26448,26704,26960,25680,25936,
26192,26448,26704,26960,28752,29008,29264,29520,29776,30032,30288,30544,30800,31056,29776,30032,30288,30544,30800,31056,32848,33104,33360,33616,33872,34128,34384,34640,34896,35152,33872,34128,34384,34640,34896,35152,36944,37200,37456,37712,37968,38224,38480,38736,38992,39248,37968,38224,38480,38736,38992,39248,41040,41296,41552,41808,42064,42320,42576,42832,43088,43344,42064,42320,42576,42832,43088,43344,45136,45392,45648,45904,46160,46416,46672,46928,47184,47440,46160,46416,46672,46928,47184,47440,
49232,49488,49744,5E4,50256,50512,50768,51024,51280,51536,50256,50512,50768,51024,51280,51536,53328,53584,53840,54096,54352,54608,54864,55120,55376,55632,54352,54608,54864,55120,55376,55632,57424,57680,57936,58192,58448,58704,58960,59216,59472,59728,58448,58704,58960,59216,59472,59728,61520,61776,62032,62288,62544,62800,63056,63312,63568,63824,62544,62800,63056,63312,63568,63824,208,336,592,848,1104,1360,1616,1872,2128,2384,1104,1360,1616,1872,2128,2384,4176,4432,4688,4944,5200,5456,5712,5968,6224,
6480,5200,5456,5712,5968,6224,6480,8272,8528,8784,9040,9296,9552,9808,10064,10320,10576,9296,9552,9808,10064,10320,10576,12368,12624,12880,13136,13392,13648,13904,14160,14416,14672,13392,13648,13904,14160,14416,14672,16464,16720,16976,17232,17488,17744,18E3,18256,18512,18768,17488,17744,18E3,18256,18512,18768,20560,20816,21072,21328,21584,21840,22096,22352,22608,22864,21584,21840,22096,22352,22608,22864,24656,24912,25168,25424,25680,25936,26192,26448,26704,26960,25680,25936,26192,26448,26704,26960,
28752,29008,29264,29520,29776,30032,30288,30544,30800,31056,29776,30032,30288,30544,30800,31056,32848,33104,33360,33616,33872,34128,34384,34640,34896,35152,33872,34128,34384,34640,34896,35152,36944,37200,37456,37712,37968,38224,38480,38736,38992,39248,37968,38224,38480,38736,38992,39248,64096,64352,64608,64864,65120,65376,192,320,576,832,1088,1344,1600,1856,2112,2368,2656,2912,3168,3424,3680,3936,4160,4416,4672,4928,5184,5440,5696,5952,6208,6464,6752,7008,7264,7520,7776,8032,8256,8512,8768,9024,9280,
9536,9792,10048,10304,10560,10848,11104,11360,11616,11872,12128,12352,12608,12864,13120,13376,13632,13888,14144,14400,14656,14944,15200,15456,15712,15968,16224,16448,16704,16960,17216,17472,17728,17984,18240,18496,18752,19040,19296,19552,19808,20064,20320,20544,20800,21056,21312,21568,21824,22080,22336,22592,22848,23136,23392,23648,23904,24160,24416,24640,24896,25152,25408,25664,25920,26176,26432,26688,26944,27232,27488,27744,28E3,28256,28512,28736,28992,29248,29504,29760,30016,30272,30528,30784,
31040,31328,31584,31840,32096,32352,32608,32832,33088,33344,33600,33856,34112,34368,34624,34880,35136,35424,35680,35936,36192,36448,36704,36928,37184,37440,37696,13392,13648,13904,14160,14416,14672,14960,15216,15472,15728,15984,16240,16464,16720,16976,17232,17488,17744,18E3,18256,18512,18768,19056,19312,19568,19824,20080,20336,20560,20816,21072,21328,21584,21840,22096,22352,22608,22864,23152,23408,23664,23920,24176,24432,24656,24912,25168,25424,25680,25936,26192,26448,26704,26960,27248,27504,27760,
28016,28272,28528,28752,29008,29264,29520,29776,30032,30288,30544,30800,31056,31344,31600,31856,32112,32368,32624,32848,33104,33360,33616,33872,34128,34384,34640,34896,35152,35440,35696,35952,36208,36464,36720,36944,37200,37456,37712,37968,38224,38480,38736,38992,39248,39536,39792,40048,40304,40560,40816,41040,41296,41552,41808,42064,42320,42576,42832,43088,43344,43632,43888,44144,44400,44656,44912,45136,45392,45648,45904,46160,46416,46672,46928,47184,47440,47728,47984,48240,48496,48752,49008,49232,
49488,49744,5E4,50256,50512,50768,51024,51280,51536,51824,52080,52336,52592,52848,53104,53328,53584,53840,54096,54352,54608,54864,55120,55376,55632,55920,56176,56432,56688,56944,57200,57424,57680,57936,58192,58448,58704,58960,59216,59472,59728,60016,60272,60528,60784,61040,61296,61520,61776,62032,62288,62544,62800,63056,63312,63568,63824,64112,64368,64624,64880,65136,65392,208,336,592,848,1104,1360,1616,1872,2128,2384,2672,2928,3184,3440,3696,3952,4176,4432,4688,4944,5200,5456,5712,5968,6224,6480,
6768,7024,7280,7536,7792,8048,8272,8528,8784,9040,9296,9552,9808,10064,10320,10576,10864,11120,11376,11632,11888,12144,12368,12624,12880,13136,13392,13648,13904,14160,14416,14672,14960,15216,15472,15728,15984,16240,16464,16720,16976,17232,17488,17744,18E3,18256,18512,18768,19056,19312,19568,19824,20080,20336,20560,20816,21072,21328,21584,21840,22096,22352,22608,22864,23152,23408,23664,23920,24176,24432,24656,24912,25168,25424,25680,25936,26192,26448,26704,26960,27248,27504,27760,28016,28272,28528,
28752,29008,29264,29520,29776,30032,30288,30544,30800,31056,31344,31600,31856,32112,32368,32624,32848,33104,33360,33616,33872,34128,34384,34640,34896,35152,35440,35696,35952,36208,36464,36720,36944,37200,37456,37712,37968,38224,38480,38736,38992,39248];
Z80.map=[Z80.ops.nop,Z80.ops.ld_bcnn,Z80.ops.ld_bca,Z80.ops.inc_bc,Z80.ops.inc_b,Z80.ops.dec_b,Z80.ops.ld_bn,Z80.ops.rlca,Z80.ops.ld_nnsp,Z80.ops.add_hlbc,Z80.ops.ld_abc,Z80.ops.dec_bc,Z80.ops.inc_c,Z80.ops.dec_c,Z80.ops.ld_cn,Z80.ops.rrca,Z80.ops.stop,Z80.ops.ld_denn,Z80.ops.ld_dea,Z80.ops.inc_de,Z80.ops.inc_d,Z80.ops.dec_d,Z80.ops.ld_dn,Z80.ops.rla,Z80.ops.jr_n,Z80.ops.add_hlde,Z80.ops.ld_ade,Z80.ops.dec_de,Z80.ops.inc_e,Z80.ops.dec_e,Z80.ops.ld_en,Z80.ops.rr_a,Z80.ops.jr_nz_n,Z80.ops.ld_hlnn,Z80.ops.ldi_hlma,
Z80.ops.inc_hl,Z80.ops.inc_h,Z80.ops.dec_h,Z80.ops.ld_hn,Z80.ops.daa,Z80.ops.jr_z_n,Z80.ops.add_hlhl,Z80.ops.ldi_ahlm,Z80.ops.dec_hl,Z80.ops.inc_l,Z80.ops.dec_l,Z80.ops.ld_ln,Z80.ops.cpl,Z80.ops.jr_nc_n,Z80.ops.ld_spnn,Z80.ops.ldd_hlma,Z80.ops.inc_sp,Z80.ops.inc_hlm,Z80.ops.dec_hlm,Z80.ops.ld_hlmn,Z80.ops.scf,Z80.ops.jr_c_n,Z80.ops.add_hlsp,Z80.ops.ldd_ahlm,Z80.ops.dec_sp,Z80.ops.inc_a,Z80.ops.dec_a,Z80.ops.ld_an,Z80.ops.ccf,Z80.ops.ld_bb,Z80.ops.ld_bc,Z80.ops.ld_bd,Z80.ops.ld_be,Z80.ops.ld_bh,Z80.ops.ld_bl,
Z80.ops.ld_bhlm,Z80.ops.ld_ba,Z80.ops.ld_cb,Z80.ops.ld_cc,Z80.ops.ld_cd,Z80.ops.ld_ce,Z80.ops.ld_ch,Z80.ops.ld_cl,Z80.ops.ld_chlm,Z80.ops.ld_ca,Z80.ops.ld_db,Z80.ops.ld_dc,Z80.ops.ld_dd,Z80.ops.ld_de,Z80.ops.ld_dh,Z80.ops.ld_dl,Z80.ops.ld_dhlm,Z80.ops.ld_da,Z80.ops.ld_eb,Z80.ops.ld_ec,Z80.ops.ld_ed,Z80.ops.ld_ee,Z80.ops.ld_eh,Z80.ops.ld_el,Z80.ops.ld_ehlm,Z80.ops.ld_ea,Z80.ops.ld_hb,Z80.ops.ld_hc,Z80.ops.ld_hd,Z80.ops.ld_he,Z80.ops.ld_hh,Z80.ops.ld_hl,Z80.ops.ld_hhlm,Z80.ops.ld_ha,Z80.ops.ld_lb,Z80.ops.ld_lc,
Z80.ops.ld_ld,Z80.ops.ld_le,Z80.ops.ld_lh,Z80.ops.ld_ll,Z80.ops.ld_lhlm,Z80.ops.ld_la,Z80.ops.ld_hlmb,Z80.ops.ld_hlmc,Z80.ops.ld_hlmd,Z80.ops.ld_hlme,Z80.ops.ld_hlmh,Z80.ops.ld_hlml,Z80.ops.halt,Z80.ops.ld_hlma,Z80.ops.ld_ab,Z80.ops.ld_ac,Z80.ops.ld_ad,Z80.ops.ld_ae,Z80.ops.ld_ah,Z80.ops.ld_al,Z80.ops.ld_ahlm,Z80.ops.ld_aa,Z80.ops.add_ab,Z80.ops.add_ac,Z80.ops.add_ad,Z80.ops.add_ae,Z80.ops.add_ah,Z80.ops.add_al,Z80.ops.add_ahlm,Z80.ops.add_aa,Z80.ops.adc_ab,Z80.ops.adc_ac,Z80.ops.adc_ad,Z80.ops.adc_ae,
Z80.ops.adc_ah,Z80.ops.adc_al,Z80.ops.adc_ahlm,Z80.ops.adc_aa,Z80.ops.sub_ab,Z80.ops.sub_ac,Z80.ops.sub_ad,Z80.ops.sub_ae,Z80.ops.sub_ah,Z80.ops.sub_al,Z80.ops.sub_ahlm,Z80.ops.sub_aa,Z80.ops.sbc_ab,Z80.ops.sbc_ac,Z80.ops.sbc_ad,Z80.ops.sbc_ae,Z80.ops.sbc_ah,Z80.ops.sbc_al,Z80.ops.sbc_ahlm,Z80.ops.sbc_aa,Z80.ops.and_ab,Z80.ops.and_ac,Z80.ops.and_ad,Z80.ops.and_ae,Z80.ops.and_ah,Z80.ops.and_al,Z80.ops.and_ahlm,Z80.ops.and_aa,Z80.ops.xor_ab,Z80.ops.xor_ac,Z80.ops.xor_ad,Z80.ops.xor_ae,Z80.ops.xor_ah,
Z80.ops.xor_al,Z80.ops.xor_ahlm,Z80.ops.xor_aa,Z80.ops.or_ab,Z80.ops.or_ac,Z80.ops.or_ad,Z80.ops.or_ae,Z80.ops.or_ah,Z80.ops.or_al,Z80.ops.or_ahlm,Z80.ops.or_aa,Z80.ops.cp_ab,Z80.ops.cp_ac,Z80.ops.cp_ad,Z80.ops.cp_ae,Z80.ops.cp_ah,Z80.ops.cp_al,Z80.ops.cp_ahlm,Z80.ops.cp_aa,Z80.ops.ret_nz,Z80.ops.pop_bc,Z80.ops.jp_nz_nn,Z80.ops.jp_nn,Z80.ops.call_nz_nn,Z80.ops.push_bc,Z80.ops.add_an,Z80.ops.rst_00,Z80.ops.ret_z,Z80.ops.ret,Z80.ops.jp_z_nn,Z80.ops.map_cb,Z80.ops.call_z_nn,Z80.ops.call_nn,Z80.ops.adc_an,
Z80.ops.rst_08,Z80.ops.ret_nc,Z80.ops.pop_de,Z80.ops.jp_nc_nn,Z80.ops.xx,Z80.ops.call_nc_nn,Z80.ops.push_de,Z80.ops.sub_an,Z80.ops.rst_10,Z80.ops.ret_c,Z80.ops.reti,Z80.ops.jp_c_nn,Z80.ops.xx,Z80.ops.call_c_nn,Z80.ops.xx,Z80.ops.sbc_an,Z80.ops.rst_18,Z80.ops.ld_IOan,Z80.ops.pop_hl,Z80.ops.ld_IOca,Z80.ops.xx,Z80.ops.xx,Z80.ops.push_hl,Z80.ops.and_an,Z80.ops.rst_20,Z80.ops.add_spn,Z80.ops.jp_hl,Z80.ops.ld_nna,Z80.ops.xx,Z80.ops.xx,Z80.ops.xx,Z80.ops.xor_an,Z80.ops.rst_28,Z80.ops.ld_aIOn,Z80.ops.pop_af,
Z80.ops.ld_aIOc,Z80.ops.di,Z80.ops.xx,Z80.ops.push_af,Z80.ops.or_an,Z80.ops.rst_30,Z80.ops.ld_hlspn,Z80.ops.ld_sphl,Z80.ops.ld_ann,Z80.ops.ei,Z80.ops.xx,Z80.ops.xx,Z80.ops.cp_an,Z80.ops.rst_38];
Z80.cbmap=[Z80.ops.rlc_b,Z80.ops.rlc_c,Z80.ops.rlc_d,Z80.ops.rlc_e,Z80.ops.rlc_h,Z80.ops.rlc_l,Z80.ops.rlc_hlm,Z80.ops.rlc_a,Z80.ops.rrc_b,Z80.ops.rrc_c,Z80.ops.rrc_d,Z80.ops.rrc_e,Z80.ops.rrc_h,Z80.ops.rrc_l,Z80.ops.rrc_hlm,Z80.ops.rrc_a,Z80.ops.rl_b,Z80.ops.rl_c,Z80.ops.rl_d,Z80.ops.rl_e,Z80.ops.rl_h,Z80.ops.rl_l,Z80.ops.rl_hlm,Z80.ops.rl_a,Z80.ops.rr_b,Z80.ops.rr_c,Z80.ops.rr_d,Z80.ops.rr_e,Z80.ops.rr_h,Z80.ops.rr_l,Z80.ops.rr_hlm,Z80.ops.rr_a,Z80.ops.sla_b,Z80.ops.sla_c,Z80.ops.sla_d,Z80.ops.sla_e,
Z80.ops.sla_h,Z80.ops.sla_l,Z80.ops.sla_hlm,Z80.ops.sla_a,Z80.ops.sra_b,Z80.ops.sra_c,Z80.ops.sra_d,Z80.ops.sra_e,Z80.ops.sra_h,Z80.ops.sra_l,Z80.ops.sra_hlm,Z80.ops.sra_a,Z80.ops.swap_b,Z80.ops.swap_c,Z80.ops.swap_d,Z80.ops.swap_e,Z80.ops.swap_h,Z80.ops.swap_l,Z80.ops.swap_hlm,Z80.ops.swap_a,Z80.ops.srl_b,Z80.ops.srl_c,Z80.ops.srl_d,Z80.ops.srl_e,Z80.ops.srl_h,Z80.ops.srl_l,Z80.ops.srl_hlm,Z80.ops.srl_a,Z80.ops.bit_0b,Z80.ops.bit_0c,Z80.ops.bit_0d,Z80.ops.bit_0e,Z80.ops.bit_0h,Z80.ops.bit_0l,Z80.ops.bit_0hlm,
Z80.ops.bit_0a,Z80.ops.bit_1b,Z80.ops.bit_1c,Z80.ops.bit_1d,Z80.ops.bit_1e,Z80.ops.bit_1h,Z80.ops.bit_1l,Z80.ops.bit_1hlm,Z80.ops.bit_1a,Z80.ops.bit_2b,Z80.ops.bit_2c,Z80.ops.bit_2d,Z80.ops.bit_2e,Z80.ops.bit_2h,Z80.ops.bit_2l,Z80.ops.bit_2hlm,Z80.ops.bit_2a,Z80.ops.bit_3b,Z80.ops.bit_3c,Z80.ops.bit_3d,Z80.ops.bit_3e,Z80.ops.bit_3h,Z80.ops.bit_3l,Z80.ops.bit_3hlm,Z80.ops.bit_3a,Z80.ops.bit_4b,Z80.ops.bit_4c,Z80.ops.bit_4d,Z80.ops.bit_4e,Z80.ops.bit_4h,Z80.ops.bit_4l,Z80.ops.bit_4hlm,Z80.ops.bit_4a,
Z80.ops.bit_5b,Z80.ops.bit_5c,Z80.ops.bit_5d,Z80.ops.bit_5e,Z80.ops.bit_5h,Z80.ops.bit_5l,Z80.ops.bit_5hlm,Z80.ops.bit_5a,Z80.ops.bit_6b,Z80.ops.bit_6c,Z80.ops.bit_6d,Z80.ops.bit_6e,Z80.ops.bit_6h,Z80.ops.bit_6l,Z80.ops.bit_6hlm,Z80.ops.bit_6a,Z80.ops.bit_7b,Z80.ops.bit_7c,Z80.ops.bit_7d,Z80.ops.bit_7e,Z80.ops.bit_7h,Z80.ops.bit_7l,Z80.ops.bit_7hlm,Z80.ops.bit_7a,Z80.ops.res_0b,Z80.ops.res_0c,Z80.ops.res_0d,Z80.ops.res_0e,Z80.ops.res_0h,Z80.ops.res_0l,Z80.ops.res_0hlm,Z80.ops.res_0a,Z80.ops.res_1b,
Z80.ops.res_1c,Z80.ops.res_1d,Z80.ops.res_1e,Z80.ops.res_1h,Z80.ops.res_1l,Z80.ops.res_1hlm,Z80.ops.res_1a,Z80.ops.res_2b,Z80.ops.res_2c,Z80.ops.res_2d,Z80.ops.res_2e,Z80.ops.res_2h,Z80.ops.res_2l,Z80.ops.res_2hlm,Z80.ops.res_2a,Z80.ops.res_3b,Z80.ops.res_3c,Z80.ops.res_3d,Z80.ops.res_3e,Z80.ops.res_3h,Z80.ops.res_3l,Z80.ops.res_3hlm,Z80.ops.res_3a,Z80.ops.res_4b,Z80.ops.res_4c,Z80.ops.res_4d,Z80.ops.res_4e,Z80.ops.res_4h,Z80.ops.res_4l,Z80.ops.res_4hlm,Z80.ops.res_4a,Z80.ops.res_5b,Z80.ops.res_5c,
Z80.ops.res_5d,Z80.ops.res_5e,Z80.ops.res_5h,Z80.ops.res_5l,Z80.ops.res_5hlm,Z80.ops.res_5a,Z80.ops.res_6b,Z80.ops.res_6c,Z80.ops.res_6d,Z80.ops.res_6e,Z80.ops.res_6h,Z80.ops.res_6l,Z80.ops.res_6hlm,Z80.ops.res_6a,Z80.ops.res_7b,Z80.ops.res_7c,Z80.ops.res_7d,Z80.ops.res_7e,Z80.ops.res_7h,Z80.ops.res_7l,Z80.ops.res_7hlm,Z80.ops.res_7a,Z80.ops.set_0b,Z80.ops.set_0c,Z80.ops.set_0d,Z80.ops.set_0e,Z80.ops.set_0h,Z80.ops.set_0l,Z80.ops.set_0hlm,Z80.ops.set_0a,Z80.ops.set_1b,Z80.ops.set_1c,Z80.ops.set_1d,
Z80.ops.set_1e,Z80.ops.set_1h,Z80.ops.set_1l,Z80.ops.set_1hlm,Z80.ops.set_1a,Z80.ops.set_2b,Z80.ops.set_2c,Z80.ops.set_2d,Z80.ops.set_2e,Z80.ops.set_2h,Z80.ops.set_2l,Z80.ops.set_2hlm,Z80.ops.set_2a,Z80.ops.set_3b,Z80.ops.set_3c,Z80.ops.set_3d,Z80.ops.set_3e,Z80.ops.set_3h,Z80.ops.set_3l,Z80.ops.set_3hlm,Z80.ops.set_3a,Z80.ops.set_4b,Z80.ops.set_4c,Z80.ops.set_4d,Z80.ops.set_4e,Z80.ops.set_4h,Z80.ops.set_4l,Z80.ops.set_4hlm,Z80.ops.set_4a,Z80.ops.set_5b,Z80.ops.set_5c,Z80.ops.set_5d,Z80.ops.set_5e,
Z80.ops.set_5h,Z80.ops.set_5l,Z80.ops.set_5hlm,Z80.ops.set_5a,Z80.ops.set_6b,Z80.ops.set_6c,Z80.ops.set_6d,Z80.ops.set_6e,Z80.ops.set_6h,Z80.ops.set_6l,Z80.ops.set_6hlm,Z80.ops.set_6a,Z80.ops.set_7b,Z80.ops.set_7c,Z80.ops.set_7d,Z80.ops.set_7e,Z80.ops.set_7h,Z80.ops.set_7l,Z80.ops.set_7hlm,Z80.ops.set_7a];JBA.Memory=function(){this.rtc=new JBA.RTC;this.input=new JBA.Input(this);this.reset()};JBA.Memory.MBC={UNKNOWN:-1,NONE:0,MBC1:1,MBC2:2,MBC3:3};
JBA.Memory.prototype={gpu:null,rtc:null,input:null,timer:null,mbc:JBA.Memory.MBC.UNKNOWN,rom:[],ram:[],wram:[],hiram:[],rombank:1,rambank:0,wrambank:1,ramon:0,mode:0,_ie:0,_if:0,reset:function(){this.rtc.reset();this.input.reset();this.rom=[];this.ram=[];this.wram=[];this.hiram=[];this.rombank=1;this.rambank=0;this.wrambank=1;for(var a=this.mode=this.ramon=0;a<65535;a++){this.ram[a]=0;this.wram[a]=0}for(a=0;a<255;a++)this.hiram[a]=0},powerOn:function(){this.wb(65285,0);this.wb(65286,0);this.wb(65287,
0);this.wb(65296,128);this.wb(65297,191);this.wb(65298,243);this.wb(65300,191);this.wb(65302,63);this.wb(65303,0);this.wb(65305,191);this.wb(65306,127);this.wb(65307,255);this.wb(65308,159);this.wb(65310,191);this.wb(65312,255);this.wb(65313,0);this.wb(65314,0);this.wb(65315,191);this.wb(65316,119);this.wb(65317,243);this.wb(65318,241);this.wb(65344,145);this.wb(65346,0);this.wb(65347,0);this.wb(65349,0);this.wb(65351,252);this.wb(65352,255);this.wb(65353,255);this.wb(65354,0);this.wb(65355,0);this.wb(65535,
0)},load_cartridge:function(a){if(typeof a=="string")for(var b=0;b<a.length;b++)this.rom[b]=a.charCodeAt(b)&255;else for(b in a)this.rom[b]=a[b];switch(this.rom[327]){case 0:case 8:case 9:this.mbc=JBA.Memory.MBC.NONE;break;case 1:case 2:case 3:this.mbc=JBA.Memory.MBC.MBC1;break;case 5:case 6:this.mbc=JBA.Memory.MBC.MBC2;break;case 15:case 16:case 17:case 18:case 19:this.mbc=JBA.Memory.MBC.MBC3;break;default:throw"Unknown/unimplemented MBC type: "+this.rom[327];}},rw:function(a){return this.rb(a)|
this.rb(a+1)<<8},ww:function(a,b){this.wb(a,b&255);this.wb(a+1,b>>8)},rb:function(a){switch(a>>12){case 0:case 1:case 2:case 3:return this.rom[a];case 4:case 5:case 6:case 7:return this.rom[this.rombank<<14|a&16383];case 8:case 9:return this.gpu.vram[a&8191];case 10:case 11:if(this.ramon)return this.rtc.current&8?this.rtc.regs[this.rtc.current&7]:this.ram[this.rambank<<13|a&8191];else break;case 12:case 14:return this.wram[a&4095];case 13:return this.wram[this.wrambank<<12|a&4095];case 15:if(a<65024)return this.rb(a&
57343);else if(a<65184)return this.gpu.oam[a&255];else if(!(a<65280))return a<65408?this.ioreg_rb(a):a<65535?this.hiram[a&255]:this._ie}return 255},ioreg_rb:function(a){switch(a>>4&15){case 0:switch(a&15){case 0:return this.input.rb(a);case 4:return this.timer.div;case 5:return this.timer.tima;case 6:return this.timer.tma;case 7:return this.timer.tac;case 15:return this._if;default:return 255}case 1:case 2:case 3:return 255;case 4:case 5:case 6:case 7:return this.gpu.rb(a);default:throw"Not implemented reading that address!";
}},wb:function(a,b){switch(a>>12){case 0:case 1:switch(this.mbc){case JBA.Memory.MBC.MBC1:case JBA.Memory.MBC.MBC3:this.ramon=(b&15)==10?1:0;break;case JBA.Memory.MBC.MBC2:a&256||(this.ramon^=1)}break;case 2:case 3:switch(this.mbc){case JBA.Memory.MBC.MBC1:this.rombank=this.rombank&96|b&31;if(this.rombank==0)this.rombank=1;break;case JBA.Memory.MBC.MBC2:if(a&256)this.rombank=b&15;break;case JBA.Memory.MBC.MBC3:b&=127;this.rombank=b+!b}break;case 4:case 5:switch(this.mbc){case JBA.Memory.MBC.MBC1:if(this.mode==
0)this.rombank=this.rombank&31|(b&3)<<5;else this.rambank=b&3;break;case JBA.Memory.MBC.MBC3:this.rtc.current=b&15;this.rambank=b&3}break;case 6:case 7:switch(this.mbc){case JBA.Memory.MBC.MBC1:this.mode=b&1;break;case JBA.Memory.MBC.MBC3:this.rtc.latch(b)}break;case 8:case 9:this.gpu.vram[a&8191]=b;break;case 10:case 11:if(this.ramon)if(this.rtc.current&8)this.rtc.wb(b);else{if(this.mbc==JBA.Memory.MBC.MBC2)b&=15;this.ram[this.rambank<<13|a&8191]=b}break;case 12:case 14:this.wram[a&4095]=b;break;
case 13:this.wram[this.wrambank<<12|a&4095]=b;break;case 15:if(a<65024)this.wb(a&57343,b);else if(a<65184)this.gpu.oam[a&255]=b;else if(!(a<65280))if(a<65408)this.ioreg_wb(a,b);else if(a<65535)this.hiram[a&255]=b;else this._ie=b}},ioreg_wb:function(a,b){switch(a>>4&15){case 0:switch(a&15){case 0:this.input.wb(a,b);break;case 4:this.timer.div=0;break;case 5:this.timer.tima=b;break;case 6:this.timer.tma=b;break;case 7:this.timer.tac=b;this.timer.update();break;case 15:this._if=b}break;case 1:case 2:case 3:break;
case 4:case 5:case 6:case 7:this.gpu.wb(a,b);break;default:throw"Not implemented writing that address!";}}};JBA.CPU=function(){this.registers=new Z80.Registers;this.reset()};JBA.CPU.Interrupts=[];(function(){function a(c,d){return function(f,g){f.ime=0;f.halt=0;g._if&=~c&255;d(f,g)}}for(var b=0;b<32;b++)JBA.CPU.Interrupts[b]=b&1?a(1,Z80.ops.rst_40):b&2?a(2,Z80.ops.rst_48):b&4?a(4,Z80.ops.rst_50):b&8?a(8,Z80.ops.rst_58):b&16?a(16,Z80.ops.rst_60):function(){}})();
JBA.CPU.prototype={memory:null,ticks:0,reset:function(){this.ticks=0;this.registers.reset()},exec:function(){var a=this.registers,b=this.memory;if(a.halt==0){var c=b.rb(a.pc++);Z80.map[c](a,b)}else a.m=1;c=a.m*4;a.m=0;if(a.ime){JBA.CPU.Interrupts[b._if&b._ie](a,b);c+=a.m*4}this.ticks+=c;b.timer&&b.timer.step(c/4);return c}};JBA.Input=function(a){this.memory=a};JBA.Input.SEL={BUTTON:32,DIRECTION:16};JBA.Input.Map={buttons:{90:14,88:13,13:7,188:11},directions:{37:13,38:11,39:14,40:7}};
JBA.Input.prototype={col:0,memory:null,buttons:15,directions:15,reset:function(){this.col=0;this.directions=this.buttons=15},rb:function(){switch(this.col){case JBA.Input.SEL.BUTTON:return this.buttons;case JBA.Input.SEL.DIRECTION:return this.directions;default:return 15}},wb:function(a,b){this.col=~b&48},keydown:function(a){var b=true,c=JBA.Input.Map.directions[a];if(c){this.directions&=c;this.memory._if|=16;b=false}if(c=JBA.Input.Map.buttons[a]){this.buttons&=c;this.memory._if|=16;b=false}return b},
keyup:function(a){var b=true,c=JBA.Input.Map.directions[a];if(c){this.directions|=~c&15;b=false}if(c=JBA.Input.Map.buttons[a]){this.buttons|=~c&15;b=false}return b}};JBA.Timer=function(){this.reset()};
JBA.Timer.prototype={memory:null,_clock:{tima:0,div:0},div:0,tima:0,tma:0,tac:0,_tima_speed:256,reset:function(){this.tac=this.tma=this.tima=this.div=0;this._clock.tima=0;this._clock.div=0},update:function(){switch(this.tac&3){case 0:this._tima_speed=256;break;case 1:this._tima_speed=4;break;case 2:this._tima_speed=16;break;case 3:this._tima_speed=64}},step:function(a){this._clock.div+=a;for(this._clock.tima+=a;this._clock.div>=64;){this.div=this.div+1&255;this._clock.div-=64}for(a=this.tac&4;a&&
this._clock.tima>=this._tima_speed;){this.tima++;if(this.tima>=255){this.tima=this.tma;this.memory._if|=4}this._clock.tima-=this._tima_speed}}};
