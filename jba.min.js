var JBA=function(){this.cpu=new JBA.CPU;this.memory=new JBA.Memory;this.gpu=new JBA.GPU;this.timer=new JBA.Timer;this.cpu.memory=this.memory;this.gpu.mem=this.memory;this.memory.gpu=this.gpu;this.memory.timer=this.timer;this.timer.memory=this.memory;this.memory.powerOn()};
JBA.prototype={cpu:null,memory:null,gpu:null,timer:null,fps:0,reset:function(){this.cpu.reset();this.memory.reset();this.gpu.reset();this.timer.reset();this.gpu.white_canvas();this.memory.powerOn()},exec:function(){var b=this.cpu.exec();this.gpu.step(b);return b},frame:function(){var b=this.cpu,c=this.gpu,a=70224,d=0;do d=b.exec(),c.step(d),a-=d;while(a>0);this.fps++},load_rom:function(b){this.memory.load_cartridge(b)},keydown:function(b){this.memory.input.keydown(b)},keyup:function(b){this.memory.input.keyup(b)},
set_canvas:function(b){this.gpu.set_canvas(b)},frames_count:function(){var b=this.fps;this.fps=0;return b},snapshot:function(){var b=new JBA.StringIO;this.memory.serialize(b);this.gpu.serialize(b);this.cpu.serialize(b);this.timer.serialize(b);return b.data},load_snapshot:function(b){b=new JBA.StringIO(b);this.memory.deserialize(b);this.gpu.deserialize(b);this.cpu.deserialize(b);this.timer.deserialize(b);if(!b.eof())throw"Invalid snapshot!";},ram_image:function(){if(!this.memory.battery)return"";for(var b=
new JBA.StringIO,c=this.memory.ram,a=this.memory.ram_size(),d=0;d<a;d++)b.wb(c[d]);return b.data},load_ram_image:function(b){if(!this.memory.battery)return"";for(var b=new JBA.StringIO(b),c=this.memory.ram,a=this.memory.ram_size(),d=0;d<a;d++)c[d]=b.rb();if(!b.eof())throw"Bad ram image";}};function Serializable(){}Serializable.prototype.serialize=function(){};Serializable.prototype.deserialize=function(){};JBA.RTC=function(){this.reset()};
JBA.RTC.prototype={s:0,m:0,h:0,d:0,t:0,carry:0,current:0,regs:[],stop:0,_readylatch:0,reset:function(){this.stop=this.current=0;this.regs=[];for(var b=0;b<8;b++)this.regs[b]=0;this.t=this.s=this.m=this.h=this.d=this.carry=this._readylatch=0},latch:function(b){if(this._readylatch){if(b==1)this.regs[0]=this.s,this.regs[1]=this.m,this.regs[2]=this.h,this.regs[3]=this.d&255,this.regs[4]=this.d>>8|this.stop<<6|this.carry<<7,this.regs[5]=this.regs[6]=this.regs[7]=255;this._readylatch=0}else this._readylatch=
b==0?1:0},wb:function(b){switch(this.current&7){case 0:this.s=this.regs[0]=b%60;break;case 1:this.m=this.regs[1]=b%60;break;case 2:this.h=this.regs[2]=b%24;break;case 3:this.regs[3]=b;this.d=this.d&256|b;break;case 4:this.regs[4]=b,this.d=this.d&255|(b&1)<<8,this.stop=b>>6&1,this.carry=b>>7&1}},step:function(){if(!this.stop&&++this.t>=60){if(++this.s>=60){if(++this.m>=60){if(++this.h>=24){if(++this.d>=365)this.d=0,this.carry=1;this.h=0}this.m=0}this.s=0}this.t=0}}};JBA.GPU=function(){this.reset()};var VRAM_SIZE=8192,OAM_SIZE=160,CGB_BP_SIZE=64,NUM_TILES=384;JBA.GPU.Mode={HBLANK:0,VBLANK:1,RDOAM:2,RDVRAM:3};JBA.GPU.Palette=[[255,255,255,255],[192,192,192,255],[96,96,96,255],[0,0,0,255]];
JBA.GPU.prototype={mem:null,vram:null,oam:null,canvas:null,image:null,vrambanks:null,vrambank:0,clock:0,lcdon:0,winmap:0,winon:0,tiledata:0,bgmap:0,objsize:0,objon:0,bgon:0,lycly:0,mode2int:0,mode1int:0,mode0int:0,mode:JBA.GPU.Mode.RDOAM,scy:0,scx:0,ly:0,lyc:0,bgp:0,obp0:0,obp1:0,wy:0,wx:0,hdma_src:0,hdma_dst:0,hdma5:0,_pal:{bg:Array(4),obp0:Array(4),obp1:Array(4)},_tiles:{data:Array(NUM_TILES*2),need_update:!1,to_update:Array(NUM_TILES*2)},cgb:{bgp:new Uint8Array(CGB_BP_SIZE),obp:new Uint8Array(CGB_BP_SIZE),
bgpi:0,obpi:0,_bgp:[],_obp:[]},reset:function(){var b,c;this.vrambank=0;this.vrambanks=[new Uint8Array(VRAM_SIZE),new Uint8Array(VRAM_SIZE)];this.oam=new Uint8Array(OAM_SIZE);for(b=0;b<VRAM_SIZE;b++)this.vrambanks[0][b]=0,this.vrambanks[1][b]=0;this.vram=this.vrambanks[0];for(b=0;b<OAM_SIZE;b++)this.oam[b]=0;for(b=0;b<NUM_TILES*2;b++){this._tiles.data[b]=[];this._tiles.to_update[b]=!1;for(c=0;c<8;c++)this._tiles.data[b][c]=[0,0,0,0,0,0,0,0]}this._tiles.need_update=!1;for(b=0;b<CGB_BP_SIZE;b++)this.cgb.bgp[b]=
255,this.cgb.obp[b]=0;for(b=0;b<8;b++){this.cgb._bgp[b]=[];this.cgb._obp[b]=[];for(c=0;c<4;c++)this.cgb._bgp[b][c]=[255,255,255,255],this.cgb._obp[b][c]=[0,0,0,255]}this.cgb.bgpi=0;this.cgb.obpi=0;this.mode=JBA.GPU.Mode.RDOAM;this.hdma_src=this.hdma_dst=this.hdma5=this.clock=this.winon=this.winmap=this.lcdon=this.bgon=this.objon=this.objsize=this.bgmap=this.tiledata=this.mode0int=this.mode1int=this.mode2int=this.lycly=this.lyc=this.ly=this.scx=this.scy=this.wx=this.wy=this.obp1=this.obp0=this.bgp=
0;this.canvas&&this.white_canvas()},serialize:function(b){var c;for(c=0;c<VRAM_SIZE;c++)b.wb(this.vrambanks[0][c]);for(c=0;c<VRAM_SIZE;c++)b.wb(this.vrambanks[1][c]);for(c=0;c<OAM_SIZE;c++)b.wb(this.oam[c]);for(c=0;c<CGB_BP_SIZE;c++)b.wb(this.cgb.bgp[c]),b.wb(this.cgb.obp[c]);b.wb(this.mode);b.wb(this.wx+7);b.wb(this.wy);b.wb(this.obp0);b.wb(this.obp1);b.wb(this.bgp);b.wb(this.scx);b.wb(this.scy);b.wb(this.ly);b.wb(this.lyc);b.wb(this.lycly);b.wb(this.mode0int);b.wb(this.mode1int);b.wb(this.mode2int);
b.wb(this.bgon);b.wb(this.objon);b.wb(this.objsize);b.wb(this.bgmap);b.wb(this.tiledata);b.wb(this.winon);b.wb(this.winmap);b.wb(this.lcdon);b.ww(this.clock);b.ww(this.hdma_src);b.ww(this.hdma_dst);b.wb(this.hdma5);b.wb(this.cgb.bgpi);b.wb(this.cgb.obpi);b.wb(this.vrambank)},deserialize:function(b){var c;for(c=0;c<VRAM_SIZE;c++)this.vrambanks[0][c]=b.rb();for(c=0;c<VRAM_SIZE;c++)this.vrambanks[1][c]=b.rb();for(c=0;c<OAM_SIZE;c++)this.oam[c]=b.rb();for(c=0;c<CGB_BP_SIZE;c++)this.cgb.bgp[c]=b.rb(),
this.cgb.obp[c]=b.rb();this.mode=b.rb();this.wx=b.rb()-7;this.wy=b.rb();this.obp0=b.rb();this.obp1=b.rb();this.bgp=b.rb();this.scx=b.rb();this.scy=b.rb();this.ly=b.rb();this.lyc=b.rb();this.lycly=b.rb();this.mode0int=b.rb();this.mode1int=b.rb();this.mode2int=b.rb();this.bgon=b.rb();this.objon=b.rb();this.objsize=b.rb();this.bgmap=b.rb();this.tiledata=b.rb();this.winon=b.rb();this.winmap=b.rb();this.lcdon=b.rb();this.clock=b.rw();this.hdma_src=b.rw();this.hdma_dst=b.rw();this.hdma5=b.rb();this.cgb.bgpi=
b.rb();this.cgb.obpi=b.rb();this.vrambank=b.rb();this.vram=this.vrambanks[this.vrambank];this.update_palette(this._pal.bg,this.bgp);this.update_palette(this._pal.obp0,this.obp0);this.update_palette(this._pal.obp1,this.obp1);this.update_cgb_palette(this.cgb._bgp,this.cgb.bgp,this.cgb.bgpi);this.update_cgb_palette(this.cgb._obp,this.cgb.obp,this.cgb.obpi);for(c=0;c<NUM_TILES*2;c++)this._tiles.to_update[c]=!0;this._tiles.needs_update=!0;this.update_tileset()},set_canvas:function(b){this.canvas=b.getContext("2d");
this.image=this.canvas.createImageData(160,144);this.white_canvas()},white_canvas:function(){for(var b=0;b<this.image.data.length;b++)this.image.data[b]=255;this.canvas.putImageData(this.image,0,0)},switch_mode0:function(){this.mode=JBA.GPU.Mode.HBLANK;this.render_line();this.mode0int&&(this.mem._if|=JBA.INT.LCDSTAT)},switch_mode1:function(){this.mode=JBA.GPU.Mode.VBLANK;this.canvas!=null&&this.canvas.putImageData(this.image,0,0);this.mem._if|=JBA.INT.VBLANK;this.mode1int&&(this.mem._if|=JBA.INT.LCDSTAT)},
switch_mode2:function(){this.mode=JBA.GPU.Mode.RDOAM;this.mode2int&&(this.mem._if|=JBA.INT.LCDSTAT)},switch_mode3:function(){this.mode=JBA.GPU.Mode.RDVRAM},step:function(b){b=this.clock+b;if(b>=456)b-=456,this.ly=(this.ly+1)%154,this.ly>=144&&this.mode!=JBA.GPU.Mode.VBLANK&&this.switch_mode1(),this.ly==this.lyc&&this.lycly&&(this.mem._if|=JBA.INT.LCDSTAT);this.ly<144&&(b<=80?this.mode!=JBA.GPU.Mode.RDOAM&&this.switch_mode2():b<=252?this.mode!=JBA.GPU.Mode.RDVRAM&&this.switch_mode3():this.mode!=JBA.GPU.Mode.HBLANK&&
this.switch_mode0());this.clock=b},render_line:function(){if(this.lcdon!=0){var b=[];if(this._tiles.need_update)this.update_tileset(),this._tiles.need_update=!1;this.bgon&&this.render_background(b);this.winon&&this.render_window(b);this.objon&&this.render_sprites(b)}},update_tileset:function(){for(var b=this._tiles.to_update,c=this._tiles.data,a=this.vram,d=0;d<NUM_TILES;d++)if(b[d]){b[d]=!1;for(var f=d*16,g=0;g<8;g++,f+=2)for(var p=a[f],q=a[f+1],j=7;j>=0;j--)c[d][g][j]=(q&1)<<1|p&1,p>>=1,q>>=1}},
render_background:function(b){var c=this.image.data,a=this.vrambanks[0],d=this.vrambanks[1],f=this._pal.bg,g=this.mem.cgb,p=this.mem.sgb,q=this.mem.input.sgb.sgb_pals,j=this.mem.input.sgb.sgbatf,s=this._tiles.data,n=this.bgmap?7168:6144;n+=((this.ly+this.scy&255)>>3)*32;var i=(this.ly+this.scy)%8,k=this.scx%8,h=this.ly*640,e=0,t=this.tiledata==0?128:0;do{var l=(e+this.scx&255)>>3,r=a[n+l];this.tiledata==0&&(r=r+128&255);var o=0,m=0;g?(m=d[n+l],r=s[t+r+(m>>3&1)*NUM_TILES],f=this.cgb._bgp[m&7],o=m&
128,r=r[m&64?7-i:i],m&=32):r=s[t+r][i];for(;k<8&&e<160;k++,e++,h+=4){var l=r[m?7-k:k],u;if(p&&!g){var v=j[(e>>3)+(this.ly>>3)*20];switch(f[l][0]){case 0:u=q[v][3];break;case 96:u=q[v][2];break;case 192:u=q[v][1];break;case 255:u=q[v][0]}}else u=f[l];b[e]=o?4:l;c[h]=u[0];c[h+1]=u[1];c[h+2]=u[2];c[h+3]=u[3]}k=0}while(e<160)},render_window:function(b){if(!(this.wy>=144||this.wx>=160)){var c=this.image.data,a=this.vrambanks,d=this._pal.bg,f=this.mem.cgb,g=this.mem.sgb,p=this.mem.input.sgb.sgb_pals,q=
this.mem.input.sgb.sgbatf,j=this._tiles.data,s=this.winmap?7168:6144;s+=(this.ly+this.wy>>3)*32;var n=this.ly%8,i=this.wx%8,k=(this.ly+this.wy)*640,h=this.wx,e=this.tiledata==0?128:0;do{var t=h>>3,l=a[0][s+t];this.tiledata==0&&(l=l+128&255);var r=!1,o=!1;f?(o=a[1][s+t],l=j[e+l+(o>>3&1)*NUM_TILES],d=this.cgb._bgp[o&7],r=o&128,l=l[o&64?7-n:n],o&=32):l=j[e+l][n];for(;i<8&&h<160;i++,h++,k+=4){var t=l[o?7-i:i],m;if(g&&!f){var u=q[(h>>3)+(this.ly>>3)*20];switch(d[t][0]){case 0:m=p[u][3];break;case 96:m=
p[u][2];break;case 192:m=p[u][1];break;case 255:m=p[u][0]}}else m=d[t];b[h]=r?4:l[t];c[k]=m[0];c[k+1]=m[1];c[k+2]=m[2];c[k+3]=m[3]}i=0}while(h<160)}},render_sprites:function(b){for(var c=this.image.data,a=this.oam,d=this.mem.cgb,f=this.mem.sgb,g=this.mem.input.sgb.sgb_pals,p=this.mem.input.sgb.sgbatf,q=this._tiles.data,j=this.ly,s=this.objsize?16:8,n=0;n<40;n++){var i=n*4,k=a[i]-16,h=a[i+1]-8,e=a[i+2],i=a[i+3];if(!(k>j||k+s<=j||h<=-8||h>=160)){s==16&&(e&=254,j-k>=8&&(e+=1,k+=8));var t=(160*j+h)*4,
l;d?(e=q[(i>>3&1*NUM_TILES)+e],l=this.cgb._obp[i&3]):(l=i&16?this._pal.obp1:this._pal.obp0,e=q[e]);k=i&64?e[7-(j-k)]:e[j-k];for(e=0;e<8;e++,t+=4)if(!(h+e<0||h+e>=160||b[e+h]>3)){var r=k[i&32?7-e:e];if(r!=0&&!(i&128&&b[h+e]!=0)){var o;if(f&&!d){var m=p[(h+e>>3)+(j>>3)*20];switch(l[r][0]){case 0:o=g[m][3];break;case 96:o=g[m][2];break;case 192:o=g[m][1];break;case 255:o=g[m][0]}}else o=l[r];c[t]=o[0];c[t+1]=o[1];c[t+2]=o[2];c[t+3]=o[3]}}}}},rb:function(b){switch(b&255){case 64:return this.lcdon<<7|
this.winmap<<6|this.winon<<5|this.tiledata<<4|this.bgmap<<3|this.objsize<<2|this.objon<<1|this.bgon;case 65:return this.lycly<<6|this.mode2int<<5|this.mode1int<<4|this.mode0int<<3|(this.lycly==this.ly?4:0)|this.mode;case 66:return this.scy;case 67:return this.scx;case 68:return this.ly;case 69:return this.lyc;case 71:return this.bgp;case 72:return this.obp0;case 73:return this.obp1;case 74:return this.wy;case 75:return this.wx+7;case 79:return this.vrambank;case 81:return this.hdma_src>>8;case 82:return this.hdma_src&
255;case 83:return this.hdma_dst>>8;case 84:return this.hdma_dst&255;case 85:return this.hdma5;case 104:return this.cgb.bgpi;case 105:return this.cgb.bgp[this.cgb.bgpi&63];case 106:return this.cgb.obpi;case 107:return this.cgb.obp[this.cgb.obpi&63]}return 255},wb:function(b,c){switch(b&255){case 64:this.lcdon=c>>7&1;this.winmap=c>>6&1;this.winon=c>>5&1;this.tiledata=c>>4&1;this.bgmap=c>>3&1;this.objsize=c>>2&1;this.objon=c>>1&1;this.bgon=c&1;break;case 65:this.lycly=c>>6&1;this.mode2int=c>>5&1;this.mode1int=
c>>4&1;this.mode0int=c>>3&1;break;case 66:this.scy=c;break;case 67:this.scx=c;break;case 69:this.lyc=c;break;case 70:this.oam_dma_transfer(c);break;case 71:this.bgp=c;this.update_palette(this._pal.bg,c);break;case 72:this.obp0=c;this.update_palette(this._pal.obp0,c);break;case 73:this.obp1=c;this.update_palette(this._pal.obp1,c);break;case 74:this.wy=c;break;case 75:this.wx=c-7;break;case 79:if(this.mem.cgb)this.vrambank=c&1,this.vram=this.vrambanks[this.vrambank];break;case 81:this.hdma_src=this.hdma_src&
255|c<<8;break;case 82:this.hdma_src=this.hdma_src&65280|c;break;case 83:this.hdma_dst=this.hdma_dst&255|c<<8;break;case 84:this.hdma_dst=this.hdma_dst&65280|c;break;case 85:this.hdma_dma_transfer(c);break;case 104:this.cgb.bgpi=c&191;break;case 106:this.cgb.obpi=c&191;break;case 105:this.cgb.bgp[this.cgb.bgpi&63]=c;this.update_cgb_palette(this.cgb._bgp,this.cgb.bgp,this.cgb.bgpi);if(this.cgb.bgpi&128)this.cgb.bgpi=this.cgb.bgpi+1&191;break;case 107:if(this.cgb.obp[this.cgb.obpi&63]=c,this.update_cgb_palette(this.cgb._obp,
this.cgb.obp,this.cgb.obpi),this.cgb.obpi&128)this.cgb.obpi=this.cgb.obpi+1&191}},update_tile:function(b){b=(b&8191)>>4;b+=this.vrambank*NUM_TILES;this._tiles.need_update=!0;this._tiles.to_update[b]=!0},update_palette:function(b,c){b[0]=JBA.GPU.Palette[c>>0&3];b[1]=JBA.GPU.Palette[c>>2&3];b[2]=JBA.GPU.Palette[c>>4&3];b[3]=JBA.GPU.Palette[c>>6&3]},update_cgb_palette:function(b,c,a){var d=c[a&62],c=c[(a&62)+1],b=b[(a&63)>>3][(a&7)>>1];b[0]=d&31;b[1]=d>>5|(c&3)<<3;b[2]=c>>2&31;b[3]=255;for(d=0;d<3;d++)b[d]=
b[d]*255>>5},oam_dma_transfer:function(b){b=(b&255)<<8;if(!(b>61696))for(var c=0;c<160;c++)this.oam[c]=this.mem.rb(b|c)},hdma_dma_transfer:function(){var b=this.hdma_src&65520,c=this.hdma_dst&8176;if(!(b>32752&&b<40960||b>57328||c<32768||c>40944))throw"Implement HDMA DMA transfer!";}};var Z80={Registers:function(){this.reset()},A:0,B:1,C:2,D:3,E:4,F:5,H:6,L:7,M:8,SP:0,PC:1};
Z80.Registers.prototype={m:0,ime:0,halt:0,stop:0,u8regs:new Uint8Array(9),u16regs:new Uint16Array(2),af:function(){return this.u8regs[Z80.A]<<8|this.u8regs[Z80.F]},bc:function(){return this.u8regs[Z80.B]<<8|this.u8regs[Z80.C]},de:function(){return this.u8regs[Z80.D]<<8|this.u8regs[Z80.E]},hl:function(){return this.u8regs[Z80.H]<<8|this.u8regs[Z80.L]},reset:function(){this.m=this.stop=this.halt=this.ime=0;var b=this.u8regs,c=this.u16regs;b[Z80.A]=17;b[Z80.F]=176;b[Z80.B]=0;b[Z80.C]=19;b[Z80.D]=0;b[Z80.E]=
216;b[Z80.H]=1;b[Z80.L]=77;c[Z80.SP]=65534;c[Z80.PC]=256},serialize:function(b){b.wb(this.ime);b.wb(this.halt);b.wb(this.stop);var c;for(c=0;c<this.u8regs.length;c++)b.wb(this.u8regs[c]);for(c=0;c<this.u16regs.length;c++)b.ww(this.u16regs[c])},deserialize:function(b){this.ime=b.rb();this.halt=b.rb();this.stop=b.rb();var c;for(c=0;c<this.u8regs.length;c++)this.u8regs[c]=b.rb();for(c=0;c<this.u16regs.length;c++)this.u16regs[c]=b.rw()}};Z80.ops={xx:function(){throw"garbage instruction!";},map_cb:function(b,c,a,d){(0,Z80.cbmap[c.rb(d[Z80.PC]++)])(b,c,a,d)},ld_bb:function(b,c,a){a[Z80.M]=1},ld_bc:function(b,c,a){a[Z80.B]=a[Z80.C];a[Z80.M]=1},ld_bd:function(b,c,a){a[Z80.B]=a[Z80.D];a[Z80.M]=1},ld_be:function(b,c,a){a[Z80.B]=a[Z80.E];a[Z80.M]=1},ld_bh:function(b,c,a){a[Z80.B]=a[Z80.H];a[Z80.M]=1},ld_bl:function(b,c,a){a[Z80.B]=a[Z80.L];a[Z80.M]=1},ld_ba:function(b,c,a){a[Z80.B]=a[Z80.A];a[Z80.M]=1},ld_cb:function(b,c,a){a[Z80.C]=a[Z80.B];
a[Z80.M]=1},ld_cc:function(b,c,a){a[Z80.M]=1},ld_cd:function(b,c,a){a[Z80.C]=a[Z80.D];a[Z80.M]=1},ld_ce:function(b,c,a){a[Z80.C]=a[Z80.E];a[Z80.M]=1},ld_ch:function(b,c,a){a[Z80.C]=a[Z80.H];a[Z80.M]=1},ld_cl:function(b,c,a){a[Z80.C]=a[Z80.L];a[Z80.M]=1},ld_ca:function(b,c,a){a[Z80.C]=a[Z80.A];a[Z80.M]=1},ld_db:function(b,c,a){a[Z80.D]=a[Z80.B];a[Z80.M]=1},ld_dc:function(b,c,a){a[Z80.D]=a[Z80.C];a[Z80.M]=1},ld_dd:function(b,c,a){a[Z80.M]=1},ld_de:function(b,c,a){a[Z80.D]=a[Z80.E];a[Z80.M]=1},ld_dh:function(b,
c,a){a[Z80.D]=a[Z80.H];a[Z80.M]=1},ld_dl:function(b,c,a){a[Z80.D]=a[Z80.L];a[Z80.M]=1},ld_da:function(b,c,a){a[Z80.D]=a[Z80.A];a[Z80.M]=1},ld_eb:function(b,c,a){a[Z80.E]=a[Z80.B];a[Z80.M]=1},ld_ec:function(b,c,a){a[Z80.E]=a[Z80.C];a[Z80.M]=1},ld_ed:function(b,c,a){a[Z80.E]=a[Z80.D];a[Z80.M]=1},ld_ee:function(b,c,a){a[Z80.M]=1},ld_eh:function(b,c,a){a[Z80.E]=a[Z80.H];a[Z80.M]=1},ld_el:function(b,c,a){a[Z80.E]=a[Z80.L];a[Z80.M]=1},ld_ea:function(b,c,a){a[Z80.E]=a[Z80.A];a[Z80.M]=1},ld_hb:function(b,
c,a){a[Z80.H]=a[Z80.B];a[Z80.M]=1},ld_hc:function(b,c,a){a[Z80.H]=a[Z80.C];a[Z80.M]=1},ld_hd:function(b,c,a){a[Z80.H]=a[Z80.D];a[Z80.M]=1},ld_he:function(b,c,a){a[Z80.H]=a[Z80.E];a[Z80.M]=1},ld_hh:function(b,c,a){a[Z80.M]=1},ld_hl:function(b,c,a){a[Z80.H]=a[Z80.L];a[Z80.M]=1},ld_ha:function(b,c,a){a[Z80.H]=a[Z80.A];a[Z80.M]=1},ld_lb:function(b,c,a){a[Z80.L]=a[Z80.B];a[Z80.M]=1},ld_lc:function(b,c,a){a[Z80.L]=a[Z80.C];a[Z80.M]=1},ld_ld:function(b,c,a){a[Z80.L]=a[Z80.D];a[Z80.M]=1},ld_le:function(b,
c,a){a[Z80.L]=a[Z80.E];a[Z80.M]=1},ld_lh:function(b,c,a){a[Z80.L]=a[Z80.H];a[Z80.M]=1},ld_ll:function(b,c,a){a[Z80.M]=1},ld_la:function(b,c,a){a[Z80.L]=a[Z80.A];a[Z80.M]=1},ld_ab:function(b,c,a){a[Z80.A]=a[Z80.B];a[Z80.M]=1},ld_ac:function(b,c,a){a[Z80.A]=a[Z80.C];a[Z80.M]=1},ld_ad:function(b,c,a){a[Z80.A]=a[Z80.D];a[Z80.M]=1},ld_ae:function(b,c,a){a[Z80.A]=a[Z80.E];a[Z80.M]=1},ld_ah:function(b,c,a){a[Z80.A]=a[Z80.H];a[Z80.M]=1},ld_al:function(b,c,a){a[Z80.A]=a[Z80.L];a[Z80.M]=1},ld_aa:function(b,
c,a){a[Z80.M]=1},ld_bn:function(b,c,a,d){a[Z80.B]=c.rb(d[Z80.PC]++);a[Z80.M]=2},ld_cn:function(b,c,a,d){a[Z80.C]=c.rb(d[Z80.PC]++);a[Z80.M]=2},ld_dn:function(b,c,a,d){a[Z80.D]=c.rb(d[Z80.PC]++);a[Z80.M]=2},ld_en:function(b,c,a,d){a[Z80.E]=c.rb(d[Z80.PC]++);a[Z80.M]=2},ld_hn:function(b,c,a,d){a[Z80.H]=c.rb(d[Z80.PC]++);a[Z80.M]=2},ld_ln:function(b,c,a,d){a[Z80.L]=c.rb(d[Z80.PC]++);a[Z80.M]=2},ld_an:function(b,c,a,d){a[Z80.A]=c.rb(d[Z80.PC]++);a[Z80.M]=2},ld_bhlm:function(b,c,a){a[Z80.B]=c.rb(a[Z80.H]<<
8|a[Z80.L]);a[Z80.M]=2},ld_chlm:function(b,c,a){a[Z80.C]=c.rb(a[Z80.H]<<8|a[Z80.L]);a[Z80.M]=2},ld_dhlm:function(b,c,a){a[Z80.D]=c.rb(a[Z80.H]<<8|a[Z80.L]);a[Z80.M]=2},ld_ehlm:function(b,c,a){a[Z80.E]=c.rb(a[Z80.H]<<8|a[Z80.L]);a[Z80.M]=2},ld_hhlm:function(b,c,a){a[Z80.H]=c.rb(a[Z80.H]<<8|a[Z80.L]);a[Z80.M]=2},ld_lhlm:function(b,c,a){a[Z80.L]=c.rb(a[Z80.H]<<8|a[Z80.L]);a[Z80.M]=2},ld_ahlm:function(b,c,a){a[Z80.A]=c.rb(a[Z80.H]<<8|a[Z80.L]);a[Z80.M]=2},ld_hlmb:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],
a[Z80.B]);a[Z80.M]=2},ld_hlmc:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],a[Z80.C]);a[Z80.M]=2},ld_hlmd:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],a[Z80.D]);a[Z80.M]=2},ld_hlme:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],a[Z80.E]);a[Z80.M]=2},ld_hlmh:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],a[Z80.H]);a[Z80.M]=2},ld_hlml:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],a[Z80.L]);a[Z80.M]=2},ld_hlma:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],a[Z80.A]);a[Z80.M]=2},ld_hlmn:function(b,c,a,d){c.wb(a[Z80.H]<<8|a[Z80.L],
c.rb(d[Z80.PC]++));a[Z80.M]=3},ld_abc:function(b,c,a){a[Z80.A]=c.rb(a[Z80.B]<<8|a[Z80.C]);a[Z80.M]=2},ld_ade:function(b,c,a){a[Z80.A]=c.rb(a[Z80.D]<<8|a[Z80.E]);a[Z80.M]=2},ld_ann:function(b,c,a,d){a[Z80.A]=c.rb(c.rw(d[Z80.PC]));d[Z80.PC]+=2;a[Z80.M]=4},ld_bca:function(b,c,a){c.wb(a[Z80.B]<<8|a[Z80.C],a[Z80.A]);a[Z80.M]=2},ld_dea:function(b,c,a){c.wb(a[Z80.D]<<8|a[Z80.E],a[Z80.A]);a[Z80.M]=2},ld_nna:function(b,c,a,d){c.wb(c.rw(d[Z80.PC]),a[Z80.A]);d[Z80.PC]+=2;a[Z80.M]=4},ld_nnsp:function(b,c,a,d){c.ww(c.rw(d[Z80.PC]),
d[Z80.SP]);d[Z80.PC]+=2;a[Z80.M]=4},ld_aIOn:function(b,c,a,d){a[Z80.A]=c.rb(65280|c.rb(d[Z80.PC]++));a[Z80.M]=3},ld_IOan:function(b,c,a,d){c.wb(65280|c.rb(d[Z80.PC]++),a[Z80.A]);a[Z80.M]=3},ld_aIOc:function(b,c,a){a[Z80.A]=c.rb(65280|a[Z80.C]);a[Z80.M]=2},ld_IOca:function(b,c,a){c.wb(65280|a[Z80.C],a[Z80.A]);a[Z80.M]=2},ldi_hlma:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],a[Z80.A]);a[Z80.L]+=1;a[Z80.L]||(a[Z80.H]+=1);a[Z80.M]=2},ldi_ahlm:function(b,c,a){a[Z80.A]=c.rb(a[Z80.H]<<8|a[Z80.L]);a[Z80.L]+=
1;a[Z80.L]||(a[Z80.H]+=1);a[Z80.M]=2},ldd_hlma:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],a[Z80.A]);a[Z80.L]-=1;a[Z80.L]==255&&(a[Z80.H]-=1);a[Z80.M]=2},ldd_ahlm:function(b,c,a){a[Z80.A]=c.rb(a[Z80.H]<<8|a[Z80.L]);a[Z80.L]-=1;a[Z80.L]==255&&(a[Z80.H]-=1);a[Z80.M]=2},ld_bcnn:function(b,c,a,d){a[Z80.C]=c.rb(d[Z80.PC]++);a[Z80.B]=c.rb(d[Z80.PC]++);a[Z80.M]=3},ld_denn:function(b,c,a,d){a[Z80.E]=c.rb(d[Z80.PC]++);a[Z80.D]=c.rb(d[Z80.PC]++);a[Z80.M]=3},ld_hlnn:function(b,c,a,d){a[Z80.L]=c.rb(d[Z80.PC]++);
a[Z80.H]=c.rb(d[Z80.PC]++);a[Z80.M]=3},ld_spnn:function(b,c,a,d){d[Z80.SP]=c.rw(d[Z80.PC]);d[Z80.PC]+=2;a[Z80.M]=3},ld_sphl:function(b,c,a,d){d[Z80.SP]=a[Z80.H]<<8|a[Z80.L];a[Z80.M]=2},push_bc:function(b,c,a,d){c.wb(--d[Z80.SP],a[Z80.B]);c.wb(--d[Z80.SP],a[Z80.C]);a[Z80.M]=4},pop_bc:function(b,c,a,d){a[Z80.C]=c.rb(d[Z80.SP]++);a[Z80.B]=c.rb(d[Z80.SP]++);a[Z80.M]=3},push_de:function(b,c,a,d){c.wb(--d[Z80.SP],a[Z80.D]);c.wb(--d[Z80.SP],a[Z80.E]);a[Z80.M]=4},pop_de:function(b,c,a,d){a[Z80.E]=c.rb(d[Z80.SP]++);
a[Z80.D]=c.rb(d[Z80.SP]++);a[Z80.M]=3},push_hl:function(b,c,a,d){c.wb(--d[Z80.SP],a[Z80.H]);c.wb(--d[Z80.SP],a[Z80.L]);a[Z80.M]=4},pop_hl:function(b,c,a,d){a[Z80.L]=c.rb(d[Z80.SP]++);a[Z80.H]=c.rb(d[Z80.SP]++);a[Z80.M]=3},push_af:function(b,c,a,d){c.wb(--d[Z80.SP],a[Z80.A]);c.wb(--d[Z80.SP],a[Z80.F]);a[Z80.M]=4},pop_af:function(b,c,a,d){a[Z80.F]=c.rb(d[Z80.SP]++);a[Z80.A]=c.rb(d[Z80.SP]++);a[Z80.M]=3},add_ab:function(b,c,a){b=a[Z80.A];c=a[Z80.B];a[Z80.F]=(b&15)+(c&15)>15?32:0;a[Z80.F]|=b+c>255?16:
0;a[Z80.A]=b+c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},add_ac:function(b,c,a){b=a[Z80.A];c=a[Z80.C];a[Z80.F]=(b&15)+(c&15)>15?32:0;a[Z80.F]|=b+c>255?16:0;a[Z80.A]=b+c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},add_ad:function(b,c,a){b=a[Z80.A];c=a[Z80.D];a[Z80.F]=(b&15)+(c&15)>15?32:0;a[Z80.F]|=b+c>255?16:0;a[Z80.A]=b+c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},add_ae:function(b,c,a){b=a[Z80.A];c=a[Z80.E];a[Z80.F]=(b&15)+(c&15)>15?32:0;a[Z80.F]|=b+c>255?16:0;a[Z80.A]=b+c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},add_ah:function(b,
c,a){b=a[Z80.A];c=a[Z80.H];a[Z80.F]=(b&15)+(c&15)>15?32:0;a[Z80.F]|=b+c>255?16:0;a[Z80.A]=b+c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},add_al:function(b,c,a){b=a[Z80.A];c=a[Z80.L];a[Z80.F]=(b&15)+(c&15)>15?32:0;a[Z80.F]|=b+c>255?16:0;a[Z80.A]=b+c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},add_aa:function(b,c,a){b=a[Z80.A];c=a[Z80.A];a[Z80.F]=(b&15)+(c&15)>15?32:0;a[Z80.F]|=b+c>255?16:0;a[Z80.A]=b+c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},add_ahlm:function(b,c,a){b=a[Z80.A];c=c.rb(a[Z80.H]<<8|a[Z80.L]);a[Z80.F]=
(b&15)+(c&15)>15?32:0;a[Z80.F]|=b+c>255?16:0;a[Z80.A]=b+c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=2},add_an:function(b,c,a,d){b=a[Z80.A];c=c.rb(d[Z80.PC]++);a[Z80.F]=(b&15)+(c&15)>15?32:0;a[Z80.F]|=b+c>255?16:0;a[Z80.A]=b+c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=2},adc_ab:function(b,c,a){var b=a[Z80.A],c=a[Z80.B],d=!!(a[Z80.F]&16);a[Z80.F]=(b&15)+(c&15)+d>15?32:0;a[Z80.F]|=b+c+d>255?16:0;a[Z80.A]=b+c+d;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},adc_ac:function(b,c,a){var b=a[Z80.A],c=a[Z80.C],d=!!(a[Z80.F]&16);a[Z80.F]=
(b&15)+(c&15)+d>15?32:0;a[Z80.F]|=b+c+d>255?16:0;a[Z80.A]=b+c+d;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},adc_ad:function(b,c,a){var b=a[Z80.A],c=a[Z80.D],d=!!(a[Z80.F]&16);a[Z80.F]=(b&15)+(c&15)+d>15?32:0;a[Z80.F]|=b+c+d>255?16:0;a[Z80.A]=b+c+d;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},adc_ae:function(b,c,a){var b=a[Z80.A],c=a[Z80.E],d=!!(a[Z80.F]&16);a[Z80.F]=(b&15)+(c&15)+d>15?32:0;a[Z80.F]|=b+c+d>255?16:0;a[Z80.A]=b+c+d;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},adc_ah:function(b,c,a){var b=a[Z80.A],c=a[Z80.H],
d=!!(a[Z80.F]&16);a[Z80.F]=(b&15)+(c&15)+d>15?32:0;a[Z80.F]|=b+c+d>255?16:0;a[Z80.A]=b+c+d;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},adc_al:function(b,c,a){var b=a[Z80.A],c=a[Z80.L],d=!!(a[Z80.F]&16);a[Z80.F]=(b&15)+(c&15)+d>15?32:0;a[Z80.F]|=b+c+d>255?16:0;a[Z80.A]=b+c+d;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},adc_aa:function(b,c,a){var b=a[Z80.A],c=a[Z80.A],d=!!(a[Z80.F]&16);a[Z80.F]=(b&15)+(c&15)+d>15?32:0;a[Z80.F]|=b+c+d>255?16:0;a[Z80.A]=b+c+d;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},adc_ahlm:function(b,
c,a){var b=a[Z80.A],c=c.rb(a[Z80.H]<<8|a[Z80.L]),d=!!(a[Z80.F]&16);a[Z80.F]=(b&15)+(c&15)+d>15?32:0;a[Z80.F]|=b+c+d>255?16:0;a[Z80.A]=b+c+d;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=2},adc_an:function(b,c,a,d){b=a[Z80.A];c=c.rb(d[Z80.PC]++);d=!!(a[Z80.F]&16);a[Z80.F]=(b&15)+(c&15)+d>15?32:0;a[Z80.F]|=b+c+d>255?16:0;a[Z80.A]=b+c+d;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=2},sub_ab:function(b,c,a){b=a[Z80.A];c=a[Z80.B];a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},sub_ac:function(b,
c,a){b=a[Z80.A];c=a[Z80.C];a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},sub_ad:function(b,c,a){b=a[Z80.A];c=a[Z80.D];a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},sub_ae:function(b,c,a){b=a[Z80.A];c=a[Z80.E];a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},sub_ah:function(b,c,a){b=a[Z80.A];c=a[Z80.H];a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;
a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},sub_al:function(b,c,a){b=a[Z80.A];c=a[Z80.L];a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},sub_aa:function(b,c,a){b=a[Z80.A];c=a[Z80.A];a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},sub_ahlm:function(b,c,a){b=a[Z80.A];c=c.rb(a[Z80.H]<<8|a[Z80.L]);a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=2},sub_an:function(b,c,a,d){b=
a[Z80.A];c=c.rb(d[Z80.PC]++);a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=2},sbc_ab:function(b,c,a){b=a[Z80.A];c=a[Z80.B]+!!(a[Z80.F]&16);a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},sbc_ac:function(b,c,a){b=a[Z80.A];c=a[Z80.C]+!!(a[Z80.F]&16);a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},sbc_ad:function(b,c,a){b=a[Z80.A];c=a[Z80.D]+!!(a[Z80.F]&16);a[Z80.F]=
64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},sbc_ae:function(b,c,a){b=a[Z80.A];c=a[Z80.E]+!!(a[Z80.F]&16);a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},sbc_ah:function(b,c,a){b=a[Z80.A];c=a[Z80.H]+!!(a[Z80.F]&16);a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},sbc_al:function(b,c,a){b=a[Z80.A];c=a[Z80.L]+!!(a[Z80.F]&16);a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=
b-c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},sbc_aa:function(b,c,a){b=a[Z80.A];c=a[Z80.A]+!!(a[Z80.F]&16);a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=1},sbc_ahlm:function(b,c,a){b=a[Z80.A];c=c.rb(a[Z80.H]<<8|a[Z80.L])+!!(a[Z80.F]&16);a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;a[Z80.F]|=a[Z80.A]?0:128;a[Z80.M]=2},sbc_an:function(b,c,a,d){b=a[Z80.A];c=c.rb(d[Z80.PC]++)+!!(a[Z80.F]&16);a[Z80.F]=64|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.A]=b-c;a[Z80.F]|=
a[Z80.A]?0:128;a[Z80.M]=2},and_ab:function(b,c,a){a[Z80.A]&=a[Z80.B];a[Z80.F]=(a[Z80.A]?0:128)|32;a[Z80.M]=1},and_ac:function(b,c,a){a[Z80.A]&=a[Z80.C];a[Z80.F]=(a[Z80.A]?0:128)|32;a[Z80.M]=1},and_ad:function(b,c,a){a[Z80.A]&=a[Z80.D];a[Z80.F]=(a[Z80.A]?0:128)|32;a[Z80.M]=1},and_ae:function(b,c,a){a[Z80.A]&=a[Z80.E];a[Z80.F]=(a[Z80.A]?0:128)|32;a[Z80.M]=1},and_ah:function(b,c,a){a[Z80.A]&=a[Z80.H];a[Z80.F]=(a[Z80.A]?0:128)|32;a[Z80.M]=1},and_al:function(b,c,a){a[Z80.A]&=a[Z80.L];a[Z80.F]=(a[Z80.A]?
0:128)|32;a[Z80.M]=1},and_aa:function(b,c,a){a[Z80.A]&=a[Z80.A];a[Z80.F]=(a[Z80.A]?0:128)|32;a[Z80.M]=1},and_ahlm:function(b,c,a){a[Z80.A]&=c.rb(a[Z80.H]<<8|a[Z80.L]);a[Z80.F]=(a[Z80.A]?0:128)|32;a[Z80.M]=2},and_an:function(b,c,a,d){a[Z80.A]&=c.rb(d[Z80.PC]++);a[Z80.F]=(a[Z80.A]?0:128)|32;a[Z80.M]=2},xor_ab:function(b,c,a){a[Z80.A]^=a[Z80.B];a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=1},xor_ac:function(b,c,a){a[Z80.A]^=a[Z80.C];a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=1},xor_ad:function(b,c,a){a[Z80.A]^=a[Z80.D];a[Z80.F]=
a[Z80.A]?0:128;a[Z80.M]=1},xor_ae:function(b,c,a){a[Z80.A]^=a[Z80.E];a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=1},xor_ah:function(b,c,a){a[Z80.A]^=a[Z80.H];a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=1},xor_al:function(b,c,a){a[Z80.A]^=a[Z80.L];a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=1},xor_aa:function(b,c,a){a[Z80.A]^=a[Z80.A];a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=1},xor_ahlm:function(b,c,a){a[Z80.A]^=c.rb(a[Z80.H]<<8|a[Z80.L]);a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=2},xor_an:function(b,c,a,d){a[Z80.A]^=c.rb(d[Z80.PC]++);a[Z80.F]=a[Z80.A]?
0:128;a[Z80.M]=2},or_ab:function(b,c,a){a[Z80.A]|=a[Z80.B];a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=1},or_ac:function(b,c,a){a[Z80.A]|=a[Z80.C];a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=1},or_ad:function(b,c,a){a[Z80.A]|=a[Z80.D];a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=1},or_ae:function(b,c,a){a[Z80.A]|=a[Z80.E];a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=1},or_ah:function(b,c,a){a[Z80.A]|=a[Z80.H];a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=1},or_al:function(b,c,a){a[Z80.A]|=a[Z80.L];a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=1},or_aa:function(b,c,a){a[Z80.A]|=
a[Z80.A];a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=1},or_ahlm:function(b,c,a){a[Z80.A]|=c.rb(a[Z80.H]<<8|a[Z80.L]);a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=2},or_an:function(b,c,a,d){a[Z80.A]|=c.rb(d[Z80.PC]++);a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=2},cp_ab:function(b,c,a){b=a[Z80.A];c=a[Z80.B];a[Z80.F]=64|(b==c?128:0)|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.M]=1},cp_ac:function(b,c,a){b=a[Z80.A];c=a[Z80.C];a[Z80.F]=64|(b==c?128:0)|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.M]=1},cp_ad:function(b,c,a){b=a[Z80.A];c=a[Z80.D];a[Z80.F]=
64|(b==c?128:0)|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.M]=1},cp_ae:function(b,c,a){b=a[Z80.A];c=a[Z80.E];a[Z80.F]=64|(b==c?128:0)|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.M]=1},cp_ah:function(b,c,a){b=a[Z80.A];c=a[Z80.H];a[Z80.F]=64|(b==c?128:0)|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.M]=1},cp_al:function(b,c,a){b=a[Z80.A];c=a[Z80.L];a[Z80.F]=64|(b==c?128:0)|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.M]=1},cp_aa:function(b,c,a){b=a[Z80.A];c=a[Z80.A];a[Z80.F]=64|(b==c?128:0)|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.M]=
1},cp_ahlm:function(b,c,a){b=a[Z80.A];c=c.rb(a[Z80.H]<<8|a[Z80.L]);a[Z80.F]=64|(b==c?128:0)|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.M]=2},cp_an:function(b,c,a,d){b=a[Z80.A];c=c.rb(d[Z80.PC]++);a[Z80.F]=64|(b==c?128:0)|(b<c?16:0)|((b&15)<(c&15)?32:0);a[Z80.M]=2},inc_b:function(b,c,a){a[Z80.B]++;a[Z80.F]=a[Z80.B]?0:128;a[Z80.M]=1},inc_c:function(b,c,a){a[Z80.C]++;a[Z80.F]=a[Z80.C]?0:128;a[Z80.M]=1},inc_d:function(b,c,a){a[Z80.D]++;a[Z80.F]=a[Z80.D]?0:128;a[Z80.M]=1},inc_e:function(b,c,a){a[Z80.E]++;a[Z80.F]=
a[Z80.E]?0:128;a[Z80.M]=1},inc_h:function(b,c,a){a[Z80.H]++;a[Z80.F]=a[Z80.H]?0:128;a[Z80.M]=1},inc_l:function(b,c,a){a[Z80.L]++;a[Z80.F]=a[Z80.L]?0:128;a[Z80.M]=1},inc_a:function(b,c,a){a[Z80.A]++;a[Z80.F]=a[Z80.A]?0:128;a[Z80.M]=1},inc_hlm:function(b,c,a){var b=a[Z80.H]<<8|a[Z80.L],d=c.rb(b)+1;c.wb(b,d);a[Z80.F]=d?0:128;a[Z80.M]=3},dec_b:function(b,c,a){a[Z80.B]--;a[Z80.F]=a[Z80.F]&31|64|(a[Z80.B]?0:128)|((a[Z80.B]&15)==15)<<5;a[Z80.M]=1},dec_c:function(b,c,a){a[Z80.C]--;a[Z80.F]=a[Z80.F]&31|64|
(a[Z80.C]?0:128)|((a[Z80.C]&15)==15)<<5;a[Z80.M]=1},dec_d:function(b,c,a){a[Z80.D]--;a[Z80.F]=a[Z80.F]&31|64|(a[Z80.D]?0:128)|((a[Z80.D]&15)==15)<<5;a[Z80.M]=1},dec_e:function(b,c,a){a[Z80.E]--;a[Z80.F]=a[Z80.F]&31|64|(a[Z80.E]?0:128)|((a[Z80.E]&15)==15)<<5;a[Z80.M]=1},dec_h:function(b,c,a){a[Z80.H]--;a[Z80.F]=a[Z80.F]&31|64|(a[Z80.H]?0:128)|((a[Z80.H]&15)==15)<<5;a[Z80.M]=1},dec_l:function(b,c,a){a[Z80.L]--;a[Z80.F]=a[Z80.F]&31|64|(a[Z80.L]?0:128)|((a[Z80.L]&15)==15)<<5;a[Z80.M]=1},dec_a:function(b,
c,a){a[Z80.A]--;a[Z80.F]=a[Z80.F]&31|64|(a[Z80.A]?0:128)|((a[Z80.A]&15)==15)<<5;a[Z80.M]=1},dec_hlm:function(b,c,a){var b=a[Z80.H]<<8|a[Z80.L],d=c.rb(b)-1;c.wb(b,d);a[Z80.F]=(d?0:128)|64;a[Z80.M]=3},daa:function(b,c,a){b=Z80.daa_table[a[Z80.A]|a[Z80.F]<<4];a[Z80.A]=b>>8;a[Z80.F]=b;a[Z80.M]=1},cpl:function(b,c,a){a[Z80.A]^=255;a[Z80.F]|=96;a[Z80.M]=1},add_hlhl:function(b,c,a){var b=a[Z80.H]<<8|a[Z80.L],c=a[Z80.H]<<8|a[Z80.L],d=b+c;a[Z80.F]&=191;d>65535?a[Z80.F]|=16:a[Z80.F]&=239;(b&4095)+(c&4095)>
4095&&(a[Z80.F]|=32);a[Z80.L]=d;a[Z80.H]=d>>8;a[Z80.M]=2},add_hlbc:function(b,c,a){var b=a[Z80.H]<<8|a[Z80.L],c=a[Z80.B]<<8|a[Z80.C],d=b+c;a[Z80.F]&=191;d>65535?a[Z80.F]|=16:a[Z80.F]&=239;(b&4095)+(c&4095)>4095&&(a[Z80.F]|=32);a[Z80.L]=d;a[Z80.H]=d>>8;a[Z80.M]=2},add_hlde:function(b,c,a){var b=a[Z80.H]<<8|a[Z80.L],c=a[Z80.D]<<8|a[Z80.E],d=b+c;a[Z80.F]&=191;d>65535?a[Z80.F]|=16:a[Z80.F]&=239;(b&4095)+(c&4095)>4095&&(a[Z80.F]|=32);a[Z80.L]=d;a[Z80.H]=d>>8;a[Z80.M]=2},add_hlsp:function(b,c,a,d){b=a[Z80.H]<<
8|a[Z80.L];d=d[Z80.SP];c=b+d;a[Z80.F]&=191;c>65535?a[Z80.F]|=16:a[Z80.F]&=239;(b&4095)+(d&4095)>4095&&(a[Z80.F]|=32);a[Z80.L]=c;a[Z80.H]=c>>8;a[Z80.M]=2},inc_bc:function(b,c,a){a[Z80.C]++;a[Z80.C]||a[Z80.B]++;a[Z80.M]=2},dec_bc:function(b,c,a){a[Z80.C]--;a[Z80.C]==255&&a[Z80.B]--;a[Z80.M]=2},inc_de:function(b,c,a){a[Z80.E]++;a[Z80.E]||a[Z80.D]++;a[Z80.M]=2},dec_de:function(b,c,a){a[Z80.E]--;a[Z80.E]==255&&a[Z80.D]--;a[Z80.M]=2},inc_hl:function(b,c,a){a[Z80.L]++;a[Z80.L]||a[Z80.H]++;a[Z80.M]=2},dec_hl:function(b,
c,a){a[Z80.L]--;a[Z80.L]==255&&a[Z80.H]--;a[Z80.M]=2},inc_sp:function(b,c,a,d){d[Z80.SP]++;a[Z80.M]=2},dec_sp:function(b,c,a,d){d[Z80.SP]--;a[Z80.M]=2},add_spn:function(b,c,a,d){b=c.rb(d[Z80.PC]++);d[Z80.SP]+=b>127?(b&127)-128:b;a[Z80.M]=4},ld_hlspn:function(b,c,a,d){b=c.rb(d[Z80.PC]++);b=b>127?(b&127)-128:b;b+=d[Z80.SP];a[Z80.H]=b>>8;a[Z80.L]=b;a[Z80.M]=3},rlca:function(b,c,a){b=a[Z80.A]&128?1:0;a[Z80.A]=a[Z80.A]<<1&255|b;a[Z80.F]=(a[Z80.A]?0:128)|(b?16:0);a[Z80.M]=1},rla:function(b,c,a){b=a[Z80.A]&
128;a[Z80.A]=a[Z80.A]<<1&255|(a[Z80.F]&16?1:0);a[Z80.F]=(a[Z80.A]?0:128)|(b?16:0);a[Z80.M]=1},rlc_b:function(b,c,a){b=a[Z80.B]&128?1:0;a[Z80.B]=a[Z80.B]<<1&255|b;a[Z80.F]=(a[Z80.B]?0:128)|(b?16:0);a[Z80.M]=2},rl_b:function(b,c,a){b=a[Z80.B]&128;a[Z80.B]=a[Z80.B]<<1&255|(a[Z80.F]&16?1:0);a[Z80.F]=(a[Z80.B]?0:128)|(b?16:0);a[Z80.M]=2},rlc_c:function(b,c,a){b=a[Z80.C]&128?1:0;a[Z80.C]=a[Z80.C]<<1&255|b;a[Z80.F]=(a[Z80.C]?0:128)|(b?16:0);a[Z80.M]=2},rl_c:function(b,c,a){b=a[Z80.C]&128;a[Z80.C]=a[Z80.C]<<
1&255|(a[Z80.F]&16?1:0);a[Z80.F]=(a[Z80.C]?0:128)|(b?16:0);a[Z80.M]=2},rlc_d:function(b,c,a){b=a[Z80.D]&128?1:0;a[Z80.D]=a[Z80.D]<<1&255|b;a[Z80.F]=(a[Z80.D]?0:128)|(b?16:0);a[Z80.M]=2},rl_d:function(b,c,a){b=a[Z80.D]&128;a[Z80.D]=a[Z80.D]<<1&255|(a[Z80.F]&16?1:0);a[Z80.F]=(a[Z80.D]?0:128)|(b?16:0);a[Z80.M]=2},rlc_e:function(b,c,a){b=a[Z80.E]&128?1:0;a[Z80.E]=a[Z80.E]<<1&255|b;a[Z80.F]=(a[Z80.E]?0:128)|(b?16:0);a[Z80.M]=2},rl_e:function(b,c,a){b=a[Z80.E]&128;a[Z80.E]=a[Z80.E]<<1&255|(a[Z80.F]&16?
1:0);a[Z80.F]=(a[Z80.E]?0:128)|(b?16:0);a[Z80.M]=2},rlc_h:function(b,c,a){b=a[Z80.H]&128?1:0;a[Z80.H]=a[Z80.H]<<1&255|b;a[Z80.F]=(a[Z80.H]?0:128)|(b?16:0);a[Z80.M]=2},rl_h:function(b,c,a){b=a[Z80.H]&128;a[Z80.H]=a[Z80.H]<<1&255|(a[Z80.F]&16?1:0);a[Z80.F]=(a[Z80.H]?0:128)|(b?16:0);a[Z80.M]=2},rlc_l:function(b,c,a){b=a[Z80.L]&128?1:0;a[Z80.L]=a[Z80.L]<<1&255|b;a[Z80.F]=(a[Z80.L]?0:128)|(b?16:0);a[Z80.M]=2},rl_l:function(b,c,a){b=a[Z80.L]&128;a[Z80.L]=a[Z80.L]<<1&255|(a[Z80.F]&16?1:0);a[Z80.F]=(a[Z80.L]?
0:128)|(b?16:0);a[Z80.M]=2},rlc_a:function(b,c,a){b=a[Z80.A]&128?1:0;a[Z80.A]=a[Z80.A]<<1&255|b;a[Z80.F]=(a[Z80.A]?0:128)|(b?16:0);a[Z80.M]=2},rl_a:function(b,c,a){b=a[Z80.A]&128;a[Z80.A]=a[Z80.A]<<1&255|(a[Z80.F]&16?1:0);a[Z80.F]=(a[Z80.A]?0:128)|(b?16:0);a[Z80.M]=2},rlc_hlm:function(b,c,a){var b=c.rb(a[Z80.H]<<8|a[Z80.L]),d=b&128?1:0,b=b<<1&255|d;a[Z80.F]=(b?0:128)|(d?16:0);c.wb(a[Z80.H]<<8|a[Z80.L],b);a[Z80.M]=4},rl_hlm:function(b,c,a){var b=c.rb(a[Z80.H]<<8|a[Z80.L]),d=b&128,b=b<<1&255|(a[Z80.F]&
16?1:0);a[Z80.F]=(b?0:128)|(d?16:0);c.wb(a[Z80.H]<<8|a[Z80.L],b);a[Z80.M]=4},rrca:function(b,c,a){b=a[Z80.A]&1;a[Z80.A]=a[Z80.A]>>1|b<<7;a[Z80.F]=(a[Z80.A]?0:128)|(b?16:0);a[Z80.M]=1},rra:function(b,c,a){b=a[Z80.A]&1?16:0;a[Z80.A]=a[Z80.A]>>1|(a[Z80.F]&16?128:0);a[Z80.F]=(a[Z80.A]?0:128)|b;a[Z80.M]=1},rrc_b:function(b,c,a){b=a[Z80.B]&1;a[Z80.B]=a[Z80.B]>>1|b<<7;a[Z80.F]=(a[Z80.B]?0:128)|(b?16:0);a[Z80.M]=2},rr_b:function(b,c,a){b=a[Z80.B]&1?16:0;a[Z80.B]=a[Z80.B]>>1|(a[Z80.F]&16?128:0);a[Z80.F]=(a[Z80.B]?
0:128)|b;a[Z80.M]=2},rrc_c:function(b,c,a){b=a[Z80.C]&1;a[Z80.C]=a[Z80.C]>>1|b<<7;a[Z80.F]=(a[Z80.C]?0:128)|(b?16:0);a[Z80.M]=2},rr_c:function(b,c,a){b=a[Z80.C]&1?16:0;a[Z80.C]=a[Z80.C]>>1|(a[Z80.F]&16?128:0);a[Z80.F]=(a[Z80.C]?0:128)|b;a[Z80.M]=2},rrc_d:function(b,c,a){b=a[Z80.D]&1;a[Z80.D]=a[Z80.D]>>1|b<<7;a[Z80.F]=(a[Z80.D]?0:128)|(b?16:0);a[Z80.M]=2},rr_d:function(b,c,a){b=a[Z80.D]&1?16:0;a[Z80.D]=a[Z80.D]>>1|(a[Z80.F]&16?128:0);a[Z80.F]=(a[Z80.D]?0:128)|b;a[Z80.M]=2},rrc_e:function(b,c,a){b=
a[Z80.E]&1;a[Z80.E]=a[Z80.E]>>1|b<<7;a[Z80.F]=(a[Z80.E]?0:128)|(b?16:0);a[Z80.M]=2},rr_e:function(b,c,a){b=a[Z80.E]&1?16:0;a[Z80.E]=a[Z80.E]>>1|(a[Z80.F]&16?128:0);a[Z80.F]=(a[Z80.E]?0:128)|b;a[Z80.M]=2},rrc_h:function(b,c,a){b=a[Z80.H]&1;a[Z80.H]=a[Z80.H]>>1|b<<7;a[Z80.F]=(a[Z80.H]?0:128)|(b?16:0);a[Z80.M]=2},rr_h:function(b,c,a){b=a[Z80.H]&1?16:0;a[Z80.H]=a[Z80.H]>>1|(a[Z80.F]&16?128:0);a[Z80.F]=(a[Z80.H]?0:128)|b;a[Z80.M]=2},rrc_l:function(b,c,a){b=a[Z80.L]&1;a[Z80.L]=a[Z80.L]>>1|b<<7;a[Z80.F]=
(a[Z80.L]?0:128)|(b?16:0);a[Z80.M]=2},rr_l:function(b,c,a){b=a[Z80.L]&1?16:0;a[Z80.L]=a[Z80.L]>>1|(a[Z80.F]&16?128:0);a[Z80.F]=(a[Z80.L]?0:128)|b;a[Z80.M]=2},rrc_a:function(b,c,a){b=a[Z80.A]&1;a[Z80.A]=a[Z80.A]>>1|b<<7;a[Z80.F]=(a[Z80.A]?0:128)|(b?16:0);a[Z80.M]=2},rr_a:function(b,c,a){b=a[Z80.A]&1?16:0;a[Z80.A]=a[Z80.A]>>1|(a[Z80.F]&16?128:0);a[Z80.F]=(a[Z80.A]?0:128)|b;a[Z80.M]=2},rrc_hlm:function(b,c,a){var b=c.rb(a[Z80.H]<<8|a[Z80.L]),d=b&1,b=b>>1|d<<7;a[Z80.F]=(b?0:128)|(d?16:0);c.wb(a[Z80.H]<<
8|a[Z80.L],b);a[Z80.M]=4},rr_hlm:function(b,c,a){var b=c.rb(a[Z80.H]<<8|a[Z80.L]),d=b&1?16:0,b=b>>1|(a[Z80.F]&16?128:0);a[Z80.F]=(b?0:128)|d;c.wb(a[Z80.H]<<8|a[Z80.L],b);a[Z80.M]=4},sla_b:function(b,c,a){b=a[Z80.B]>>7&1;a[Z80.B]<<=1;a[Z80.F]=(a[Z80.B]?0:128)|(b?16:0);a[Z80.M]=2},sla_c:function(b,c,a){b=a[Z80.C]>>7&1;a[Z80.C]<<=1;a[Z80.F]=(a[Z80.C]?0:128)|(b?16:0);a[Z80.M]=2},sla_d:function(b,c,a){b=a[Z80.D]>>7&1;a[Z80.D]<<=1;a[Z80.F]=(a[Z80.D]?0:128)|(b?16:0);a[Z80.M]=2},sla_e:function(b,c,a){b=a[Z80.E]>>
7&1;a[Z80.E]<<=1;a[Z80.F]=(a[Z80.E]?0:128)|(b?16:0);a[Z80.M]=2},sla_h:function(b,c,a){b=a[Z80.H]>>7&1;a[Z80.H]<<=1;a[Z80.F]=(a[Z80.H]?0:128)|(b?16:0);a[Z80.M]=2},sla_l:function(b,c,a){b=a[Z80.L]>>7&1;a[Z80.L]<<=1;a[Z80.F]=(a[Z80.L]?0:128)|(b?16:0);a[Z80.M]=2},sla_a:function(b,c,a){b=a[Z80.A]>>7&1;a[Z80.A]<<=1;a[Z80.F]=(a[Z80.A]?0:128)|(b?16:0);a[Z80.M]=2},sla_hlm:function(b,c,a){var b=c.rb(a[Z80.H]<<8|a[Z80.L]),d=b>>7&1;b<<=1;a[Z80.F]=(b?0:128)|(d?16:0);c.wb(a[Z80.H]<<8|a[Z80.L],b);a[Z80.M]=4},swap_b:function(b,
c,a){b=a[Z80.B];a[Z80.B]=b<<4|(b&240)>>4;a[Z80.F]=b?0:128;a[Z80.M]=2},swap_c:function(b,c,a){b=a[Z80.C];a[Z80.C]=b<<4|(b&240)>>4;a[Z80.F]=b?0:128;a[Z80.M]=2},swap_d:function(b,c,a){b=a[Z80.D];a[Z80.D]=b<<4|(b&240)>>4;a[Z80.F]=b?0:128;a[Z80.M]=2},swap_e:function(b,c,a){b=a[Z80.E];a[Z80.E]=b<<4|(b&240)>>4;a[Z80.F]=b?0:128;a[Z80.M]=2},swap_h:function(b,c,a){b=a[Z80.H];a[Z80.H]=b<<4|(b&240)>>4;a[Z80.F]=b?0:128;a[Z80.M]=2},swap_l:function(b,c,a){b=a[Z80.L];a[Z80.L]=b<<4|(b&240)>>4;a[Z80.F]=b?0:128;a[Z80.M]=
2},swap_a:function(b,c,a){b=a[Z80.A];a[Z80.A]=b<<4|(b&240)>>4;a[Z80.F]=b?0:128;a[Z80.M]=2},swap_hlm:function(b,c,a){b=c.rb(a[Z80.H]<<8|a[Z80.L]);c.wb(a[Z80.H]<<8|a[Z80.L],b<<4|(b&240)>>4);a[Z80.F]=b?0:128;a[Z80.M]=4},sra_b:function(b,c,a){b=a[Z80.B];c=b&1;b=b>>1|b&128;a[Z80.F]=(b?0:128)|(c?16:0);a[Z80.B]=b;a[Z80.M]=2},sra_c:function(b,c,a){b=a[Z80.C];c=b&1;b=b>>1|b&128;a[Z80.F]=(b?0:128)|(c?16:0);a[Z80.C]=b;a[Z80.M]=2},sra_d:function(b,c,a){b=a[Z80.D];c=b&1;b=b>>1|b&128;a[Z80.F]=(b?0:128)|(c?16:0);
a[Z80.D]=b;a[Z80.M]=2},sra_e:function(b,c,a){b=a[Z80.E];c=b&1;b=b>>1|b&128;a[Z80.F]=(b?0:128)|(c?16:0);a[Z80.E]=b;a[Z80.M]=2},sra_h:function(b,c,a){b=a[Z80.H];c=b&1;b=b>>1|b&128;a[Z80.F]=(b?0:128)|(c?16:0);a[Z80.H]=b;a[Z80.M]=2},sra_l:function(b,c,a){b=a[Z80.L];c=b&1;b=b>>1|b&128;a[Z80.F]=(b?0:128)|(c?16:0);a[Z80.L]=b;a[Z80.M]=2},sra_a:function(b,c,a){b=a[Z80.A];c=b&1;b=b>>1|b&128;a[Z80.F]=(b?0:128)|(c?16:0);a[Z80.A]=b;a[Z80.M]=2},sra_hlm:function(b,c,a){var b=c.rb(a[Z80.H]<<8|a[Z80.L]),d=b&1,b=b>>
1|b&128;a[Z80.F]=(b?0:128)|(d?16:0);c.wb(a[Z80.H]<<8|a[Z80.L],b);a[Z80.M]=4},srl_b:function(b,c,a){b=a[Z80.B];c=b&1?16:0;b=b>>1&127;a[Z80.F]=(b?0:128)|c;a[Z80.B]=b;a[Z80.M]=2},srl_c:function(b,c,a){b=a[Z80.C];c=b&1?16:0;b=b>>1&127;a[Z80.F]=(b?0:128)|c;a[Z80.C]=b;a[Z80.M]=2},srl_d:function(b,c,a){b=a[Z80.D];c=b&1?16:0;b=b>>1&127;a[Z80.F]=(b?0:128)|c;a[Z80.D]=b;a[Z80.M]=2},srl_e:function(b,c,a){b=a[Z80.E];c=b&1?16:0;b=b>>1&127;a[Z80.F]=(b?0:128)|c;a[Z80.E]=b;a[Z80.M]=2},srl_h:function(b,c,a){b=a[Z80.H];
c=b&1?16:0;b=b>>1&127;a[Z80.F]=(b?0:128)|c;a[Z80.H]=b;a[Z80.M]=2},srl_l:function(b,c,a){b=a[Z80.L];c=b&1?16:0;b=b>>1&127;a[Z80.F]=(b?0:128)|c;a[Z80.L]=b;a[Z80.M]=2},srl_a:function(b,c,a){b=a[Z80.A];c=b&1?16:0;b=b>>1&127;a[Z80.F]=(b?0:128)|c;a[Z80.A]=b;a[Z80.M]=2},srl_hlm:function(b,c,a){var b=c.rb(a[Z80.H]<<8|a[Z80.L]),d=b&1?16:0,b=b>>1&127;a[Z80.F]=(b?0:128)|d;c.wb(a[Z80.H]<<8|a[Z80.L],b);a[Z80.M]=4},bit_0b:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.B]&1?0:128);a[Z80.M]=2},bit_0c:function(b,
c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.C]&1?0:128);a[Z80.M]=2},bit_0d:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.D]&1?0:128);a[Z80.M]=2},bit_0e:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.E]&1?0:128);a[Z80.M]=2},bit_0h:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.H]&1?0:128);a[Z80.M]=2},bit_0l:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.L]&1?0:128);a[Z80.M]=2},bit_0a:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.A]&1?0:128);a[Z80.M]=2},bit_0hlm:function(b,c,a){b=c.rb(a[Z80.H]<<8|a[Z80.L])&
1;a[Z80.F]=a[Z80.F]&16|32|(b?0:128);a[Z80.M]=3},bit_1b:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.B]&2?0:128);a[Z80.M]=2},bit_1c:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.C]&2?0:128);a[Z80.M]=2},bit_1d:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.D]&2?0:128);a[Z80.M]=2},bit_1e:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.E]&2?0:128);a[Z80.M]=2},bit_1h:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.H]&2?0:128);a[Z80.M]=2},bit_1l:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.L]&2?0:128);
a[Z80.M]=2},bit_1a:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.A]&2?0:128);a[Z80.M]=2},bit_1hlm:function(b,c,a){b=c.rb(a[Z80.H]<<8|a[Z80.L])&2;a[Z80.F]=a[Z80.F]&16|32|(b?0:128);a[Z80.M]=3},bit_2b:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.B]&4?0:128);a[Z80.M]=2},bit_2c:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.C]&4?0:128);a[Z80.M]=2},bit_2d:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.D]&4?0:128);a[Z80.M]=2},bit_2e:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.E]&4?0:128);a[Z80.M]=
2},bit_2h:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.H]&4?0:128);a[Z80.M]=2},bit_2l:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.L]&4?0:128);a[Z80.M]=2},bit_2a:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.A]&4?0:128);a[Z80.M]=2},bit_2hlm:function(b,c,a){b=c.rb(a[Z80.H]<<8|a[Z80.L])&4;a[Z80.F]=a[Z80.F]&16|32|(b?0:128);a[Z80.M]=3},bit_3b:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.B]&8?0:128);a[Z80.M]=2},bit_3c:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.C]&8?0:128);a[Z80.M]=2},bit_3d:function(b,
c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.D]&8?0:128);a[Z80.M]=2},bit_3e:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.E]&8?0:128);a[Z80.M]=2},bit_3h:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.H]&8?0:128);a[Z80.M]=2},bit_3l:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.L]&8?0:128);a[Z80.M]=2},bit_3a:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.A]&8?0:128);a[Z80.M]=2},bit_3hlm:function(b,c,a){b=c.rb(a[Z80.H]<<8|a[Z80.L])&8;a[Z80.F]=a[Z80.F]&16|32|(b?0:128);a[Z80.M]=3},bit_4b:function(b,c,a){a[Z80.F]=
a[Z80.F]&16|32|(a[Z80.B]&16?0:128);a[Z80.M]=2},bit_4c:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.C]&16?0:128);a[Z80.M]=2},bit_4d:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.D]&16?0:128);a[Z80.M]=2},bit_4e:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.E]&16?0:128);a[Z80.M]=2},bit_4h:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.H]&16?0:128);a[Z80.M]=2},bit_4l:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.L]&16?0:128);a[Z80.M]=2},bit_4a:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.A]&16?
0:128);a[Z80.M]=2},bit_4hlm:function(b,c,a){b=c.rb(a[Z80.H]<<8|a[Z80.L])&16;a[Z80.F]=a[Z80.F]&16|32|(b?0:128);a[Z80.M]=3},bit_5b:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.B]&32?0:128);a[Z80.M]=2},bit_5c:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.C]&32?0:128);a[Z80.M]=2},bit_5d:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.D]&32?0:128);a[Z80.M]=2},bit_5e:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.E]&32?0:128);a[Z80.M]=2},bit_5h:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.H]&32?0:128);
a[Z80.M]=2},bit_5l:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.L]&32?0:128);a[Z80.M]=2},bit_5a:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.A]&32?0:128);a[Z80.M]=2},bit_5hlm:function(b,c,a){b=c.rb(a[Z80.H]<<8|a[Z80.L])&32;a[Z80.F]=a[Z80.F]&16|32|(b?0:128);a[Z80.M]=3},bit_6b:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.B]&64?0:128);a[Z80.M]=2},bit_6c:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.C]&64?0:128);a[Z80.M]=2},bit_6d:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.D]&64?0:128);a[Z80.M]=
2},bit_6e:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.E]&64?0:128);a[Z80.M]=2},bit_6h:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.H]&64?0:128);a[Z80.M]=2},bit_6l:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.L]&64?0:128);a[Z80.M]=2},bit_6a:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.A]&64?0:128);a[Z80.M]=2},bit_6hlm:function(b,c,a){b=c.rb(a[Z80.H]<<8|a[Z80.L])&64;a[Z80.F]=a[Z80.F]&16|32|(b?0:128);a[Z80.M]=3},bit_7b:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.B]&128?0:128);a[Z80.M]=2},
bit_7c:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.C]&128?0:128);a[Z80.M]=2},bit_7d:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.D]&128?0:128);a[Z80.M]=2},bit_7e:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.E]&128?0:128);a[Z80.M]=2},bit_7h:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.H]&128?0:128);a[Z80.M]=2},bit_7l:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.L]&128?0:128);a[Z80.M]=2},bit_7a:function(b,c,a){a[Z80.F]=a[Z80.F]&16|32|(a[Z80.A]&128?0:128);a[Z80.M]=2},bit_7hlm:function(b,c,
a){b=c.rb(a[Z80.H]<<8|a[Z80.L])&128;a[Z80.F]=a[Z80.F]&16|32|(b?0:128);a[Z80.M]=3},set_0b:function(b,c,a){a[Z80.B]|=1;a[Z80.M]=2},set_0c:function(b,c,a){a[Z80.C]|=1;a[Z80.M]=2},set_0d:function(b,c,a){a[Z80.D]|=1;a[Z80.M]=2},set_0e:function(b,c,a){a[Z80.E]|=1;a[Z80.M]=2},set_0h:function(b,c,a){a[Z80.H]|=1;a[Z80.M]=2},set_0l:function(b,c,a){a[Z80.L]|=1;a[Z80.M]=2},set_0a:function(b,c,a){a[Z80.A]|=1;a[Z80.M]=2},set_0hlm:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],c.rb(a[Z80.H]<<8|a[Z80.L])|1);a[Z80.M]=
4},set_1b:function(b,c,a){a[Z80.B]|=2;a[Z80.M]=2},set_1c:function(b,c,a){a[Z80.C]|=2;a[Z80.M]=2},set_1d:function(b,c,a){a[Z80.D]|=2;a[Z80.M]=2},set_1e:function(b,c,a){a[Z80.E]|=2;a[Z80.M]=2},set_1h:function(b,c,a){a[Z80.H]|=2;a[Z80.M]=2},set_1l:function(b,c,a){a[Z80.L]|=2;a[Z80.M]=2},set_1a:function(b,c,a){a[Z80.A]|=2;a[Z80.M]=2},set_1hlm:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],c.rb(a[Z80.H]<<8|a[Z80.L])|2);a[Z80.M]=4},set_2b:function(b,c,a){a[Z80.B]|=4;a[Z80.M]=2},set_2c:function(b,c,a){a[Z80.C]|=
4;a[Z80.M]=2},set_2d:function(b,c,a){a[Z80.D]|=4;a[Z80.M]=2},set_2e:function(b,c,a){a[Z80.E]|=4;a[Z80.M]=2},set_2h:function(b,c,a){a[Z80.H]|=4;a[Z80.M]=2},set_2l:function(b,c,a){a[Z80.L]|=4;a[Z80.M]=2},set_2a:function(b,c,a){a[Z80.A]|=4;a[Z80.M]=2},set_2hlm:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],c.rb(a[Z80.H]<<8|a[Z80.L])|4);a[Z80.M]=4},set_3b:function(b,c,a){a[Z80.B]|=8;a[Z80.M]=2},set_3c:function(b,c,a){a[Z80.C]|=8;a[Z80.M]=2},set_3d:function(b,c,a){a[Z80.D]|=8;a[Z80.M]=2},set_3e:function(b,
c,a){a[Z80.E]|=8;a[Z80.M]=2},set_3h:function(b,c,a){a[Z80.H]|=8;a[Z80.M]=2},set_3l:function(b,c,a){a[Z80.L]|=8;a[Z80.M]=2},set_3a:function(b,c,a){a[Z80.A]|=8;a[Z80.M]=2},set_3hlm:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],c.rb(a[Z80.H]<<8|a[Z80.L])|8);a[Z80.M]=4},set_4b:function(b,c,a){a[Z80.B]|=16;a[Z80.M]=2},set_4c:function(b,c,a){a[Z80.C]|=16;a[Z80.M]=2},set_4d:function(b,c,a){a[Z80.D]|=16;a[Z80.M]=2},set_4e:function(b,c,a){a[Z80.E]|=16;a[Z80.M]=2},set_4h:function(b,c,a){a[Z80.H]|=16;a[Z80.M]=2},
set_4l:function(b,c,a){a[Z80.L]|=16;a[Z80.M]=2},set_4a:function(b,c,a){a[Z80.A]|=16;a[Z80.M]=2},set_4hlm:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],c.rb(a[Z80.H]<<8|a[Z80.L])|16);a[Z80.M]=4},set_5b:function(b,c,a){a[Z80.B]|=32;a[Z80.M]=2},set_5c:function(b,c,a){a[Z80.C]|=32;a[Z80.M]=2},set_5d:function(b,c,a){a[Z80.D]|=32;a[Z80.M]=2},set_5e:function(b,c,a){a[Z80.E]|=32;a[Z80.M]=2},set_5h:function(b,c,a){a[Z80.H]|=32;a[Z80.M]=2},set_5l:function(b,c,a){a[Z80.L]|=32;a[Z80.M]=2},set_5a:function(b,c,a){a[Z80.A]|=
32;a[Z80.M]=2},set_5hlm:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],c.rb(a[Z80.H]<<8|a[Z80.L])|32);a[Z80.M]=4},set_6b:function(b,c,a){a[Z80.B]|=64;a[Z80.M]=2},set_6c:function(b,c,a){a[Z80.C]|=64;a[Z80.M]=2},set_6d:function(b,c,a){a[Z80.D]|=64;a[Z80.M]=2},set_6e:function(b,c,a){a[Z80.E]|=64;a[Z80.M]=2},set_6h:function(b,c,a){a[Z80.H]|=64;a[Z80.M]=2},set_6l:function(b,c,a){a[Z80.L]|=64;a[Z80.M]=2},set_6a:function(b,c,a){a[Z80.A]|=64;a[Z80.M]=2},set_6hlm:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],c.rb(a[Z80.H]<<
8|a[Z80.L])|64);a[Z80.M]=4},set_7b:function(b,c,a){a[Z80.B]|=128;a[Z80.M]=2},set_7c:function(b,c,a){a[Z80.C]|=128;a[Z80.M]=2},set_7d:function(b,c,a){a[Z80.D]|=128;a[Z80.M]=2},set_7e:function(b,c,a){a[Z80.E]|=128;a[Z80.M]=2},set_7h:function(b,c,a){a[Z80.H]|=128;a[Z80.M]=2},set_7l:function(b,c,a){a[Z80.L]|=128;a[Z80.M]=2},set_7a:function(b,c,a){a[Z80.A]|=128;a[Z80.M]=2},set_7hlm:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],c.rb(a[Z80.H]<<8|a[Z80.L])|128);a[Z80.M]=4},res_0b:function(b,c,a){a[Z80.B]&=254;
a[Z80.M]=2},res_0c:function(b,c,a){a[Z80.C]&=254;a[Z80.M]=2},res_0d:function(b,c,a){a[Z80.D]&=254;a[Z80.M]=2},res_0e:function(b,c,a){a[Z80.E]&=254;a[Z80.M]=2},res_0h:function(b,c,a){a[Z80.H]&=254;a[Z80.M]=2},res_0l:function(b,c,a){a[Z80.L]&=254;a[Z80.M]=2},res_0a:function(b,c,a){a[Z80.A]&=254;a[Z80.M]=2},res_0hlm:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],c.rb(a[Z80.H]<<8|a[Z80.L])&254);a[Z80.M]=4},res_1b:function(b,c,a){a[Z80.B]&=253;a[Z80.M]=2},res_1c:function(b,c,a){a[Z80.C]&=253;a[Z80.M]=2},res_1d:function(b,
c,a){a[Z80.D]&=253;a[Z80.M]=2},res_1e:function(b,c,a){a[Z80.E]&=253;a[Z80.M]=2},res_1h:function(b,c,a){a[Z80.H]&=253;a[Z80.M]=2},res_1l:function(b,c,a){a[Z80.L]&=253;a[Z80.M]=2},res_1a:function(b,c,a){a[Z80.A]&=253;a[Z80.M]=2},res_1hlm:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],c.rb(a[Z80.H]<<8|a[Z80.L])&253);a[Z80.M]=4},res_2b:function(b,c,a){a[Z80.B]&=251;a[Z80.M]=2},res_2c:function(b,c,a){a[Z80.C]&=251;a[Z80.M]=2},res_2d:function(b,c,a){a[Z80.D]&=251;a[Z80.M]=2},res_2e:function(b,c,a){a[Z80.E]&=
251;a[Z80.M]=2},res_2h:function(b,c,a){a[Z80.H]&=251;a[Z80.M]=2},res_2l:function(b,c,a){a[Z80.L]&=251;a[Z80.M]=2},res_2a:function(b,c,a){a[Z80.A]&=251;a[Z80.M]=2},res_2hlm:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],c.rb(a[Z80.H]<<8|a[Z80.L])&251);a[Z80.M]=4},res_3b:function(b,c,a){a[Z80.B]&=247;a[Z80.M]=2},res_3c:function(b,c,a){a[Z80.C]&=247;a[Z80.M]=2},res_3d:function(b,c,a){a[Z80.D]&=247;a[Z80.M]=2},res_3e:function(b,c,a){a[Z80.E]&=247;a[Z80.M]=2},res_3h:function(b,c,a){a[Z80.H]&=247;a[Z80.M]=2},
res_3l:function(b,c,a){a[Z80.L]&=247;a[Z80.M]=2},res_3a:function(b,c,a){a[Z80.A]&=247;a[Z80.M]=2},res_3hlm:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],c.rb(a[Z80.H]<<8|a[Z80.L])&247);a[Z80.M]=4},res_4b:function(b,c,a){a[Z80.B]&=239;a[Z80.M]=2},res_4c:function(b,c,a){a[Z80.C]&=239;a[Z80.M]=2},res_4d:function(b,c,a){a[Z80.D]&=239;a[Z80.M]=2},res_4e:function(b,c,a){a[Z80.E]&=239;a[Z80.M]=2},res_4h:function(b,c,a){a[Z80.H]&=239;a[Z80.M]=2},res_4l:function(b,c,a){a[Z80.L]&=239;a[Z80.M]=2},res_4a:function(b,
c,a){a[Z80.A]&=239;a[Z80.M]=2},res_4hlm:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],c.rb(a[Z80.H]<<8|a[Z80.L])&239);a[Z80.M]=4},res_5b:function(b,c,a){a[Z80.B]&=223;a[Z80.M]=2},res_5c:function(b,c,a){a[Z80.C]&=223;a[Z80.M]=2},res_5d:function(b,c,a){a[Z80.D]&=223;a[Z80.M]=2},res_5e:function(b,c,a){a[Z80.E]&=223;a[Z80.M]=2},res_5h:function(b,c,a){a[Z80.H]&=223;a[Z80.M]=2},res_5l:function(b,c,a){a[Z80.L]&=223;a[Z80.M]=2},res_5a:function(b,c,a){a[Z80.A]&=223;a[Z80.M]=2},res_5hlm:function(b,c,a){c.wb(a[Z80.H]<<
8|a[Z80.L],c.rb(a[Z80.H]<<8|a[Z80.L])&223);a[Z80.M]=4},res_6b:function(b,c,a){a[Z80.B]&=191;a[Z80.M]=2},res_6c:function(b,c,a){a[Z80.C]&=191;a[Z80.M]=2},res_6d:function(b,c,a){a[Z80.D]&=191;a[Z80.M]=2},res_6e:function(b,c,a){a[Z80.E]&=191;a[Z80.M]=2},res_6h:function(b,c,a){a[Z80.H]&=191;a[Z80.M]=2},res_6l:function(b,c,a){a[Z80.L]&=191;a[Z80.M]=2},res_6a:function(b,c,a){a[Z80.A]&=191;a[Z80.M]=2},res_6hlm:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],c.rb(a[Z80.H]<<8|a[Z80.L])&191);a[Z80.M]=4},res_7b:function(b,
c,a){a[Z80.B]&=127;a[Z80.M]=2},res_7c:function(b,c,a){a[Z80.C]&=127;a[Z80.M]=2},res_7d:function(b,c,a){a[Z80.D]&=127;a[Z80.M]=2},res_7e:function(b,c,a){a[Z80.E]&=127;a[Z80.M]=2},res_7h:function(b,c,a){a[Z80.H]&=127;a[Z80.M]=2},res_7l:function(b,c,a){a[Z80.L]&=127;a[Z80.M]=2},res_7a:function(b,c,a){a[Z80.A]&=127;a[Z80.M]=2},res_7hlm:function(b,c,a){c.wb(a[Z80.H]<<8|a[Z80.L],c.rb(a[Z80.H]<<8|a[Z80.L])&127);a[Z80.M]=4},ccf:function(b,c,a){a[Z80.F]=a[Z80.F]&128|a[Z80.F]&16^16;a[Z80.M]=1},scf:function(b,
c,a){a[Z80.F]=a[Z80.F]&128|16;a[Z80.M]=1},nop:function(b,c,a){a[Z80.M]=1},halt:function(b,c,a){b.halt=1;a[Z80.M]=1},stop:function(b,c,a){b.stop=1;a[Z80.M]=1;throw"stop";},di:function(b,c,a){b.ime=0;a[Z80.M]=1},ei:function(b,c,a){b.ime=1;a[Z80.M]=1},jp_nn:function(b,c,a,d){d[Z80.PC]=c.rw(d[Z80.PC]);a[Z80.M]=4},jp_hl:function(b,c,a,d){d[Z80.PC]=a[Z80.H]<<8|a[Z80.L];a[Z80.M]=1},jp_nz_nn:function(b,c,a,d){a[Z80.F]&128?(d[Z80.PC]+=2,a[Z80.M]=3):(d[Z80.PC]=c.rw(d[Z80.PC]),a[Z80.M]=4)},jp_z_nn:function(b,
c,a,d){a[Z80.F]&128?(d[Z80.PC]=c.rw(d[Z80.PC]),a[Z80.M]=4):(d[Z80.PC]+=2,a[Z80.M]=3)},jp_nc_nn:function(b,c,a,d){a[Z80.F]&16?(d[Z80.PC]+=2,a[Z80.M]=3):(d[Z80.PC]=c.rw(d[Z80.PC]),a[Z80.M]=4)},jp_c_nn:function(b,c,a,d){a[Z80.F]&16?(d[Z80.PC]=c.rw(d[Z80.PC]),a[Z80.M]=4):(d[Z80.PC]+=2,a[Z80.M]=3)},jr_n:function(b,c,a,d){b=c.rb(d[Z80.PC]++);d[Z80.PC]+=b>127?(b&127)-128:b;a[Z80.M]=3},jr_nz_n:function(b,c,a,d){a[Z80.F]&128?(d[Z80.PC]++,a[Z80.M]=2):(b=c.rb(d[Z80.PC]++),d[Z80.PC]+=b>127?(b&127)-128:b,a[Z80.M]=
3)},jr_z_n:function(b,c,a,d){a[Z80.F]&128?(b=c.rb(d[Z80.PC]++),d[Z80.PC]+=b>127?(b&127)-128:b,a[Z80.M]=3):(d[Z80.PC]++,a[Z80.M]=2)},jr_nc_n:function(b,c,a,d){a[Z80.F]&16?(d[Z80.PC]++,a[Z80.M]=2):(b=c.rb(d[Z80.PC]++),d[Z80.PC]+=b>127?(b&127)-128:b,a[Z80.M]=3)},jr_c_n:function(b,c,a,d){a[Z80.F]&16?(b=c.rb(d[Z80.PC]++),d[Z80.PC]+=b>127?(b&127)-128:b,a[Z80.M]=3):(d[Z80.PC]++,a[Z80.M]=2)},call_nn:function(b,c,a,d){d[Z80.SP]-=2;c.ww(d[Z80.SP],d[Z80.PC]+2);d[Z80.PC]=c.rw(d[Z80.PC]);a[Z80.M]=6},call_nz_nn:function(b,
c,a,d){a[Z80.F]&128?(a[Z80.M]=3,d[Z80.PC]+=2):(d[Z80.SP]-=2,c.ww(d[Z80.SP],d[Z80.PC]+2),d[Z80.PC]=c.rw(d[Z80.PC]),a[Z80.M]=6)},call_z_nn:function(b,c,a,d){a[Z80.F]&128?(d[Z80.SP]-=2,c.ww(d[Z80.SP],d[Z80.PC]+2),d[Z80.PC]=c.rw(d[Z80.PC]),a[Z80.M]=6):(a[Z80.M]=3,d[Z80.PC]+=2)},call_nc_nn:function(b,c,a,d){a[Z80.F]&16?(a[Z80.M]=3,d[Z80.PC]+=2):(d[Z80.SP]-=2,c.ww(d[Z80.SP],d[Z80.PC]+2),d[Z80.PC]=c.rw(d[Z80.PC]),a[Z80.M]=6)},call_c_nn:function(b,c,a,d){a[Z80.F]&16?(d[Z80.SP]-=2,c.ww(d[Z80.SP],d[Z80.PC]+
2),d[Z80.PC]=c.rw(d[Z80.PC]),a[Z80.M]=6):(a[Z80.M]=3,d[Z80.PC]+=2)},ret:function(b,c,a,d){d[Z80.PC]=c.rw(d[Z80.SP]);d[Z80.SP]+=2;a[Z80.M]=4},ret_nz:function(b,c,a,d){a[Z80.F]&128?a[Z80.M]=2:(d[Z80.PC]=c.rw(d[Z80.SP]),d[Z80.SP]+=2,a[Z80.M]=5)},ret_z:function(b,c,a,d){a[Z80.F]&128?(d[Z80.PC]=c.rw(d[Z80.SP]),d[Z80.SP]+=2,a[Z80.M]=5):a[Z80.M]=2},ret_nc:function(b,c,a,d){a[Z80.F]&16?a[Z80.M]=2:(d[Z80.PC]=c.rw(d[Z80.SP]),d[Z80.SP]+=2,a[Z80.M]=5)},ret_c:function(b,c,a,d){a[Z80.F]&16?(d[Z80.PC]=c.rw(d[Z80.SP]),
d[Z80.SP]+=2,a[Z80.M]=5):a[Z80.M]=2},reti:function(b,c,a,d){b.ime=1;d[Z80.PC]=c.rw(d[Z80.SP]);d[Z80.SP]+=2;a[Z80.M]=4},rst_00:function(b,c,a,d){d[Z80.SP]-=2;c.ww(d[Z80.SP],d[Z80.PC]);d[Z80.PC]=0;a[Z80.M]=4},rst_08:function(b,c,a,d){d[Z80.SP]-=2;c.ww(d[Z80.SP],d[Z80.PC]);d[Z80.PC]=8;a[Z80.M]=4},rst_10:function(b,c,a,d){d[Z80.SP]-=2;c.ww(d[Z80.SP],d[Z80.PC]);d[Z80.PC]=16;a[Z80.M]=4},rst_18:function(b,c,a,d){d[Z80.SP]-=2;c.ww(d[Z80.SP],d[Z80.PC]);d[Z80.PC]=24;a[Z80.M]=4},rst_20:function(b,c,a,d){d[Z80.SP]-=
2;c.ww(d[Z80.SP],d[Z80.PC]);d[Z80.PC]=32;a[Z80.M]=4},rst_28:function(b,c,a,d){d[Z80.SP]-=2;c.ww(d[Z80.SP],d[Z80.PC]);d[Z80.PC]=40;a[Z80.M]=4},rst_30:function(b,c,a,d){d[Z80.SP]-=2;c.ww(d[Z80.SP],d[Z80.PC]);d[Z80.PC]=48;a[Z80.M]=4},rst_38:function(b,c,a,d){d[Z80.SP]-=2;c.ww(d[Z80.SP],d[Z80.PC]);d[Z80.PC]=56;a[Z80.M]=4},rst_40:function(b,c,a,d){d[Z80.SP]-=2;c.ww(d[Z80.SP],d[Z80.PC]);d[Z80.PC]=64;a[Z80.M]=4},rst_48:function(b,c,a,d){d[Z80.SP]-=2;c.ww(d[Z80.SP],d[Z80.PC]);d[Z80.PC]=72;a[Z80.M]=4},rst_50:function(b,
c,a,d){d[Z80.SP]-=2;c.ww(d[Z80.SP],d[Z80.PC]);d[Z80.PC]=80;a[Z80.M]=4},rst_58:function(b,c,a,d){d[Z80.SP]-=2;c.ww(d[Z80.SP],d[Z80.PC]);d[Z80.PC]=88;a[Z80.M]=4},rst_60:function(b,c,a,d){d[Z80.SP]-=2;c.ww(d[Z80.SP],d[Z80.PC]);d[Z80.PC]=96;a[Z80.M]=4}};
Z80.daa_table=[128,256,512,768,1024,1280,1536,1792,2048,2304,4128,4384,4640,4896,5152,5408,4096,4352,4608,4864,5120,5376,5632,5888,6144,6400,8224,8480,8736,8992,9248,9504,8192,8448,8704,8960,9216,9472,9728,9984,10240,10496,12320,12576,12832,13088,13344,13600,12288,12544,12800,13056,13312,13568,13824,14080,14336,14592,16416,16672,16928,17184,17440,17696,16384,16640,16896,17152,17408,17664,17920,18176,18432,18688,20512,20768,21024,21280,21536,21792,20480,20736,20992,21248,21504,21760,22016,22272,22528,
22784,24608,24864,25120,25376,25632,25888,24576,24832,25088,25344,25600,25856,26112,26368,26624,26880,28704,28960,29216,29472,29728,29984,28672,28928,29184,29440,29696,29952,30208,30464,30720,30976,32800,33056,33312,33568,33824,34080,32768,33024,33280,33536,33792,34048,34304,34560,34816,35072,36896,37152,37408,37664,37920,38176,36864,37120,37376,37632,37888,38144,38400,38656,38912,39168,176,304,560,816,1072,1328,144,272,528,784,1040,1296,1552,1808,2064,2320,4144,4400,4656,4912,5168,5424,4112,4368,
4624,4880,5136,5392,5648,5904,6160,6416,8240,8496,8752,9008,9264,9520,8208,8464,8720,8976,9232,9488,9744,1E4,10256,10512,12336,12592,12848,13104,13360,13616,12304,12560,12816,13072,13328,13584,13840,14096,14352,14608,16432,16688,16944,17200,17456,17712,16400,16656,16912,17168,17424,17680,17936,18192,18448,18704,20528,20784,21040,21296,21552,21808,20496,20752,21008,21264,21520,21776,22032,22288,22544,22800,24624,24880,25136,25392,25648,25904,24592,24848,25104,25360,25616,25872,26128,26384,26640,26896,
28720,28976,29232,29488,29744,3E4,28688,28944,29200,29456,29712,29968,30224,30480,30736,30992,32816,33072,33328,33584,33840,34096,32784,33040,33296,33552,33808,34064,34320,34576,34832,35088,36912,37168,37424,37680,37936,38192,36880,37136,37392,37648,37904,38160,38416,38672,38928,39184,41008,41264,41520,41776,42032,42288,40976,41232,41488,41744,42E3,42256,42512,42768,43024,43280,45104,45360,45616,45872,46128,46384,45072,45328,45584,45840,46096,46352,46608,46864,47120,47376,49200,49456,49712,49968,
50224,50480,49168,49424,49680,49936,50192,50448,50704,50960,51216,51472,53296,53552,53808,54064,54320,54576,53264,53520,53776,54032,54288,54544,54800,55056,55312,55568,57392,57648,57904,58160,58416,58672,57360,57616,57872,58128,58384,58640,58896,59152,59408,59664,61488,61744,62E3,62256,62512,62768,61456,61712,61968,62224,62480,62736,62992,63248,63504,63760,176,304,560,816,1072,1328,144,272,528,784,1040,1296,1552,1808,2064,2320,4144,4400,4656,4912,5168,5424,4112,4368,4624,4880,5136,5392,5648,5904,
6160,6416,8240,8496,8752,9008,9264,9520,8208,8464,8720,8976,9232,9488,9744,1E4,10256,10512,12336,12592,12848,13104,13360,13616,12304,12560,12816,13072,13328,13584,13840,14096,14352,14608,16432,16688,16944,17200,17456,17712,16400,16656,16912,17168,17424,17680,17936,18192,18448,18704,20528,20784,21040,21296,21552,21808,20496,20752,21008,21264,21520,21776,22032,22288,22544,22800,24624,24880,25136,25392,25648,25904,1536,1792,2048,2304,2560,2816,3072,3328,3584,3840,4128,4384,4640,4896,5152,5408,5632,5888,
6144,6400,6656,6912,7168,7424,7680,7936,8224,8480,8736,8992,9248,9504,9728,9984,10240,10496,10752,11008,11264,11520,11776,12032,12320,12576,12832,13088,13344,13600,13824,14080,14336,14592,14848,15104,15360,15616,15872,16128,16416,16672,16928,17184,17440,17696,17920,18176,18432,18688,18944,19200,19456,19712,19968,20224,20512,20768,21024,21280,21536,21792,22016,22272,22528,22784,23040,23296,23552,23808,24064,24320,24608,24864,25120,25376,25632,25888,26112,26368,26624,26880,27136,27392,27648,27904,28160,
28416,28704,28960,29216,29472,29728,29984,30208,30464,30720,30976,31232,31488,31744,32E3,32256,32512,32800,33056,33312,33568,33824,34080,34304,34560,34816,35072,35328,35584,35840,36096,36352,36608,36896,37152,37408,37664,37920,38176,38400,38656,38912,39168,39424,39680,39936,40192,40448,40704,176,304,560,816,1072,1328,1552,1808,2064,2320,2576,2832,3088,3344,3600,3856,4144,4400,4656,4912,5168,5424,5648,5904,6160,6416,6672,6928,7184,7440,7696,7952,8240,8496,8752,9008,9264,9520,9744,1E4,10256,10512,10768,
11024,11280,11536,11792,12048,12336,12592,12848,13104,13360,13616,13840,14096,14352,14608,14864,15120,15376,15632,15888,16144,16432,16688,16944,17200,17456,17712,17936,18192,18448,18704,18960,19216,19472,19728,19984,20240,20528,20784,21040,21296,21552,21808,22032,22288,22544,22800,23056,23312,23568,23824,24080,24336,24624,24880,25136,25392,25648,25904,26128,26384,26640,26896,27152,27408,27664,27920,28176,28432,28720,28976,29232,29488,29744,3E4,30224,30480,30736,30992,31248,31504,31760,32016,32272,
32528,32816,33072,33328,33584,33840,34096,34320,34576,34832,35088,35344,35600,35856,36112,36368,36624,36912,37168,37424,37680,37936,38192,38416,38672,38928,39184,39440,39696,39952,40208,40464,40720,41008,41264,41520,41776,42032,42288,42512,42768,43024,43280,43536,43792,44048,44304,44560,44816,45104,45360,45616,45872,46128,46384,46608,46864,47120,47376,47632,47888,48144,48400,48656,48912,49200,49456,49712,49968,50224,50480,50704,50960,51216,51472,51728,51984,52240,52496,52752,53008,53296,53552,53808,
54064,54320,54576,54800,55056,55312,55568,55824,56080,56336,56592,56848,57104,57392,57648,57904,58160,58416,58672,58896,59152,59408,59664,59920,60176,60432,60688,60944,61200,61488,61744,62E3,62256,62512,62768,62992,63248,63504,63760,64016,64272,64528,64784,65040,65296,176,304,560,816,1072,1328,1552,1808,2064,2320,2576,2832,3088,3344,3600,3856,4144,4400,4656,4912,5168,5424,5648,5904,6160,6416,6672,6928,7184,7440,7696,7952,8240,8496,8752,9008,9264,9520,9744,1E4,10256,10512,10768,11024,11280,11536,11792,
12048,12336,12592,12848,13104,13360,13616,13840,14096,14352,14608,14864,15120,15376,15632,15888,16144,16432,16688,16944,17200,17456,17712,17936,18192,18448,18704,18960,19216,19472,19728,19984,20240,20528,20784,21040,21296,21552,21808,22032,22288,22544,22800,23056,23312,23568,23824,24080,24336,24624,24880,25136,25392,25648,25904,192,320,576,832,1088,1344,1600,1856,2112,2368,1088,1344,1600,1856,2112,2368,4160,4416,4672,4928,5184,5440,5696,5952,6208,6464,5184,5440,5696,5952,6208,6464,8256,8512,8768,
9024,9280,9536,9792,10048,10304,10560,9280,9536,9792,10048,10304,10560,12352,12608,12864,13120,13376,13632,13888,14144,14400,14656,13376,13632,13888,14144,14400,14656,16448,16704,16960,17216,17472,17728,17984,18240,18496,18752,17472,17728,17984,18240,18496,18752,20544,20800,21056,21312,21568,21824,22080,22336,22592,22848,21568,21824,22080,22336,22592,22848,24640,24896,25152,25408,25664,25920,26176,26432,26688,26944,25664,25920,26176,26432,26688,26944,28736,28992,29248,29504,29760,30016,30272,30528,
30784,31040,29760,30016,30272,30528,30784,31040,32832,33088,33344,33600,33856,34112,34368,34624,34880,35136,33856,34112,34368,34624,34880,35136,36928,37184,37440,37696,37952,38208,38464,38720,38976,39232,13392,13648,13904,14160,14416,14672,16464,16720,16976,17232,17488,17744,18E3,18256,18512,18768,17488,17744,18E3,18256,18512,18768,20560,20816,21072,21328,21584,21840,22096,22352,22608,22864,21584,21840,22096,22352,22608,22864,24656,24912,25168,25424,25680,25936,26192,26448,26704,26960,25680,25936,
26192,26448,26704,26960,28752,29008,29264,29520,29776,30032,30288,30544,30800,31056,29776,30032,30288,30544,30800,31056,32848,33104,33360,33616,33872,34128,34384,34640,34896,35152,33872,34128,34384,34640,34896,35152,36944,37200,37456,37712,37968,38224,38480,38736,38992,39248,37968,38224,38480,38736,38992,39248,41040,41296,41552,41808,42064,42320,42576,42832,43088,43344,42064,42320,42576,42832,43088,43344,45136,45392,45648,45904,46160,46416,46672,46928,47184,47440,46160,46416,46672,46928,47184,47440,
49232,49488,49744,5E4,50256,50512,50768,51024,51280,51536,50256,50512,50768,51024,51280,51536,53328,53584,53840,54096,54352,54608,54864,55120,55376,55632,54352,54608,54864,55120,55376,55632,57424,57680,57936,58192,58448,58704,58960,59216,59472,59728,58448,58704,58960,59216,59472,59728,61520,61776,62032,62288,62544,62800,63056,63312,63568,63824,62544,62800,63056,63312,63568,63824,208,336,592,848,1104,1360,1616,1872,2128,2384,1104,1360,1616,1872,2128,2384,4176,4432,4688,4944,5200,5456,5712,5968,6224,
6480,5200,5456,5712,5968,6224,6480,8272,8528,8784,9040,9296,9552,9808,10064,10320,10576,9296,9552,9808,10064,10320,10576,12368,12624,12880,13136,13392,13648,13904,14160,14416,14672,13392,13648,13904,14160,14416,14672,16464,16720,16976,17232,17488,17744,18E3,18256,18512,18768,17488,17744,18E3,18256,18512,18768,20560,20816,21072,21328,21584,21840,22096,22352,22608,22864,21584,21840,22096,22352,22608,22864,24656,24912,25168,25424,25680,25936,26192,26448,26704,26960,25680,25936,26192,26448,26704,26960,
28752,29008,29264,29520,29776,30032,30288,30544,30800,31056,29776,30032,30288,30544,30800,31056,32848,33104,33360,33616,33872,34128,34384,34640,34896,35152,33872,34128,34384,34640,34896,35152,36944,37200,37456,37712,37968,38224,38480,38736,38992,39248,37968,38224,38480,38736,38992,39248,64096,64352,64608,64864,65120,65376,192,320,576,832,1088,1344,1600,1856,2112,2368,2656,2912,3168,3424,3680,3936,4160,4416,4672,4928,5184,5440,5696,5952,6208,6464,6752,7008,7264,7520,7776,8032,8256,8512,8768,9024,9280,
9536,9792,10048,10304,10560,10848,11104,11360,11616,11872,12128,12352,12608,12864,13120,13376,13632,13888,14144,14400,14656,14944,15200,15456,15712,15968,16224,16448,16704,16960,17216,17472,17728,17984,18240,18496,18752,19040,19296,19552,19808,20064,20320,20544,20800,21056,21312,21568,21824,22080,22336,22592,22848,23136,23392,23648,23904,24160,24416,24640,24896,25152,25408,25664,25920,26176,26432,26688,26944,27232,27488,27744,28E3,28256,28512,28736,28992,29248,29504,29760,30016,30272,30528,30784,
31040,31328,31584,31840,32096,32352,32608,32832,33088,33344,33600,33856,34112,34368,34624,34880,35136,35424,35680,35936,36192,36448,36704,36928,37184,37440,37696,13392,13648,13904,14160,14416,14672,14960,15216,15472,15728,15984,16240,16464,16720,16976,17232,17488,17744,18E3,18256,18512,18768,19056,19312,19568,19824,20080,20336,20560,20816,21072,21328,21584,21840,22096,22352,22608,22864,23152,23408,23664,23920,24176,24432,24656,24912,25168,25424,25680,25936,26192,26448,26704,26960,27248,27504,27760,
28016,28272,28528,28752,29008,29264,29520,29776,30032,30288,30544,30800,31056,31344,31600,31856,32112,32368,32624,32848,33104,33360,33616,33872,34128,34384,34640,34896,35152,35440,35696,35952,36208,36464,36720,36944,37200,37456,37712,37968,38224,38480,38736,38992,39248,39536,39792,40048,40304,40560,40816,41040,41296,41552,41808,42064,42320,42576,42832,43088,43344,43632,43888,44144,44400,44656,44912,45136,45392,45648,45904,46160,46416,46672,46928,47184,47440,47728,47984,48240,48496,48752,49008,49232,
49488,49744,5E4,50256,50512,50768,51024,51280,51536,51824,52080,52336,52592,52848,53104,53328,53584,53840,54096,54352,54608,54864,55120,55376,55632,55920,56176,56432,56688,56944,57200,57424,57680,57936,58192,58448,58704,58960,59216,59472,59728,60016,60272,60528,60784,61040,61296,61520,61776,62032,62288,62544,62800,63056,63312,63568,63824,64112,64368,64624,64880,65136,65392,208,336,592,848,1104,1360,1616,1872,2128,2384,2672,2928,3184,3440,3696,3952,4176,4432,4688,4944,5200,5456,5712,5968,6224,6480,
6768,7024,7280,7536,7792,8048,8272,8528,8784,9040,9296,9552,9808,10064,10320,10576,10864,11120,11376,11632,11888,12144,12368,12624,12880,13136,13392,13648,13904,14160,14416,14672,14960,15216,15472,15728,15984,16240,16464,16720,16976,17232,17488,17744,18E3,18256,18512,18768,19056,19312,19568,19824,20080,20336,20560,20816,21072,21328,21584,21840,22096,22352,22608,22864,23152,23408,23664,23920,24176,24432,24656,24912,25168,25424,25680,25936,26192,26448,26704,26960,27248,27504,27760,28016,28272,28528,
28752,29008,29264,29520,29776,30032,30288,30544,30800,31056,31344,31600,31856,32112,32368,32624,32848,33104,33360,33616,33872,34128,34384,34640,34896,35152,35440,35696,35952,36208,36464,36720,36944,37200,37456,37712,37968,38224,38480,38736,38992,39248];
Z80.map=[Z80.ops.nop,Z80.ops.ld_bcnn,Z80.ops.ld_bca,Z80.ops.inc_bc,Z80.ops.inc_b,Z80.ops.dec_b,Z80.ops.ld_bn,Z80.ops.rlca,Z80.ops.ld_nnsp,Z80.ops.add_hlbc,Z80.ops.ld_abc,Z80.ops.dec_bc,Z80.ops.inc_c,Z80.ops.dec_c,Z80.ops.ld_cn,Z80.ops.rrca,Z80.ops.stop,Z80.ops.ld_denn,Z80.ops.ld_dea,Z80.ops.inc_de,Z80.ops.inc_d,Z80.ops.dec_d,Z80.ops.ld_dn,Z80.ops.rla,Z80.ops.jr_n,Z80.ops.add_hlde,Z80.ops.ld_ade,Z80.ops.dec_de,Z80.ops.inc_e,Z80.ops.dec_e,Z80.ops.ld_en,Z80.ops.rr_a,Z80.ops.jr_nz_n,Z80.ops.ld_hlnn,Z80.ops.ldi_hlma,
Z80.ops.inc_hl,Z80.ops.inc_h,Z80.ops.dec_h,Z80.ops.ld_hn,Z80.ops.daa,Z80.ops.jr_z_n,Z80.ops.add_hlhl,Z80.ops.ldi_ahlm,Z80.ops.dec_hl,Z80.ops.inc_l,Z80.ops.dec_l,Z80.ops.ld_ln,Z80.ops.cpl,Z80.ops.jr_nc_n,Z80.ops.ld_spnn,Z80.ops.ldd_hlma,Z80.ops.inc_sp,Z80.ops.inc_hlm,Z80.ops.dec_hlm,Z80.ops.ld_hlmn,Z80.ops.scf,Z80.ops.jr_c_n,Z80.ops.add_hlsp,Z80.ops.ldd_ahlm,Z80.ops.dec_sp,Z80.ops.inc_a,Z80.ops.dec_a,Z80.ops.ld_an,Z80.ops.ccf,Z80.ops.ld_bb,Z80.ops.ld_bc,Z80.ops.ld_bd,Z80.ops.ld_be,Z80.ops.ld_bh,Z80.ops.ld_bl,
Z80.ops.ld_bhlm,Z80.ops.ld_ba,Z80.ops.ld_cb,Z80.ops.ld_cc,Z80.ops.ld_cd,Z80.ops.ld_ce,Z80.ops.ld_ch,Z80.ops.ld_cl,Z80.ops.ld_chlm,Z80.ops.ld_ca,Z80.ops.ld_db,Z80.ops.ld_dc,Z80.ops.ld_dd,Z80.ops.ld_de,Z80.ops.ld_dh,Z80.ops.ld_dl,Z80.ops.ld_dhlm,Z80.ops.ld_da,Z80.ops.ld_eb,Z80.ops.ld_ec,Z80.ops.ld_ed,Z80.ops.ld_ee,Z80.ops.ld_eh,Z80.ops.ld_el,Z80.ops.ld_ehlm,Z80.ops.ld_ea,Z80.ops.ld_hb,Z80.ops.ld_hc,Z80.ops.ld_hd,Z80.ops.ld_he,Z80.ops.ld_hh,Z80.ops.ld_hl,Z80.ops.ld_hhlm,Z80.ops.ld_ha,Z80.ops.ld_lb,Z80.ops.ld_lc,
Z80.ops.ld_ld,Z80.ops.ld_le,Z80.ops.ld_lh,Z80.ops.ld_ll,Z80.ops.ld_lhlm,Z80.ops.ld_la,Z80.ops.ld_hlmb,Z80.ops.ld_hlmc,Z80.ops.ld_hlmd,Z80.ops.ld_hlme,Z80.ops.ld_hlmh,Z80.ops.ld_hlml,Z80.ops.halt,Z80.ops.ld_hlma,Z80.ops.ld_ab,Z80.ops.ld_ac,Z80.ops.ld_ad,Z80.ops.ld_ae,Z80.ops.ld_ah,Z80.ops.ld_al,Z80.ops.ld_ahlm,Z80.ops.ld_aa,Z80.ops.add_ab,Z80.ops.add_ac,Z80.ops.add_ad,Z80.ops.add_ae,Z80.ops.add_ah,Z80.ops.add_al,Z80.ops.add_ahlm,Z80.ops.add_aa,Z80.ops.adc_ab,Z80.ops.adc_ac,Z80.ops.adc_ad,Z80.ops.adc_ae,
Z80.ops.adc_ah,Z80.ops.adc_al,Z80.ops.adc_ahlm,Z80.ops.adc_aa,Z80.ops.sub_ab,Z80.ops.sub_ac,Z80.ops.sub_ad,Z80.ops.sub_ae,Z80.ops.sub_ah,Z80.ops.sub_al,Z80.ops.sub_ahlm,Z80.ops.sub_aa,Z80.ops.sbc_ab,Z80.ops.sbc_ac,Z80.ops.sbc_ad,Z80.ops.sbc_ae,Z80.ops.sbc_ah,Z80.ops.sbc_al,Z80.ops.sbc_ahlm,Z80.ops.sbc_aa,Z80.ops.and_ab,Z80.ops.and_ac,Z80.ops.and_ad,Z80.ops.and_ae,Z80.ops.and_ah,Z80.ops.and_al,Z80.ops.and_ahlm,Z80.ops.and_aa,Z80.ops.xor_ab,Z80.ops.xor_ac,Z80.ops.xor_ad,Z80.ops.xor_ae,Z80.ops.xor_ah,
Z80.ops.xor_al,Z80.ops.xor_ahlm,Z80.ops.xor_aa,Z80.ops.or_ab,Z80.ops.or_ac,Z80.ops.or_ad,Z80.ops.or_ae,Z80.ops.or_ah,Z80.ops.or_al,Z80.ops.or_ahlm,Z80.ops.or_aa,Z80.ops.cp_ab,Z80.ops.cp_ac,Z80.ops.cp_ad,Z80.ops.cp_ae,Z80.ops.cp_ah,Z80.ops.cp_al,Z80.ops.cp_ahlm,Z80.ops.cp_aa,Z80.ops.ret_nz,Z80.ops.pop_bc,Z80.ops.jp_nz_nn,Z80.ops.jp_nn,Z80.ops.call_nz_nn,Z80.ops.push_bc,Z80.ops.add_an,Z80.ops.rst_00,Z80.ops.ret_z,Z80.ops.ret,Z80.ops.jp_z_nn,Z80.ops.map_cb,Z80.ops.call_z_nn,Z80.ops.call_nn,Z80.ops.adc_an,
Z80.ops.rst_08,Z80.ops.ret_nc,Z80.ops.pop_de,Z80.ops.jp_nc_nn,Z80.ops.xx,Z80.ops.call_nc_nn,Z80.ops.push_de,Z80.ops.sub_an,Z80.ops.rst_10,Z80.ops.ret_c,Z80.ops.reti,Z80.ops.jp_c_nn,Z80.ops.xx,Z80.ops.call_c_nn,Z80.ops.xx,Z80.ops.sbc_an,Z80.ops.rst_18,Z80.ops.ld_IOan,Z80.ops.pop_hl,Z80.ops.ld_IOca,Z80.ops.xx,Z80.ops.xx,Z80.ops.push_hl,Z80.ops.and_an,Z80.ops.rst_20,Z80.ops.add_spn,Z80.ops.jp_hl,Z80.ops.ld_nna,Z80.ops.xx,Z80.ops.xx,Z80.ops.xx,Z80.ops.xor_an,Z80.ops.rst_28,Z80.ops.ld_aIOn,Z80.ops.pop_af,
Z80.ops.ld_aIOc,Z80.ops.di,Z80.ops.xx,Z80.ops.push_af,Z80.ops.or_an,Z80.ops.rst_30,Z80.ops.ld_hlspn,Z80.ops.ld_sphl,Z80.ops.ld_ann,Z80.ops.ei,Z80.ops.xx,Z80.ops.xx,Z80.ops.cp_an,Z80.ops.rst_38];
Z80.cbmap=[Z80.ops.rlc_b,Z80.ops.rlc_c,Z80.ops.rlc_d,Z80.ops.rlc_e,Z80.ops.rlc_h,Z80.ops.rlc_l,Z80.ops.rlc_hlm,Z80.ops.rlc_a,Z80.ops.rrc_b,Z80.ops.rrc_c,Z80.ops.rrc_d,Z80.ops.rrc_e,Z80.ops.rrc_h,Z80.ops.rrc_l,Z80.ops.rrc_hlm,Z80.ops.rrc_a,Z80.ops.rl_b,Z80.ops.rl_c,Z80.ops.rl_d,Z80.ops.rl_e,Z80.ops.rl_h,Z80.ops.rl_l,Z80.ops.rl_hlm,Z80.ops.rl_a,Z80.ops.rr_b,Z80.ops.rr_c,Z80.ops.rr_d,Z80.ops.rr_e,Z80.ops.rr_h,Z80.ops.rr_l,Z80.ops.rr_hlm,Z80.ops.rr_a,Z80.ops.sla_b,Z80.ops.sla_c,Z80.ops.sla_d,Z80.ops.sla_e,
Z80.ops.sla_h,Z80.ops.sla_l,Z80.ops.sla_hlm,Z80.ops.sla_a,Z80.ops.sra_b,Z80.ops.sra_c,Z80.ops.sra_d,Z80.ops.sra_e,Z80.ops.sra_h,Z80.ops.sra_l,Z80.ops.sra_hlm,Z80.ops.sra_a,Z80.ops.swap_b,Z80.ops.swap_c,Z80.ops.swap_d,Z80.ops.swap_e,Z80.ops.swap_h,Z80.ops.swap_l,Z80.ops.swap_hlm,Z80.ops.swap_a,Z80.ops.srl_b,Z80.ops.srl_c,Z80.ops.srl_d,Z80.ops.srl_e,Z80.ops.srl_h,Z80.ops.srl_l,Z80.ops.srl_hlm,Z80.ops.srl_a,Z80.ops.bit_0b,Z80.ops.bit_0c,Z80.ops.bit_0d,Z80.ops.bit_0e,Z80.ops.bit_0h,Z80.ops.bit_0l,Z80.ops.bit_0hlm,
Z80.ops.bit_0a,Z80.ops.bit_1b,Z80.ops.bit_1c,Z80.ops.bit_1d,Z80.ops.bit_1e,Z80.ops.bit_1h,Z80.ops.bit_1l,Z80.ops.bit_1hlm,Z80.ops.bit_1a,Z80.ops.bit_2b,Z80.ops.bit_2c,Z80.ops.bit_2d,Z80.ops.bit_2e,Z80.ops.bit_2h,Z80.ops.bit_2l,Z80.ops.bit_2hlm,Z80.ops.bit_2a,Z80.ops.bit_3b,Z80.ops.bit_3c,Z80.ops.bit_3d,Z80.ops.bit_3e,Z80.ops.bit_3h,Z80.ops.bit_3l,Z80.ops.bit_3hlm,Z80.ops.bit_3a,Z80.ops.bit_4b,Z80.ops.bit_4c,Z80.ops.bit_4d,Z80.ops.bit_4e,Z80.ops.bit_4h,Z80.ops.bit_4l,Z80.ops.bit_4hlm,Z80.ops.bit_4a,
Z80.ops.bit_5b,Z80.ops.bit_5c,Z80.ops.bit_5d,Z80.ops.bit_5e,Z80.ops.bit_5h,Z80.ops.bit_5l,Z80.ops.bit_5hlm,Z80.ops.bit_5a,Z80.ops.bit_6b,Z80.ops.bit_6c,Z80.ops.bit_6d,Z80.ops.bit_6e,Z80.ops.bit_6h,Z80.ops.bit_6l,Z80.ops.bit_6hlm,Z80.ops.bit_6a,Z80.ops.bit_7b,Z80.ops.bit_7c,Z80.ops.bit_7d,Z80.ops.bit_7e,Z80.ops.bit_7h,Z80.ops.bit_7l,Z80.ops.bit_7hlm,Z80.ops.bit_7a,Z80.ops.res_0b,Z80.ops.res_0c,Z80.ops.res_0d,Z80.ops.res_0e,Z80.ops.res_0h,Z80.ops.res_0l,Z80.ops.res_0hlm,Z80.ops.res_0a,Z80.ops.res_1b,
Z80.ops.res_1c,Z80.ops.res_1d,Z80.ops.res_1e,Z80.ops.res_1h,Z80.ops.res_1l,Z80.ops.res_1hlm,Z80.ops.res_1a,Z80.ops.res_2b,Z80.ops.res_2c,Z80.ops.res_2d,Z80.ops.res_2e,Z80.ops.res_2h,Z80.ops.res_2l,Z80.ops.res_2hlm,Z80.ops.res_2a,Z80.ops.res_3b,Z80.ops.res_3c,Z80.ops.res_3d,Z80.ops.res_3e,Z80.ops.res_3h,Z80.ops.res_3l,Z80.ops.res_3hlm,Z80.ops.res_3a,Z80.ops.res_4b,Z80.ops.res_4c,Z80.ops.res_4d,Z80.ops.res_4e,Z80.ops.res_4h,Z80.ops.res_4l,Z80.ops.res_4hlm,Z80.ops.res_4a,Z80.ops.res_5b,Z80.ops.res_5c,
Z80.ops.res_5d,Z80.ops.res_5e,Z80.ops.res_5h,Z80.ops.res_5l,Z80.ops.res_5hlm,Z80.ops.res_5a,Z80.ops.res_6b,Z80.ops.res_6c,Z80.ops.res_6d,Z80.ops.res_6e,Z80.ops.res_6h,Z80.ops.res_6l,Z80.ops.res_6hlm,Z80.ops.res_6a,Z80.ops.res_7b,Z80.ops.res_7c,Z80.ops.res_7d,Z80.ops.res_7e,Z80.ops.res_7h,Z80.ops.res_7l,Z80.ops.res_7hlm,Z80.ops.res_7a,Z80.ops.set_0b,Z80.ops.set_0c,Z80.ops.set_0d,Z80.ops.set_0e,Z80.ops.set_0h,Z80.ops.set_0l,Z80.ops.set_0hlm,Z80.ops.set_0a,Z80.ops.set_1b,Z80.ops.set_1c,Z80.ops.set_1d,
Z80.ops.set_1e,Z80.ops.set_1h,Z80.ops.set_1l,Z80.ops.set_1hlm,Z80.ops.set_1a,Z80.ops.set_2b,Z80.ops.set_2c,Z80.ops.set_2d,Z80.ops.set_2e,Z80.ops.set_2h,Z80.ops.set_2l,Z80.ops.set_2hlm,Z80.ops.set_2a,Z80.ops.set_3b,Z80.ops.set_3c,Z80.ops.set_3d,Z80.ops.set_3e,Z80.ops.set_3h,Z80.ops.set_3l,Z80.ops.set_3hlm,Z80.ops.set_3a,Z80.ops.set_4b,Z80.ops.set_4c,Z80.ops.set_4d,Z80.ops.set_4e,Z80.ops.set_4h,Z80.ops.set_4l,Z80.ops.set_4hlm,Z80.ops.set_4a,Z80.ops.set_5b,Z80.ops.set_5c,Z80.ops.set_5d,Z80.ops.set_5e,
Z80.ops.set_5h,Z80.ops.set_5l,Z80.ops.set_5hlm,Z80.ops.set_5a,Z80.ops.set_6b,Z80.ops.set_6c,Z80.ops.set_6d,Z80.ops.set_6e,Z80.ops.set_6h,Z80.ops.set_6l,Z80.ops.set_6hlm,Z80.ops.set_6a,Z80.ops.set_7b,Z80.ops.set_7c,Z80.ops.set_7d,Z80.ops.set_7e,Z80.ops.set_7h,Z80.ops.set_7l,Z80.ops.set_7hlm,Z80.ops.set_7a];JBA.Input=function(b){this.memory=b;this.sgb=new JBA.SGB(this);this.reset()};JBA.Input.SEL={BUTTON:32,DIRECTION:16,MLT_REQ:0};JBA.Input.Map={buttons:{90:14,88:13,13:7,188:11},directions:{37:13,38:11,39:14,40:7}};
JBA.Input.prototype={col:JBA.Input.SEL.DIRECTION,memory:null,sgb:null,buttons:15,directions:15,reset:function(){this.col=JBA.Input.SEL.DIRECTION;this.directions=this.buttons=15;this.joypad_sel=0;this.sgb.reset()},serialize:function(b){b.wb(this.col);b.wb(this.buttons);b.wb(this.directions);this.sgb.serialize(b)},deserialize:function(b){this.col=b.rb();this.buttons=b.rb();this.directions=b.rb();this.sgb.deserialize(b)},rb:function(){switch(this.col){case JBA.Input.SEL.BUTTON:return this.buttons;case JBA.Input.SEL.DIRECTION:return this.directions;
case JBA.Input.SEL.MLT_REQ:return 15-this.joypad_sel;default:return 15}},wb:function(b,c){this.col=~c&48;this.sgb.receive(c>>4&3)},keydown:function(b){var c=!0,a=JBA.Input.Map.directions[b];a&&(this.directions&=a,this.memory._if|=JBA.INT.INPUT,c=!1);if(a=JBA.Input.Map.buttons[b])this.buttons&=a,this.memory._if|=JBA.INT.INPUT,c=!1;return c},keyup:function(b){var c=!0,a=JBA.Input.Map.directions[b];a&&(this.directions|=~a&15,c=!1);if(a=JBA.Input.Map.buttons[b])this.buttons|=~a&15,c=!1;return c}};JBA.Memory=function(){this.rtc=new JBA.RTC;this.input=new JBA.Input(this);this.reset()};var RAM_SIZE=32768,WRAM_SIZE=32768,HIRAM_SIZE=127;JBA.Memory.MBC={UNKNOWN:4,NONE:0,MBC1:1,MBC2:2,MBC3:3};
JBA.Memory.prototype={gpu:null,rtc:null,input:null,timer:null,mbc:JBA.Memory.MBC.UNKNOWN,battery:0,cgb:0,sgb:0,rom:[],ram:[],wram:[],hiram:[],rombank:1,rambank:0,wrambank:1,ramon:0,mode:0,_ie:0,_if:0,reset:function(){this.rtc.reset();this.input.reset();this.rom=[];this.ram=new Uint8Array(RAM_SIZE);this.wram=new Uint8Array(WRAM_SIZE);this.hiram=new Uint8Array(HIRAM_SIZE);this.rombank=1;this.rambank=0;this.wrambank=1;this.cgb=this.sgb=this.mode=this.ramon=0;var b;for(b=0;b<RAM_SIZE;b++)this.ram[b]=
0;for(b=0;b<WRAM_SIZE;b++)this.wram[b]=0;for(b=0;b<HIRAM_SIZE;b++)this.hiram[b]=0},ram_size:function(){switch(this.rom[329]){case 0:return 0;case 1:return 2048;case 2:return 8192;case 3:return 32768;default:throw"Unknown ram size";}},serialize:function(b){var c;for(c=256;c<=335;c++)b.wb(this.rom[c]);for(c=0;c<RAM_SIZE;c++)b.wb(this.ram[c]);for(c=0;c<WRAM_SIZE;c++)b.wb(this.wram[c]);for(c=0;c<HIRAM_SIZE;c++)b.wb(this.hiram[c]);b.wb(this.rombank);b.wb(this.rambank);b.wb(this.wrambank);b.wb(this.ramon);
b.wb(this.mode);b.wb(this.mbc);b.wb(this._if);b.wb(this._ie);b.wb(this.cgb);b.wb(this.sgb);b.wb(this.battery);this.input.serialize(b)},deserialize:function(b){var c;for(c=256;c<=335;c++)if(b.rb()!=this.rom[c])throw"Wrong cartridge is loaded for save state!";for(c=0;c<RAM_SIZE;c++)this.ram[c]=b.rb();for(c=0;c<WRAM_SIZE;c++)this.wram[c]=b.rb();for(c=0;c<HIRAM_SIZE;c++)this.hiram[c]=b.rb();this.rombank=b.rb();this.rambank=b.rb();this.wrambank=b.rb();this.ramon=b.rb();this.mode=b.rb();this.mbc=b.rb();
this._if=b.rb();this._ie=b.rb();this.cgb=b.rb();this.sgb=b.rb();this.battery=b.rb();this.input.deserialize(b)},powerOn:function(){this.wb(65285,0);this.wb(65286,0);this.wb(65287,0);this.wb(65296,128);this.wb(65297,191);this.wb(65298,243);this.wb(65300,191);this.wb(65302,63);this.wb(65303,0);this.wb(65305,191);this.wb(65306,127);this.wb(65307,255);this.wb(65308,159);this.wb(65310,191);this.wb(65312,255);this.wb(65313,0);this.wb(65314,0);this.wb(65315,191);this.wb(65316,119);this.wb(65317,243);this.wb(65318,
241);this.wb(65344,145);this.wb(65346,0);this.wb(65347,0);this.wb(65349,0);this.wb(65351,252);this.wb(65352,255);this.wb(65353,255);this.wb(65354,0);this.wb(65355,0);this.wb(65535,0)},load_cartridge:function(b){if(typeof b=="string")for(var c=0;c<b.length;c++)this.rom[c]=b.charCodeAt(c)&255;else for(c in b)this.rom[c]=b[c];this.battery=1;switch(this.rom[327]){case 0:case 8:this.battery=0;case 9:this.mbc=JBA.Memory.MBC.NONE;break;case 1:case 2:this.battery=0;case 3:this.mbc=JBA.Memory.MBC.MBC1;break;
case 5:this.battery=0;case 6:this.mbc=JBA.Memory.MBC.MBC2;break;case 17:case 18:this.battery=0;case 15:case 16:case 19:this.mbc=JBA.Memory.MBC.MBC3;break;default:throw"Unknown/unimplemented MBC type: "+this.rom[327];}this.cgb=this.rom[323]&128;this.sgb=this.rom[326]==3},rw:function(b){return this.rb(b)|this.rb(b+1)<<8},ww:function(b,c){this.wb(b,c&255);this.wb(b+1,c>>8)},rb:function(b){switch(b>>12){case 0:case 1:case 2:case 3:return this.rom[b];case 4:case 5:case 6:case 7:return this.rom[this.rombank<<
14|b&16383];case 8:case 9:return this.gpu.vram[b&8191];case 10:case 11:if(this.ramon)return this.rtc.current&8?this.rtc.regs[this.rtc.current&7]:this.ram[this.rambank<<13|b&8191];else break;case 14:case 12:return this.wram[b&4095];case 13:return this.wram[this.wrambank<<12|b&4095];case 15:if(b<65024)return this.rb(b&57343);else if(b<65184)return this.gpu.oam[b&255];else if(!(b<65280))return b<65408?this.ioreg_rb(b):b<65535?this.hiram[b&127]:this._ie}return 255},ioreg_rb:function(b){switch(b>>4&15){case 0:switch(b&
15){case 0:return this.input.rb(b);case 4:return this.timer.div;case 5:return this.timer.tima;case 6:return this.timer.tma;case 7:return this.timer.tac;case 15:return this._if;default:return 255}case 1:case 2:case 3:return 255;case 4:if(this.cgb&&b==65357)throw"Can't go in double speed mode just yet for CGB!";case 5:case 6:return this.gpu.rb(b);case 7:if(this.cgb&&b==65392)return this.wrambank;default:throw"Not implemented reading that address!";}},wb:function(b,c){switch(b>>12){case 0:case 1:switch(this.mbc){case JBA.Memory.MBC.MBC1:case JBA.Memory.MBC.MBC3:this.ramon=
(c&15)==10?1:0;break;case JBA.Memory.MBC.MBC2:b&256||(this.ramon^=1)}break;case 2:case 3:switch(this.mbc){case JBA.Memory.MBC.MBC1:this.rombank=this.rombank&96|c&31;if(this.rombank==0)this.rombank=1;break;case JBA.Memory.MBC.MBC2:if(b&256)this.rombank=c&15;break;case JBA.Memory.MBC.MBC3:c&=127,this.rombank=c+!c}break;case 4:case 5:switch(this.mbc){case JBA.Memory.MBC.MBC1:if(this.mode==0)this.rombank=this.rombank&31|(c&3)<<5;else if(this.rambank=c&3,this.rambank>=8)throw"Need to add some more ram!";
break;case JBA.Memory.MBC.MBC3:this.rtc.current=c&15,this.rambank=c&3}break;case 6:case 7:switch(this.mbc){case JBA.Memory.MBC.MBC1:this.mode=c&1;break;case JBA.Memory.MBC.MBC3:this.rtc.latch(c)}break;case 8:case 9:this.gpu.vram[b&8191]=c;b<38912&&this.gpu.update_tile(b);break;case 10:case 11:this.ramon&&(this.rtc.current&8?this.rtc.wb(c):(this.mbc==JBA.Memory.MBC.MBC2&&(c&=15),this.ram[this.rambank<<13|b&8191]=c));break;case 12:case 14:this.wram[b&4095]=c;break;case 13:this.wram[this.wrambank<<12|
b&4095]=c;break;case 15:if(b<65024)this.wb(b&57343,c);else if(b<65184)this.gpu.oam[b&255]=c;else if(!(b<65280))b<65408?this.ioreg_wb(b,c):b<65535?this.hiram[b&127]=c:this._ie=c}},ioreg_wb:function(b,c){switch(b>>4&15){case 0:switch(b&15){case 0:this.input.wb(b,c);break;case 4:this.timer.div=0;break;case 5:this.timer.tima=c;break;case 6:this.timer.tma=c;break;case 7:this.timer.tac=c;this.timer.update();break;case 15:this._if=c}break;case 1:case 2:case 3:break;case 4:if(this.cgb&&b==65357)throw"Can't go in double speed mode just yet for CGB!";
case 5:case 6:this.gpu.wb(b,c);break;case 7:if(this.cgb&&b==65392&&(c&=7,this.wrambank=c+!c,this.wrambank>=8))throw"Need to add some more wram!";break;default:throw"Not implemented writing that address!";}}};JBA.CPU=function(){this.registers=new Z80.Registers;this.reset()};JBA.INT={VBLANK:1,LCDSTAT:2,TIMER:4,SERIAL:8,JOYPAD:16};JBA.CPU.Interrupts=[];
(function(){function b(a,b){return function(c,g,p,q){c.ime=0;c.halt=0;g._if&=~a&255;b(c,g,p,q)}}for(var c=0;c<32;c++)JBA.CPU.Interrupts[c]=c&JBA.INT.VBLANK?b(JBA.INT.VBLANK,Z80.ops.rst_40):c&JBA.INT.LCDSTAT?b(JBA.INT.LCDSTAT,Z80.ops.rst_48):c&JBA.INT.TIMER?b(JBA.INT.TIMER,Z80.ops.rst_50):c&JBA.INT.SERIAL?b(JBA.INT.SERIAL,Z80.ops.rst_58):c&JBA.INT.JOYPAD?b(JBA.INT.JOYPAD,Z80.ops.rst_60):function(){}})();
JBA.CPU.prototype={memory:null,ticks:0,reset:function(){this.ticks=0;this.registers.reset()},serialize:function(b){this.registers.serialize(b)},deserialize:function(b){this.registers.deserialize(b)},exec:function(){var b=this.registers,c=this.memory,a=b.u8regs,d=b.u16regs;if(b.halt==0){var f=c.rb(d[Z80.PC]++);Z80.map[f](b,c,a,d)}else a[Z80.M]=1;f=a[Z80.M]*4;a[Z80.M]=0;if(b.ime){var g=c._if&c._ie;g&&(JBA.CPU.Interrupts[g](b,c,a,d),f+=a[Z80.M]*4)}this.ticks+=f;c.timer&&c.timer.step(f/4);return f}};JBA.Timer=function(){this.reset()};
JBA.Timer.prototype={memory:null,_clock:{tima:0,div:0},div:0,tima:0,tma:0,tac:0,_tima_speed:256,reset:function(){this.tac=this.tma=this.tima=this.div=0;this._clock.tima=0;this._clock.div=0},serialize:function(b){b.wb(this.div);b.wb(this.tima);b.wb(this.tma);b.wb(this.tac);b.wb(this._clock.tima);b.wb(this._clock.div)},deserialize:function(b){this.div=b.rb();this.tima=b.rb();this.tma=b.rb();this.tac=b.rb();this._clock.tima=b.rb();this._clock.div=b.rb()},update:function(){switch(this.tac&3){case 0:this._tima_speed=
256;break;case 1:this._tima_speed=4;break;case 2:this._tima_speed=16;break;case 3:this._tima_speed=64}},step:function(b){var c=this._clock;for(c.div+=b;c.div>=64;)this.div=this.div+1&255,c.div-=64;if(this.tac&4)for(c.tima+=b;c.tima>=this._tima_speed;){this.tima++;if(this.tima>=255)this.tima=this.tma,this.memory._if|=JBA.INT.TIMER;c.tima-=this._tima_speed}}};JBA.StringIO=function(b){this.data=b||"";this.position=0};JBA.StringIO.prototype={wb:function(b){if(b<0||255<b)throw"Not a byte value: "+b;this.data+=String.fromCharCode(b);this.position++},ww:function(b){this.wb(b&255);this.wb(b>>8)},rb:function(){if(this.position>=this.data.length)throw"Reached end of string";return this.data.charCodeAt(this.position++)},rw:function(){return this.rb()|this.rb()<<8},rewind:function(){this.position=0},eof:function(){return this.position==this.data.length}};JBA.SGB=function(b){this.input=b;this.reset()};JBA.SGB.State={NONE:0,RESET:1,READ:2};
JBA.SGB.prototype={input:null,sgbram:new Uint8Array(4096),state:JBA.SGB.State.NONE,sgbpal:new Uint16Array(16),sgb_pals:Array(4),sgbatf:new Uint8Array(360),reset:function(){var b,c;this.state=JBA.SGB.State.NONE;for(b=0;b<this.sgbram.length;b++)this.sgbram[b]=0;for(b=0;b<this.sgbpal.length;b++)this.sgbpal[b]=0;for(b=0;b<this.sgbatf.length;b++)this.sgbatf[b]=0;for(b=0;b<4;b++){this.sgb_pals[b]=Array(4);for(c=0;c<4;c++)this.sgb_pals[b][c]=[0,0,0,255]}this.update_palettes()},serialize:function(b){if(this.input.memory.sgb){var c;
for(c=0;c<this.sgbram.length;c++)b.wb(this.sgbram[c]);for(c=0;c<this.sgbpal.length;c++)b.ww(this.sgbpal[c]);for(c=0;c<this.sgbatf.length;c++)b.wb(this.sgbatf[c]);b.wb(this.state)}},deserialize:function(b){if(this.input.memory.sgb){var c;for(c=0;c<this.sgbram.length;c++)this.sgbram[c]=b.rb();for(c=0;c<this.sgbpal.length;c++)this.sgbpal[c]=b.rw();for(c=0;c<this.sgbatf.length;c++)this.sgbatf[c]=b.rb();this.state=b.rb(this.state);this.update_palettes()}},receive:function(b){if(this.input.memory.sgb)switch(this.state){case JBA.SGB.State.NONE:if(b==
0)this.state=JBA.SGB.State.RESET,this.sgb_packets=0;else if(b==3)this.input.joypad_sel=(this.input.joypad_sel+1)%4;break;case JBA.SGB.State.RESET:if(b==3){this.state=JBA.SGB.State.READ;if(this.sgb_packets==0)this.sgb_packets=1,this.sgb_datai=0;this.sgb_read=this.sgb_byte=0}else if(b!=0)this.state=JBA.SGB.State.NONE;break;case JBA.SGB.State.READ:if(b==0){if(this.state=JBA.SGB.State.RESET,this.sgb_datai==this.sgb_packets*16)this.sgb_packets=0}else if(b==3)if(this.sgb_read==128)this.sgb_datai==this.sgb_packets*
16?(this.process_sgb_data(),this.state=JBA.SGB.State.NONE):this.sgb_read=0;else{if(this.sgb_byte|=this.sgb_bit<<this.sgb_read%8,this.sgb_read++,this.sgb_read%8==0){if(this.sgb_datai==0)this.sgb_packets=this.sgb_byte%8,this.sgb_command=this.sgb_byte>>3,this.sgb_data=new Uint8Array(this.sgb_packets*16);this.sgb_data[this.sgb_datai++]=this.sgb_byte;this.sgb_byte=0}}else this.sgb_bit=b&1}},process_sgb_data:function(){switch(this.sgb_command){case 0:this.update_pal(0,1);break;case 1:this.update_pal(2,
3);break;case 2:this.update_pal(0,3);break;case 3:this.update_pal(1,2);break;case 4:this.attr_blk();break;case 10:this.pal_set();break;case 11:this.pal_trn();break;case 23:this.mask_en();break;case 15:break;case 17:this.input.joypad_sel=0;break;case 19:case 20:break;default:throw"Unknown!";}},update_pal:function(b,c){var a,d=this.sgb_data,f=this.sgbpal;for(a=0;a<4;a++)f[a*4]=d[2]<<8|d[1];for(a=1;a<3;a++)f[b*4+a]=d[a*2+2]<<8|d[1+a*2];for(a=0;a<3;a++)f[c*4+a]=d[(a+4)*2+2]<<8|d[1+(a+4)*2];this.update_palettes()},
attr_blk:function(){var b,c,a,d,f,g,p,q,j,s,n,i,k,h=this.sgbatf,e=this.sgb_data;for(b=0;b<e[1];b++){c=2+b*6;d=e[c+2];f=e[c+3];g=e[c+4];p=e[c+5];n=e[c]&1;k=e[c]&2;i=e[c]&4;q=e[c+1]&3;s=e[c+1]>>2&3;j=e[c+1]>>4&3;for(a=0;a<18;a++)for(c=0;c<20;c++)c>d&&c<g&&a>f&&a<p?n&&(h[a*20+c]=q):c<d||c>g||a<f||a>p?i&&(h[a*20+c]=j):k&&(h[a*20+c]=s)}},pal_set:function(){var b,c,a=this.sgbpal,d=this.sgb_data,f=[(d[2]<<8|d[1])*8,(d[4]<<8|d[3])*8,(d[6]<<8|d[5])*8,(d[8]<<8|d[7])*8];for(b=0;b<4;b++)for(c=0;c<4;c++)a[b*4+
c]=this.sgbram[f[b]+2*c+1]<<8|this.sgbram[f[b]+2*c];if(d[9]&128)throw"What is an attribute file?!";this.update_palettes()},mask_en:function(){var b=this.sgb_data[1];b==0?this.input.memory.gpu.lcdon=1:b==1?this.input.memory.gpu.lcdon=0:b==2?this.input.memory.gpu.white_canvas():b==3&&this.input.memory.gpu.white_canvas()},pal_trn:function(){var b,c,a,d=this.sgbram,f=this.input.memory.gpu,g=this.input.memory.gpu.vram,p=f.bgmap?7168:6144,q=f.tiledata?0:2048,j=0,s=0;for(b=0;b<13;b++){for(c=0;c<20;c++){var n=
g[p+j];j++;f.tiledata||(n=n>127?n-128:n+128);for(a=0;a<16&&s<4096;a++)d[s++]=g[q+n*16+a]}j+=12}},update_palettes:function(){var b,c,a,d=this.sgbpal;for(b=0;b<4;b++)for(c=0;c<4;c++)a=d[b*4+c],this.sgb_pals[b][c]=[(a&31)<<3,(a>>5&31)<<3,(a>>10&31)<<3,255]}};
